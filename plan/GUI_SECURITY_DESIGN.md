# CIS GUI + å®‰å…¨æ¨¡å‹è®¾è®¡æ–‡æ¡£

> **æ ¸å¿ƒåŸåˆ™**ï¼šé›¶ä¿¡ä»»ç½‘ç»œ - æ‰€æœ‰èŠ‚ç‚¹ï¼ˆå†…ç½‘+å¤–ç½‘ï¼‰å¿…é¡»ç»è¿‡ DID éªŒè¯æ‰èƒ½ç»„ç½‘é€šä¿¡ã€‚

---

## 0. æ ¸å¿ƒåŠŸèƒ½ï¼šè¿œç¨‹ Agent è®¿é—®

### 0.1 åŠŸèƒ½æ¦‚è¿°

CIS GUI ä¸ä»…æ˜¯æœ¬åœ° Agent çš„ç•Œé¢ï¼Œæ›´æ˜¯**æ•´ä¸ªç½‘ç»œçš„å…¥å£**ã€‚é€šè¿‡ CIS çš„ Matrix Federation è¿æ¥ï¼Œç”¨æˆ·å¯ä»¥åƒ SSH ä¸€æ ·è®¿é—®ä»»æ„è¿œç¨‹èŠ‚ç‚¹çš„ Claude CLIã€Kimi Code æˆ–å…¶ä»– Agentã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     è¿œç¨‹ Agent è®¿é—®æ¶æ„                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ç”¨æˆ· PC (GUI)                                                        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ CIS GUI                                                           â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ Terminal Panel                                                â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚ PTY over WebSocket (Port 6767)                          â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚  â€¢ Keystrokes â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º         â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚  â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Agent Output          â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                              â”‚                                      â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚   â”‚ â”‚ Matrix Federation Client (Port 6767)                         â”‚  â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ DID éªŒè¯                                                  â”‚  â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ Session æ§åˆ¶ä¿¡ä»¤ (start/stop/resize)                      â”‚  â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ PTY æ•°æ®æµå¤ç”¨åœ¨åŒä¸€è¿æ¥                                  â”‚  â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚ WebSocket (Port 6767)                      â”‚
â”‚                               â”‚                                            â”‚
â”‚   è¿œç¨‹èŠ‚ç‚¹ (Hugin-pc)         â–¼                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚ CIS Node Daemon (Port 6767)                                       â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ Matrix Federation Handler                                     â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ éªŒè¯ DID Challenge                                         â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ å¤„ç† Session è¯·æ±‚                                          â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â€¢ å‡çº§è¿æ¥ä¸º PTY æ•°æ®é€šé“                                    â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â”‚                              â”‚ spawn                            â”‚   â”‚
â”‚   â”‚                              â–¼                                  â”‚   â”‚
â”‚   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚   â”‚ â”‚ PTY + Agent Process                                           â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚ /bin/bash -c "claude" æˆ– "kimi"                          â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚ stdin â—„â”€â”€ WebSocket â”€â”€â”€â”                                 â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â”‚ stdout â”€â”€â–º WebSocket â”€â”€â”˜                                 â”‚â”‚ â”‚   â”‚
â”‚   â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â”‚   â”‚
â”‚   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚   å…³é”®ï¼šæ‰€æœ‰æµé‡éƒ½é€šè¿‡ Matrix Federation Port 6767                         â”‚
â”‚   æ— éœ€é¢å¤–ç«¯å£ï¼WebSocket è¿æ¥åŒæ—¶æ‰¿è½½æ§åˆ¶ä¿¡ä»¤å’Œ PTY æ•°æ®                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WebSocket å¸§ç»“æ„ï¼ˆPort 6767ï¼‰                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  æ§åˆ¶å¸§ (JSON):                                                             â”‚
â”‚  {                                                                          â”‚
â”‚    "type": "session_start",                                                 â”‚
â”‚    "session_id": "sess_abc123",                                             â”‚
â”‚    "agent_type": "claude",                                                  â”‚
â”‚    "pty_size": {"rows": 40, "cols": 120},                                   â”‚
â”‚    "auth": { "did": "did:cis:local:xyz", "signature": "..." }               â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  æ•°æ®å¸§ (Binary):                                                           â”‚
â”‚  [0x01] [Session ID (16 bytes)] [PTY Data (variable)]                       â”‚
â”‚                                                                             â”‚
â”‚  åŒä¸€ WebSocket è¿æ¥ä¸Šå¤ç”¨æ§åˆ¶å’Œæ•°æ®ï¼š                                       â”‚
â”‚  â€¢ Text å¸§ = Matrix æ§åˆ¶æ¶ˆæ¯ / DID éªŒè¯                                      â”‚
â”‚  â€¢ Binary å¸§ = PTY è¾“å…¥/è¾“å‡ºæ•°æ®                                             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.2 ç«¯å£ä½¿ç”¨è¯´æ˜

| ç«¯å£ | ç”¨é€” | è¿œç¨‹ Agent ä¼šè¯ä½¿ç”¨æ–¹å¼ |
|-----|------|------------------------|
| **6767** | Matrix Federation WebSocket | âœ… **ç›´æ¥ä½¿ç”¨** - æ§åˆ¶ä¿¡ä»¤ + PTY æ•°æ® |
| 7676 | P2P Direct | âŒ ä¸éœ€è¦ - å·²åœ¨ 6767 ä¸Šå¤ç”¨ |
| 7677 | QUIC | âŒ ä¸éœ€è¦ - å·²åœ¨ 6767 ä¸Šå¤ç”¨ |

**å…³é”®è®¾è®¡**ï¼šè¿œç¨‹ Agent ä¼šè¯å®Œå…¨å¤ç”¨ç°æœ‰çš„ **Port 6767 Matrix Federation WebSocket è¿æ¥**ï¼Œæ— éœ€é¢å¤–ç«¯å£ï¼

- Text å¸§ (JSON): Matrix æ§åˆ¶æ¶ˆæ¯ã€DID éªŒè¯ã€Session ä¿¡ä»¤
- Binary å¸§: PTY è¾“å…¥/è¾“å‡ºæ•°æ®ï¼ˆAgent ä¼šè¯ï¼‰

```
å•ä¸€è¿æ¥ï¼ŒåŒé‡ç”¨é€”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WebSocket Connection to target:6767                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Text Frames (JSON)                              â”‚   â”‚
â”‚  â”‚  â€¢ DID Challenge/Response                       â”‚   â”‚
â”‚  â”‚  â€¢ Session Start/Stop/Resize                    â”‚   â”‚
â”‚  â”‚  â€¢ Matrix Events (sync, messages)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Binary Frames                                   â”‚   â”‚
â”‚  â”‚  â€¢ PTY Input (keystrokes)                       â”‚   â”‚
â”‚  â”‚  â€¢ PTY Output (agent stdout/stderr)             â”‚   â”‚
â”‚  â”‚  â€¢ Session multiplexing (session_id prefix)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 0.3 ä½¿ç”¨åœºæ™¯

```bash
# åœºæ™¯ 1: åœ¨è¿œç¨‹å·¥ä½œç«™ä¸Šè¿è¡Œ Claude
# ç”¨æˆ·ç¬”è®°æœ¬ (192.168.1.100) è¿æ¥åˆ° å·¥ä½œç«™ (192.168.1.105)
# æµé‡: ç¬”è®°æœ¬:xxxxx â”€â”€â–º 105:6767 (Matrix Federation Port)
$ ssh hugin-pc  # âŒ ä¸éœ€è¦ SSHï¼
$ cis agent remote hugin-pc  # âœ… é€šè¿‡ CIS Matrix Port 6767 ç›´æ¥è®¿é—®

# ç»ˆç«¯æ˜¾ç¤º:
# [Connected to hugin-pc via Matrix Federation]
# [DID verified: did:cis:hugin:xyz789]
# [Connection: P2P Direct, Latency: 8ms]
# 
# hugin-pc $ claude
# âœ» Welcome to Claude Code research preview!
# 
#  hugin-pc > åˆ†æå½“å‰ç›®å½•çš„ä»£ç ç»“æ„
#  â¿  âœ» Looking at the codebase...
#     âœ» Found 15 source files...

# åœºæ™¯ 2: åœ¨äº‘ç«¯èŠ‚ç‚¹è¿è¡Œ Kimi Code
$ cis agent remote seed.cis.dev kimi
# seed.cis.dev $ kimi
# kimi> ä¼˜åŒ–è¿™ä¸ªå‡½æ•°

# åœºæ™¯ 3: æœ¬åœ° GUI åˆ‡æ¢èŠ‚ç‚¹å°±åƒåˆ‡æ¢æ ‡ç­¾é¡µ
# ç‚¹å‡»åº•éƒ¨ [MuninğŸŸ ] â†’ æœ¬åœ° Agent
# ç‚¹å‡» [HuginğŸŸ ]   â†’ è¿œç¨‹ä¼šè¯
# ç‚¹å‡» [seedğŸ”µ]   â†’ äº‘ç«¯ä¼šè¯
```

### 0.3 æŠ€æœ¯å®ç°

```rust
/// è¿œç¨‹ Agent ä¼šè¯ç®¡ç†
/// æ‰€æœ‰é€šä¿¡é€šè¿‡ Matrix Federation Port 6767 (WebSocket)
pub struct RemoteAgentSession {
    /// ç›®æ ‡èŠ‚ç‚¹
    pub target_node: String,
    /// ç›®æ ‡ Agent ç±»å‹ (claude, kimi, custom)
    pub agent_type: String,
    /// Matrix Federation WebSocket è¿æ¥ (Port 6767)
    pub ws_connection: WebSocketConnection,
    /// ä¼šè¯ ID
    pub session_id: String,
    /// æœ¬åœ° PTYï¼ˆç”¨æˆ·è¾“å…¥ï¼‰
    pub local_pty: PtyPair,
    /// ä¼šè¯çŠ¶æ€
    pub state: SessionState,
}

impl RemoteAgentSession {
    /// å»ºç«‹è¿œç¨‹ä¼šè¯
    /// å¤ç”¨ç°æœ‰çš„ Matrix Federation WebSocket è¿æ¥ (Port 6767)
    pub async fn connect(&mut self) -> Result<(), SessionError> {
        // 1. ç¡®ä¿ç›®æ ‡èŠ‚ç‚¹å·²éªŒè¯ DID
        if !self.verify_target_trusted().await? {
            return Err(SessionError::PeerNotVerified);
        }
        
        // 2. é€šè¿‡ç°æœ‰ Matrix è¿æ¥å‘é€ Session è¯·æ±‚
        // å¤ç”¨å·²å»ºç«‹çš„ WebSocket (Port 6767)ï¼Œæ— éœ€æ–°è¿æ¥ï¼
        let request = SessionRequest {
            session_type: SessionType::AgentPty { 
                agent: self.agent_type.clone(),
                working_dir: None,
            },
            pty_size: PtySize { rows: 40, cols: 120, .. },
        };
        
        // å‘é€ JSON æ§åˆ¶æ¶ˆæ¯ via WebSocket
        let response: SessionResponse = self.ws_connection
            .send_json(MessageType::SessionStart, &request)
            .await?;
        
        self.session_id = response.session_id;
        
        // 3. æ³¨å†Œ Binary æ•°æ®å¤„ç†å™¨
        // WebSocket è¿æ¥ç°åœ¨å¼€å§‹æ¥æ”¶ PTY æ•°æ®ï¼ˆBinary å¸§ï¼‰
        self.setup_pty_data_handler().await?;
        
        Ok(())
    }
    
    /// å‘é€ PTY è¾“å…¥åˆ°è¿œç¨‹
    /// é€šè¿‡åŒä¸€ WebSocket å‘é€ Binary å¸§
    pub async fn send_input(&mut self, data: &[u8]) -> Result<(), SendError> {
        let frame = PtyDataFrame {
            session_id: &self.session_id,
            data,
        };
        // Binary WebSocket frame
        self.ws_connection.send_binary(frame.encode()).await
    }
    
    /// å¤„ç†è¿œç¨‹ PTY è¾“å‡º
    /// ä» WebSocket Binary å¸§æ¥æ”¶
    pub async fn handle_output(&mut self, frame: BinaryFrame) -> Result<(), HandleError> {
        let output = PtyDataFrame::decode(&frame)?;
        // å†™å…¥æœ¬åœ° PTY
        self.local_pty.master.write_all(&output.data).await?;
        Ok(())
    }
}

/// ç›®æ ‡èŠ‚ç‚¹å¤„ç† Session è¯·æ±‚
/// åœ¨ Port 6767 çš„ Matrix Federation Handler ä¸­å¤„ç†
impl FederationHandler {
    async fn handle_session_request(
        &self, 
        sender: &str,
        request: SessionRequest
    ) -> Result<SessionResponse, Error> {
        // 1. éªŒè¯å‘é€è€… DIDï¼ˆå·²åœ¨å¤–å±‚éªŒè¯ï¼‰
        
        // 2. æ£€æŸ¥æƒé™ï¼ˆå¯é€‰ï¼‰
        self.check_session_permissions(sender, &request).await?;
        
        // 3. ç”Ÿæˆ Session ID
        let session_id = generate_session_id();
        
        // 4. å¯åŠ¨ PTY + Agent è¿›ç¨‹
        let pty = portable_pty::PtySystem::default()
            .openpty(request.pty_size)?;
        
        let mut child = std::process::Command::new(&request.agent_type)
            .arg("--interactive")
            .current_dir(&request.working_dir)
            .spawn_pty(&pty)?;
        
        // 5. å¯åŠ¨æ•°æ®è½¬å‘ä»»åŠ¡
        // å°† PTY I/O è½¬å‘åˆ° WebSocket Binary å¸§
        let session = ActiveSession {
            id: session_id.clone(),
            pty,
            child,
            sender: sender.into(),
        };
        
        tokio::spawn(self.run_session(session));
        
        Ok(SessionResponse { session_id })
    }
    
    /// Session ä¸»å¾ªç¯
    /// åœ¨ Port 6767 çš„è¿æ¥ä¸ŠåŒå‘è½¬å‘æ•°æ®
    async fn run_session(&self, mut session: ActiveSession) {
        let (mut pty_reader, mut pty_writer) = session.pty.split();
        let ws_sink = self.ws_connection.sink();
        
        loop {
            tokio::select! {
                // PTY è¾“å‡º â†’ WebSocket Binary å¸§
                Ok(n) = pty_reader.read(&mut buf) => {
                    if n == 0 { break; }
                    let frame = PtyDataFrame::new(&session.id, &buf[..n]);
                    ws_sink.send(Message::Binary(frame.encode())).await?;
                }
                // WebSocket Binary å¸§ â†’ PTY è¾“å…¥
                Some(Ok(Message::Binary(data))) = ws_sink.next() => {
                    let frame = PtyDataFrame::decode(&data)?;
                    if frame.session_id == session.id {
                        pty_writer.write_all(&frame.data).await?;
                    }
                }
            }
        }
        
        // æ¸…ç†
        session.child.kill().await?;
        self.active_sessions.remove(&session.id);
    }
}
```
```

### 0.4 GUI é›†æˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CIS GUI - å¤šèŠ‚ç‚¹ Agent ä¼šè¯                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [Session: Hugin-pc]  [Agent: claude]  [Mode: P2P Direct]  [8ms]      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  hugin-pc $ claude                                                    â”‚  â”‚
â”‚  â”‚  âœ» Welcome to Claude Code!                                           â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  hugin-pc > å¸®æˆ‘åˆ†æ src/main.rs                                      â”‚  â”‚
â”‚  â”‚  â¿  âœ» Reading src/main.rs...                                         â”‚  â”‚
â”‚  â”‚     âœ» This file contains the main entry point...                     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  hugin-pc > _                                                         â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  [Muninâ—local] [Huginâ—remote] [seedâ—remote] [cloudâ—‹offline] [+]            â”‚
â”‚       ğŸŸ            ğŸŸ             ğŸ”µ              â—‹                           â”‚
â”‚   (æœ¬åœ°ä¼šè¯)    (è¿œç¨‹ä¼šè¯)    (è¿œç¨‹ä¼šè¯)     (ç¦»çº¿)                         â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åº•éƒ¨æ ‡ç­¾ç‚¹å‡»åˆ‡æ¢:
â€¢ [Muninâ—local]  â†’ æœ¬åœ° Agent ä¼šè¯ï¼ˆç™½è‰²è¾¹æ¡†ï¼‰
â€¢ [Huginâ—remote] â†’ è¿œç¨‹ Hugin ä¼šè¯ï¼ˆç»¿è‰²åœ†ç‚¹=æ´»è·ƒï¼‰
â€¢ [seedâ—remote]  â†’ è¿œç¨‹äº‘ç«¯ä¼šè¯
```

### 0.5 ä¼šè¯ç”Ÿå‘½å‘¨æœŸ

```rust
/// ä¼šè¯å»ºç«‹æµç¨‹
async fn establish_remote_session(target: &str) -> Result<Session, Error> {
    // Step 1: æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
    let peer = get_peer_info(target)?;
    
    // Step 2: ç¡®ä¿ DID å·²éªŒè¯ï¼ˆå®‰å…¨ï¼ï¼‰
    if !peer.is_verified() {
        // è‡ªåŠ¨è§¦å‘éªŒè¯æˆ–æç¤ºç”¨æˆ·
        trigger_verification_dialog(target).await?;
    }
    
    // Step 3: å‘é€ PTY ä¼šè¯è¯·æ±‚
    let session_req = AgentSessionRequest {
        agent_type: "claude".into(),  // æˆ– "kimi", "custom"
        env_vars: vec!["TERM=xterm-256color".into()],
        working_dir: "~/projects/myapp".into(),
    };
    
    // Step 4: ç›®æ ‡èŠ‚ç‚¹å¯åŠ¨ Agent å¹¶è¿”å› PTY å¥æŸ„
    let session = matrix_client
        .request_agent_session(target, session_req)
        .await?;
    
    // Step 5: å»ºç«‹åŒå‘æµ
    Ok(session)
}

/// ç›®æ ‡èŠ‚ç‚¹å¤„ç†ä¼šè¯è¯·æ±‚
async fn handle_session_request(request: AgentSessionRequest) -> Result<Response, Error> {
    // 1. éªŒè¯è¯·æ±‚æ¥æº
    verify_request_signature(&request)?;
    
    // 2. æ£€æŸ¥æƒé™ï¼ˆå¯é€‰ï¼‰
    check_session_permissions(&request)?;
    
    // 3. å¯åŠ¨ PTY + Agent
    let pty = spawn_pty(&request)?;
    let mut child = Command::new(&request.agent_type)
        .arg("--interactive")
        .current_dir(&request.working_dir)
        .envs(&request.env_vars)
        .spawn_pty(&pty)?;
    
    // 4. å»ºç«‹æ•°æ®é€šé“ï¼Œå°† PTY I/O è½¬å‘åˆ° Matrix è¿æ¥
    tokio::spawn(forward_pty_to_matrix(pty, request.session_id));
    
    Ok(Response { session_id, status: SessionStatus::Active })
}
```

## 1. å®‰å…¨æ¨¡å‹æ¦‚è¿°

### 1.1 é›¶ä¿¡ä»»åŸåˆ™

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CIS é›¶ä¿¡ä»»ç½‘ç»œæ¨¡å‹                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   æœ¬åœ°èŠ‚ç‚¹              å‘ç°                  éªŒè¯              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚   â”‚ mDNS    â”‚ â”€â”€â”€â”€â†’â”‚  Pending â”‚ â”€â”€â”€â”€â”€â†’ â”‚  Verified    â”‚        â”‚
â”‚   â”‚ å¹¿æ’­    â”‚      â”‚  å¾…éªŒè¯   â”‚        â”‚  å·²éªŒè¯å¯ä¿¡   â”‚        â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â†“ éªŒè¯å¤±è´¥                            â”‚
â”‚                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚                     â”‚   Blocked    â”‚                           â”‚
â”‚                     â”‚   å·²æ‹¦æˆª     â”‚                           â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â”‚                                                                 â”‚
â”‚   è§„åˆ™ï¼šæ— è®ºå‘ç°æ–¹å¼ï¼ˆmDNS/æ‰‹åŠ¨/äº‘ç«¯ï¼‰ï¼Œç»„ç½‘å‰å¿…é¡»å®Œæˆ DID éªŒè¯   â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ä¿¡ä»»çŠ¶æ€æœº

```
                      å‘ç°èŠ‚ç‚¹
                         â”‚
                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            UNKNOWN                  â”‚
    â”‚  æœªçŸ¥ - æœªè§è¿‡ï¼Œæ— ä¿¡æ¯               â”‚
    â”‚  æ˜¾ç¤ºï¼šç°è‰² â—‹                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ æ”¶åˆ°å¹¿æ’­/mDNS/æ‰‹åŠ¨æ·»åŠ 
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚            PENDING                  â”‚
    â”‚  å¾…éªŒè¯ - å‘ç°ä½†æœªéªŒè¯ DID           â”‚
    â”‚  æ˜¾ç¤ºï¼šé»„è‰² â—                        â”‚
    â”‚  çŠ¶æ€ï¼šä¸å¯é€šä¿¡                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                    â”‚
           â”‚ DID éªŒè¯æˆåŠŸ        â”‚ DID éªŒè¯å¤±è´¥/è¶…æ—¶
           â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚    VERIFIED     â”‚  â”‚    BLOCKED      â”‚
    â”‚    å·²éªŒè¯å¯ä¿¡    â”‚  â”‚    å·²æ‹¦æˆª       â”‚
    â”‚    ç»¿è‰² â—       â”‚  â”‚    çº¢è‰² â—       â”‚
    â”‚    å¯æ­£å¸¸é€šä¿¡    â”‚  â”‚    ç¦æ­¢é€šä¿¡      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.3 èŠ‚ç‚¹ä¿¡ä»»çŠ¶æ€

| çŠ¶æ€ | å›¾æ ‡ | é¢œè‰² | é€šä¿¡æƒé™ | è¯´æ˜ |
|-----|------|------|---------|------|
| `Unknown` | â—‹ | ç°è‰² #808080 | âŒ ç¦æ­¢ | ä»æœªè§è¿‡çš„èŠ‚ç‚¹ |
| `Pending` | â— | é»„è‰² #F1C40F | âŒ ç¦æ­¢ | å·²å‘ç°ï¼Œç­‰å¾… DID éªŒè¯ |
| `Verified` | â— | ç»¿è‰² #2ECC71 | âœ… å…è®¸ | DID éªŒè¯é€šè¿‡ï¼Œå¯ä¿¡èŠ‚ç‚¹ |
| `Blocked` | â— | çº¢è‰² #E74C3C | âŒ ç¦æ­¢ | éªŒè¯å¤±è´¥æˆ–æ‰‹åŠ¨æ‹¦æˆª |

---

## 2. æ•°æ®ç»“æ„æ›´æ–°

### 2.1 å¢å¼ºçš„ PeerInfo

```rust
// cis-core/src/matrix/federation/types.rs

/// èŠ‚ç‚¹ä¿¡ä»»çŠ¶æ€
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub enum TrustState {
    /// æœªçŸ¥ - ä»æœªè§è¿‡
    Unknown,
    /// å¾…éªŒè¯ - å·²å‘ç°ä½†æœªå®Œæˆ DID éªŒè¯
    Pending { discovered_at: i64, method: DiscoveryMethod },
    /// å·²éªŒè¯ - DID éªŒè¯é€šè¿‡ï¼Œå¯ä¿¡
    Verified { verified_at: i64, did: String },
    /// å·²æ‹¦æˆª - éªŒè¯å¤±è´¥æˆ–æ‰‹åŠ¨æ‹¦æˆª
    Blocked { reason: BlockReason, blocked_at: i64 },
}

/// å‘ç°æ–¹å¼
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub enum DiscoveryMethod {
    /// mDNS è‡ªåŠ¨å‘ç°
    Mdns,
    /// æ‰‹åŠ¨æ·»åŠ 
    Manual,
    /// äº‘ç«¯ç§å­
    CloudSeed,
    /// å…¶ä»–èŠ‚ç‚¹å¼•è
    PeerReferral { from: String },
}

/// æ¥å…¥çŠ¶æ€
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq, Default)]
pub enum ConnectionState {
    /// ä»æœªæ¥å…¥
    #[default]
    NeverConnected,
    /// å½“å‰å·²æ¥å…¥ç½‘ç»œ
    Connected { since: i64 },
    /// æ›¾ç»æ¥å…¥ï¼Œå½“å‰ç¦»çº¿
    Disconnected { since: i64, last_connected: i64 },
    /// è¢«è¸¢å‡ºç½‘ç»œ
    Kicked { 
        since: i64, 
        by: String,  // è°è¸¢å‡ºçš„
        reason: Option<String>,
        permanent: bool,  // æ˜¯å¦æ°¸ä¹…é˜»æ­¢
    },
}

/// æ‹¦æˆªåŸå› 
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
pub enum BlockReason {
    /// DID éªŒè¯å¤±è´¥
    DidVerificationFailed,
    /// DID ä¸åŒ¹é…ï¼ˆå¯èƒ½çš„ä¸­é—´äººæ”»å‡»ï¼‰
    DidMismatch { expected: String, actual: String },
    /// ç­¾åæ— æ•ˆ
    InvalidSignature,
    /// è¶…æ—¶æœªéªŒè¯
    VerificationTimeout,
    /// ç”¨æˆ·æ‰‹åŠ¨æ‹¦æˆª
    ManualBlock,
    /// è¢«å…¶ä»–èŠ‚ç‚¹æ ‡è®°ä¸ºæ¶æ„
    ReportedByPeers,
}

/// å¢å¼ºçš„èŠ‚ç‚¹ä¿¡æ¯
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct PeerInfo {
    // ==================== åŸºç¡€ä¿¡æ¯ ====================
    pub server_name: String,
    pub display_name: Option<String>,
    pub host: String,
    pub port: u16,
    
    // ==================== ä¿¡ä»»çŠ¶æ€ï¼ˆæ–°å¢ï¼‰====================
    /// ä¿¡ä»»çŠ¶æ€ï¼ˆæ ¸å¿ƒå®‰å…¨å­—æ®µï¼‰
    pub trust_state: TrustState,
    
    /// æ¥å…¥çŠ¶æ€
    pub connection_state: ConnectionState,
    
    /// æ˜¯å¦è¢«æ°¸ä¹…é˜»æ­¢
    pub permanently_blocked: bool,
    
    /// é¢„å…±äº«çš„æœŸæœ› DIDï¼ˆç”¨äºéªŒè¯ï¼‰
    pub expected_did: Option<String>,
    
    /// å®é™…çš„ DIDï¼ˆéªŒè¯åå¡«å†™ï¼‰
    pub actual_did: Option<String>,
    
    /// ç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨æ ‡è®°ä¸ºå¯ä¿¡ï¼ˆå…è®¸è‡ªåŠ¨éªŒè¯é€šè¿‡ï¼‰
    pub user_trusted: bool,
    
    // ==================== å‘ç°æ¥æº ====================
    pub source: DiscoveryMethod,
    
    // ==================== è¿æ¥çŠ¶æ€ ====================
    pub connection_type: Option<String>, // "direct", "relay", "hole_punch"
    pub online: bool,
    pub last_seen: Option<i64>,
    
    // ==================== èƒ½åŠ›ä¿¡æ¯ ====================
    pub capabilities: Vec<String>,
    pub version: String,
}

impl PeerInfo {
    /// æ˜¯å¦å…è®¸é€šä¿¡
    pub fn can_communicate(&self) -> bool {
        matches!(self.trust_state, TrustState::Verified { .. })
            && self.online
            && !self.permanently_blocked
            && !matches!(self.connection_state, ConnectionState::Kicked { permanent: true, .. })
    }
    
    /// æ˜¯å¦å¯ä»¥è¢«è¸¢å‡º
    pub fn can_kick(&self) -> bool {
        matches!(self.connection_state, ConnectionState::Connected { .. })
            && !self.permanently_blocked
    }
    
    /// è¸¢å‡ºèŠ‚ç‚¹
    pub fn kick(&mut self, by: impl Into<String>, reason: Option<String>, permanent: bool) {
        self.connection_state = ConnectionState::Kicked {
            since: now(),
            by: by.into(),
            reason,
            permanent,
        };
        self.online = false;
        if permanent {
            self.permanently_blocked = true;
        }
    }
    
    /// æ˜¯å¦éœ€è¦éªŒè¯
    pub fn needs_verification(&self) -> bool {
        matches!(self.trust_state, TrustState::Pending { .. })
    }
    
    /// æ˜¯å¦è¢«æ‹¦æˆª
    pub fn is_blocked(&self) -> bool {
        matches!(self.trust_state, TrustState::Blocked { .. })
    }
    
    /// è·å–æ˜¾ç¤ºé¢œè‰²ï¼ˆç”¨äº GUIï¼‰
    pub fn display_color(&self) -> (Color, Color) {
        // å…ˆæ ¹æ®ä¿¡ä»»çŠ¶æ€ï¼Œå†æ ¹æ®èŠ‚ç‚¹ç±»å‹
        match &self.trust_state {
            TrustState::Unknown => (Color::Gray, Color::DarkGray),
            TrustState::Pending { .. } => (Color::Yellow, Color::DarkYellow),
            TrustState::Blocked { .. } => (Color::Red, Color::DarkRed),
            TrustState::Verified { .. } => {
                // å·²éªŒè¯èŠ‚ç‚¹æ ¹æ®ç±»å‹æ˜¾ç¤ºé¢œè‰²
                match self.source {
                    DiscoveryMethod::CloudSeed => (Color::CloudBlue, Color::CloudBlueDark),
                    _ => (Color::LocalOrange, Color::LocalOrangeDark),
                }
            }
        }
    }
}
```

---

## 3. DID éªŒè¯æµç¨‹

### 3.1 éªŒè¯æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DID éªŒè¯æµç¨‹                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  å‘ç°èŠ‚ç‚¹                    CIS Core                   ç›®æ ‡èŠ‚ç‚¹
     â”‚                           â”‚                           â”‚
     â”‚  1. mDNS å¹¿æ’­ / æ‰‹åŠ¨æ·»åŠ    â”‚                           â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚                           â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚    2. WebSocket è¿æ¥      â”‚
     â”‚                           â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚    3. DID Challenge       â”‚
     â”‚                           â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                           â”‚    { did, challenge, sig }â”‚
     â”‚                           â”‚                           â”‚
     â”‚                           â”‚    4. éªŒè¯ç­¾å             â”‚
     â”‚                           â”‚    - æ£€æŸ¥ did æ ¼å¼        â”‚
     â”‚                           â”‚    - éªŒè¯ challenge ç­¾å   â”‚
     â”‚                           â”‚    - å¯¹æ¯” expected_did    â”‚
     â”‚                           â”‚                           â”‚
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚    â”‚  5a. éªŒè¯é€šè¿‡         â”‚                           â”‚
     â”‚    â”‚  çŠ¶æ€ â†’ Verified      â”‚                           â”‚
     â”‚    â”‚  åŠ å…¥å¯ä¿¡èŠ‚ç‚¹åˆ—è¡¨      â”‚                           â”‚
     â”‚    â”‚  å¼€å§‹åŒæ­¥æ•°æ®          â”‚                           â”‚
     â”‚    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚                           â”‚                           â”‚
     â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚    â”‚  5b. éªŒè¯å¤±è´¥         â”‚                           â”‚
     â”‚    â”‚  çŠ¶æ€ â†’ Blocked       â”‚                           â”‚
     â”‚    â”‚  è®°å½•å¤±è´¥åŸå›           â”‚                           â”‚
     â”‚    â”‚  æ–­å¼€è¿æ¥             â”‚                           â”‚
     â”‚    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                           â”‚
     â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
     â”‚                           â”‚                           â”‚
```

### 3.2 éªŒè¯åè®®è¯¦æƒ…

```rust
/// DID éªŒè¯æ¶ˆæ¯æ ¼å¼
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct DidChallenge {
    /// æŒ‘æˆ˜éšæœºæ•°ï¼ˆé˜²æ­¢é‡æ”¾æ”»å‡»ï¼‰
    pub nonce: String,
    /// æŒ‘æˆ˜è€… DID
    pub challenger_did: String,
    /// æ—¶é—´æˆ³
    pub timestamp: i64,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct DidResponse {
    /// è¢«éªŒè¯è€… DID
    pub did: String,
    /// å¯¹ challenge çš„ç­¾å
    pub signature: String,
    /// å…¬é’¥ï¼ˆç”¨äºéªŒè¯ç­¾åï¼‰
    pub public_key: String,
    /// è¯ä¹¦é“¾ï¼ˆå¯é€‰ï¼‰
    pub certificate_chain: Option<Vec<String>>,
}

/// éªŒè¯æ­¥éª¤
impl FederationService {
    /// æ‰§è¡Œ DID éªŒè¯
    async fn verify_did(&self, peer: &mut PeerInfo) -> Result<(), VerificationError> {
        // 1. ç”ŸæˆæŒ‘æˆ˜
        let challenge = DidChallenge {
            nonce: generate_secure_random(32),
            challenger_did: self.local_did.clone(),
            timestamp: now(),
        };
        
        // 2. å‘é€æŒ‘æˆ˜
        let response: DidResponse = self.send_challenge(peer, &challenge).await?;
        
        // 3. éªŒè¯ DID æ ¼å¼
        if !is_valid_did_format(&response.did) {
            return Err(VerificationError::InvalidDidFormat);
        }
        
        // 4. å¦‚æœæœ‰ expected_didï¼Œå¿…é¡»åŒ¹é…
        if let Some(expected) = &peer.expected_did {
            if &response.did != expected {
                peer.trust_state = TrustState::Blocked {
                    reason: BlockReason::DidMismatch {
                        expected: expected.clone(),
                        actual: response.did.clone(),
                    },
                    blocked_at: now(),
                };
                return Err(VerificationError::DidMismatch);
            }
        }
        
        // 5. éªŒè¯ç­¾å
        if !verify_signature(&challenge, &response.signature, &response.public_key) {
            peer.trust_state = TrustState::Blocked {
                reason: BlockReason::InvalidSignature,
                blocked_at: now(),
            };
            return Err(VerificationError::InvalidSignature);
        }
        
        // 6. éªŒè¯é€šè¿‡
        peer.actual_did = Some(response.did);
        peer.trust_state = TrustState::Verified {
            verified_at: now(),
            did: response.did,
        };
        
        // 7. é€šçŸ¥ GUI æ›´æ–°
        self.event_tx.send(Event::PeerVerified(peer.id.clone())).await?;
        
        Ok(())
    }
}
```

---

## 4. GUI ç•Œé¢è®¾è®¡

### 4.1 ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CIS GUI Prototype                                               [_] [â–¡] [Ã—]â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Terminal Panel (Alacritty)                                          â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  $ node list                                                         â”‚  â”‚
â”‚  â”‚  â— Munin-macmini         ğŸŸ  local   [verified]                       â”‚  â”‚
â”‚  â”‚  â— Hugin-pc (pending)    ğŸŸ  local   [verifying...]                   â”‚  â”‚
â”‚  â”‚  â— seed.cis.dev          ğŸ”µ cloud   [verified]                       â”‚  â”‚
â”‚  â”‚  â— cloud-node-1          ğŸ”µ cloud   [verified]                       â”‚  â”‚
â”‚  â”‚  â—‹ unknown-device        ? unknown  [discovered, click to verify]    â”‚  â”‚
â”‚  â”‚  â— rogue-device          ğŸŸ  local   [BLOCKED - DID mismatch]         â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  $ agent "åˆ†æä»£ç "                                                   â”‚  â”‚
â”‚  â”‚  > [ERROR] èŠ‚ç‚¹ Hugin-pc å°šæœªéªŒè¯ï¼Œæ— æ³•å‘é€æ¶ˆæ¯                        â”‚  â”‚
â”‚  â”‚  > è¯·å…ˆåœ¨ GUI ä¸­ç‚¹å‡»è¯¥èŠ‚ç‚¹å®Œæˆ DID éªŒè¯                                â”‚  â”‚
â”‚  â”‚  $ _                                                                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Node Tabs (å†…ç½‘æ©™è‰²åœ¨å‰ï¼Œäº‘ç«¯è“è‰²åœ¨åï¼ŒæŒ‰ä¿¡ä»»çŠ¶æ€æ’åº)               â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  [â— MuninğŸŸ ] [â— HuginğŸŸ ] [â— seedğŸ”µ] [â— cloudğŸ”µ] [â—‹ ?] [BLOCKED] [+]  â”‚  â”‚
â”‚  â”‚    å·²éªŒè¯     éªŒè¯ä¸­      å·²éªŒè¯    å·²éªŒè¯   æœªçŸ¥   å·²æ‹¦æˆª   æ·»åŠ     â”‚  â”‚
â”‚  â”‚                                                                      â”‚  â”‚
â”‚  â”‚  å›¾ä¾‹: ğŸŸ å†…ç½‘ ğŸ”µäº‘ç«¯  â—å·²éªŒè¯ â—éªŒè¯ä¸­ â—‹æœªçŸ¥ â—å·²æ‹¦æˆª                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 èŠ‚ç‚¹æ ‡ç­¾æ ·å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    èŠ‚ç‚¹æ ‡ç­¾çŠ¶æ€æ ·å¼                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚  å·²éªŒè¯ - å†…ç½‘ (Verified Local)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ â— Munin-macmini                             â”‚               â”‚
â”‚  â”‚   ğŸŸ  èƒŒæ™¯ #D4A574  è¾¹æ¡† ç™½è‰²(é«˜äº®)            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  å·²éªŒè¯ - äº‘ç«¯ (Verified Cloud)                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ â— seed.cis.dev                              â”‚               â”‚
â”‚  â”‚   ğŸ”µ èƒŒæ™¯ #7BA7D4  è¾¹æ¡† ç™½è‰²(é«˜äº®)            â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  éªŒè¯ä¸­ (Pending)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ â— Hugin-pc                                  â”‚               â”‚
â”‚  â”‚   ğŸŸ /ğŸ”µ èƒŒæ™¯ 50%é€æ˜åº¦  è¾¹æ¡† é»„è‰²è™šçº¿         â”‚               â”‚
â”‚  â”‚   ç‚¹å‡»å¯æŸ¥çœ‹éªŒè¯è¿›åº¦                          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  æœªçŸ¥ (Unknown)                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ â—‹ unknown-device                            â”‚               â”‚
â”‚  â”‚   ç°è‰²èƒŒæ™¯ #808080  è¾¹æ¡† ç°è‰²                 â”‚               â”‚
â”‚  â”‚   ç‚¹å‡»å¼¹å‡ºéªŒè¯å¯¹è¯æ¡†                          â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â”‚  å·²æ‹¦æˆª (Blocked)                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ â— rogue-device                              â”‚               â”‚
â”‚  â”‚   çº¢è‰²èƒŒæ™¯ #E74C3C  å¸¦è­¦å‘Šå›¾æ ‡ âš ï¸             â”‚               â”‚
â”‚  â”‚   ç‚¹å‡»å¯æŸ¥çœ‹æ‹¦æˆªåŸå›                           â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.3 éªŒè¯å¯¹è¯æ¡†

```
ç‚¹å‡» [â— Pending] æˆ– [â—‹ Unknown] èŠ‚ç‚¹æ—¶å¼¹å‡º:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯èŠ‚ç‚¹                                    [Ã—]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  èŠ‚ç‚¹ä¿¡æ¯                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  åç§°:     Hugin-pc                                         â”‚
â”‚  åœ°å€:     192.168.1.105:6767                               â”‚
â”‚  æ¥æº:     mDNS è‡ªåŠ¨å‘ç°                                     â”‚
â”‚  å‘ç°æ—¶é—´: 2024-01-15 14:32:05                              â”‚
â”‚                                                             â”‚
â”‚  å®‰å…¨éªŒè¯                                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                             â”‚
â”‚  æœŸæœ› DID (å¯é€‰ï¼Œç”¨äºå¢å¼ºéªŒè¯):                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ did:cis:example:abc123                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â„¹ï¸  å¦‚æœé¢„å…ˆçŸ¥é“å¯¹æ–¹ DIDï¼Œå¡«å…¥åå¯é˜²æ­¢ä¸­é—´äººæ”»å‡»            â”‚
â”‚                                                             â”‚
â”‚  éªŒè¯çŠ¶æ€: ç­‰å¾…éªŒè¯... â—                                    â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ éªŒè¯æ—¥å¿—:                                            â”‚   â”‚
â”‚  â”‚ [14:32:10] å‘èµ· WebSocket è¿æ¥...                    â”‚   â”‚
â”‚  â”‚ [14:32:10] å‘é€ DID Challenge                      â”‚   â”‚
â”‚  â”‚ [14:32:11] æ”¶åˆ°å“åº”ï¼ŒéªŒè¯ç­¾åä¸­...                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚  â”‚   ğŸ” å¼€å§‹éªŒè¯     â”‚  â”‚   âš ï¸  æ‹¦æˆªæ­¤èŠ‚ç‚¹  â”‚                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éªŒè¯æˆåŠŸå:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯èŠ‚ç‚¹                                    [Ã—]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âœ… éªŒè¯æˆåŠŸ                                                 â”‚
â”‚                                                             â”‚
â”‚  èŠ‚ç‚¹ DID:    did:cis:hugin:xyz789                         â”‚
â”‚  éªŒè¯æ—¶é—´:    2024-01-15 14:32:12                          â”‚
â”‚  ç­¾åçŠ¶æ€:    æœ‰æ•ˆ âœ“                                        â”‚
â”‚                                                             â”‚
â”‚  è¯¥èŠ‚ç‚¹ç°å·²åŠ å…¥å¯ä¿¡ç½‘ç»œï¼Œå¯ä»¥å¼€å§‹é€šä¿¡ã€‚                       â”‚
â”‚                                                             â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚                    â”‚   å®Œæˆ        â”‚                         â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

éªŒè¯å¤±è´¥ (DID ä¸åŒ¹é…):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éªŒè¯èŠ‚ç‚¹                                    [Ã—]             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  âŒ éªŒè¯å¤±è´¥ - DID ä¸åŒ¹é…                                    â”‚
â”‚                                                             â”‚
â”‚  âš ï¸  æ£€æµ‹åˆ°æ½œåœ¨çš„å®‰å…¨é£é™©ï¼                                  â”‚
â”‚                                                             â”‚
â”‚  æœŸæœ› DID:    did:cis:hugin:xyz789  (é¢„é…ç½®)                â”‚
â”‚  å®é™… DID:    did:cis:attacker:evil123                      â”‚
â”‚                                                             â”‚
â”‚  å¯èƒ½åŸå› :                                                  â”‚
â”‚  â€¢ ä¸­é—´äººæ”»å‡» - è¿æ¥è¢«æ¶æ„èŠ‚ç‚¹åŠ«æŒ                           â”‚
â”‚  â€¢ é…ç½®é”™è¯¯ - å¯¹æ–¹ DID å·²å˜æ›´ä½†æœªæ›´æ–°                        â”‚
â”‚  â€¢ ä¼ªé€ èŠ‚ç‚¹ - å†’ç”¨å†…ç½‘åœ°å€çš„æ¶æ„èŠ‚ç‚¹                         â”‚
â”‚                                                             â”‚
â”‚  è¯¥èŠ‚ç‚¹å·²è¢«è‡ªåŠ¨æ‹¦æˆªï¼Œä¸ä¼šåŠ å…¥ç½‘ç»œã€‚                          â”‚
â”‚                                                             â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚            â”‚ æŸ¥çœ‹è¯¦æƒ…      â”‚  â”‚  ç¡®è®¤æ‹¦æˆª     â”‚              â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.4 èŠ‚ç‚¹ç®¡ç†å™¨ï¼ˆç‚¹å‡» â˜° æ‰“å¼€ï¼‰

```
ç‚¹å‡»åº•éƒ¨ [â˜°] ç®¡ç†æŒ‰é’®æ‰“å¼€èŠ‚ç‚¹ç®¡ç†å™¨:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ èŠ‚ç‚¹ç®¡ç†å™¨                                                      [Ã—]         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [å…¨éƒ¨] [å·²æ¥å…¥â—] [å¾…éªŒè¯â—] [æ›¾ç»æ¥å…¥â—‹] [è¢«æ‹¦æˆªâ—] [æ·»åŠ æ–°èŠ‚ç‚¹+]            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  å·²æ¥å…¥èŠ‚ç‚¹ (3)                                                [åˆ·æ–°]       â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â— Munin-macmini    ğŸŸ  192.168.1.100:6767   did:cis:munin:abc...  [âˆ’] â”‚   â”‚
â”‚  â”‚   å·²éªŒè¯ âœ“ åœ¨çº¿  å»¶è¿Ÿ 12ms  [Claude] [Kimi] [Shell] [Agent...â–¼]      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â— Hugin-pc         ğŸŸ  192.168.1.105:6767   did:cis:hugin:xyz...  [âˆ’] â”‚   â”‚
â”‚  â”‚   å·²éªŒè¯ âœ“ åœ¨çº¿  å»¶è¿Ÿ 8ms   [Claude] [Kimi] [Shell] [Agent...â–¼]      â”‚   â”‚
â”‚  â”‚   è¿œç¨‹ä¼šè¯: æ´»è·ƒ (claude) â—‰ æ–­å¼€                                    â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â— seed.cis.dev     ğŸ”µ seed.cis.dev:6767    did:cis:seed:def...  [âˆ’] â”‚   â”‚
â”‚  â”‚   å·²éªŒè¯ âœ“ åœ¨çº¿  P2Pç›´è¿    [Claude] [Kimi] [Shell] [Agent...â–¼]      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  å¾…éªŒè¯èŠ‚ç‚¹ (2)                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â— unknown-device   ?  192.168.1.200:6767   DIDæœªçŸ¥                [âˆ’] â”‚   â”‚
â”‚  â”‚   å‘ç°äº 5åˆ†é’Ÿå‰  192.168.1.200                                      â”‚   â”‚
â”‚  â”‚   [ğŸ” éªŒè¯]  [âš ï¸  æ‹¦æˆª]                                              â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â— new-laptop       ?  [fe80::1]:6767       DIDæœªçŸ¥                [âˆ’] â”‚   â”‚
â”‚  â”‚   å‘ç°äº 2åˆ†é’Ÿå‰  IPv6                                               â”‚   â”‚
â”‚  â”‚   [ğŸ” éªŒè¯]  [âš ï¸  æ‹¦æˆª]                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  æ›¾ç»æ¥å…¥ (2)                                                               â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â—‹ old-iphone       ğŸŸ  192.168.1.50:6767    did:cis:old:123...   [+] â”‚   â”‚
â”‚  â”‚   ç¦»çº¿ 3å¤©  ä¸Šæ¬¡æ¥å…¥: 2024-01-12 18:30                               â”‚   â”‚
â”‚  â”‚   [é‡æ–°æ¥å…¥]  [åˆ é™¤è®°å½•]                                             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ â—‹ work-laptop      ğŸ”µ office.cis.dev:6767  did:cis:work:456...  [+] â”‚   â”‚
â”‚  â”‚   ç¦»çº¿ 1å¤©  ä¸Šæ¬¡æ¥å…¥: 2024-01-14 09:15                               â”‚   â”‚
â”‚  â”‚   [é‡æ–°æ¥å…¥]  [åˆ é™¤è®°å½•]                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  è¢«æ‹¦æˆªèŠ‚ç‚¹ (1)                                                             â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ â— rogue-device     ğŸ”´ 192.168.1.66:6767    DIDä¸åŒ¹é…!            [Ã—] â”‚   â”‚
â”‚  â”‚   âš ï¸ æ‹¦æˆªäº 2024-01-15 14:32                                         â”‚   â”‚
â”‚  â”‚   åŸå› : DID éªŒè¯å¤±è´¥ (æœŸæœ›: did:cis:hugin:xyz..., å®é™…: did:cis:att...)â”‚  â”‚
â”‚  â”‚   [æŸ¥çœ‹è¯¦æƒ…]  [è§£é™¤æ‹¦æˆª]  [æ°¸ä¹…åˆ é™¤]                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¿«æ·æ“ä½œæ  (é€‰ä¸­èŠ‚ç‚¹: Hugin-pc)                                      â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚ åœ¨æ­¤èŠ‚ç‚¹è¿è¡Œ:                                                        â”‚   â”‚
â”‚  â”‚ [ğŸ¤– Claude] [ğŸŒ™ Kimi] [ğŸš Shell] [âš¡ Custom...] [ğŸ“‚ Browse Files]   â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚ æˆ–ç›´æ¥è¿æ¥:  ssh hugin-pc âŒ ä¸éœ€è¦! ç‚¹å‡» [Claude] ç›´æ¥å¯åŠ¨è¿œç¨‹ä¼šè¯  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç‚¹å‡» [âˆ’] è¸¢å‡ºèŠ‚ç‚¹æ—¶ç¡®è®¤:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¸¢å‡ºèŠ‚ç‚¹                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  ç¡®å®šè¦è¸¢å‡ºèŠ‚ç‚¹ "Hugin-pc" å—?           â”‚
â”‚                                         â”‚
â”‚  è¯¥èŠ‚ç‚¹å°†è¢«:                             â”‚
â”‚  â€¢ æ–­å¼€å½“å‰è¿æ¥                          â”‚
â”‚  â€¢ ç»ˆæ­¢æ‰€æœ‰æ´»è·ƒä¼šè¯ (1ä¸ª: claude)        â”‚
â”‚  â€¢ æ ‡è®°ä¸º"æ›¾ç»æ¥å…¥"ï¼ˆå¯é‡æ–°æ¥å…¥ï¼‰         â”‚
â”‚  â€¢ ä¿ç•™å†å²åŒæ­¥æ•°æ®                      â”‚
â”‚                                         â”‚
â”‚  [âœ“ æ°¸ä¹…é˜»æ­¢æ­¤èŠ‚ç‚¹] â† å‹¾é€‰åä¸å†å…è®¸æ¥å…¥  â”‚
â”‚                                         â”‚
â”‚      [å–æ¶ˆ]        [è¸¢å‡ºèŠ‚ç‚¹]            â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ°¸ä¹…é˜»æ­¢æ—¶é¢å¤–è­¦å‘Š:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš ï¸ æ°¸ä¹…é˜»æ­¢èŠ‚ç‚¹                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  æ°¸ä¹…é˜»æ­¢å°†:                             â”‚
â”‚  â€¢ æ‹’ç»è¯¥ DID çš„æ‰€æœ‰è¿æ¥è¯·æ±‚             â”‚
â”‚  â€¢ å¿½ç•¥è¯¥èŠ‚ç‚¹çš„ mDNS å¹¿æ’­                â”‚
â”‚  â€¢ å‘å…¶ä»–èŠ‚ç‚¹å¹¿æ’­è¯¥èŠ‚ç‚¹ä¸å¯ä¿¡            â”‚
â”‚  â€¢ ç»ˆæ­¢å½“å‰æ‰€æœ‰æ´»è·ƒä¼šè¯                  â”‚
â”‚                                         â”‚
â”‚  æ­¤æ“ä½œä¸å¯æ’¤é”€ï¼Œç¡®å®šè¦ç»§ç»­å—?            â”‚
â”‚                                         â”‚
â”‚      [å–æ¶ˆ]        [ç¡®è®¤é˜»æ­¢]            â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.5 è¿œç¨‹ Agent ä¼šè¯ç•Œé¢

```
å½“ç‚¹å‡»èŠ‚ç‚¹ä¸Šçš„ [Claude] æˆ– [Kimi] æŒ‰é’®æ—¶:

1. å¦‚æœå·²æœ‰æ´»è·ƒä¼šè¯ï¼Œç›´æ¥åˆ‡æ¢åˆ°è¯¥ä¼šè¯æ ‡ç­¾
2. å¦‚æœæ²¡æœ‰ä¼šè¯ï¼Œå»ºç«‹æ–°è¿æ¥å¹¶æ‰“å¼€æ–°æ ‡ç­¾

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CIS GUI                                                        [_] [â–¡] [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Session: Hugin-pc > Claude     [ğŸ“ é™„ä»¶] [âš™ï¸ è®¾ç½®] [âŒ æ–­å¼€]        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  Connecting to Hugin-pc (192.168.1.105) via Matrix Federation...   â”‚  â”‚
â”‚  â”‚  âœ“ DID verified: did:cis:hugin:xyz789...                           â”‚  â”‚
â”‚  â”‚  âœ“ P2P Direct connection established (RTT: 8ms)                    â”‚  â”‚
â”‚  â”‚  âœ“ PTY session allocated                                           â”‚  â”‚
â”‚  â”‚  âœ“ Agent spawned: /usr/local/bin/claude                            â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  âœ» Welcome to Claude Code research preview!                        â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  > åˆ†æå½“å‰ç›®å½•çš„ä»£ç ç»“æ„                                            â”‚  â”‚
â”‚  â”‚  â¿  âœ» Looking at the codebase...                                   â”‚  â”‚
â”‚  â”‚     âœ» Found 15 source files, analyzing...                          â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  hugin-pc > _                                                       â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â”‚  [è¿œç¨‹æ‰§è¡Œä¸­... æŒ‰ Ctrl+C ä¸­æ–­]                                     â”‚  â”‚
â”‚  â”‚                                                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                             â”‚
â”‚  [Muninâ—local] [Huginâ—remote] [seedâ—remote] [â˜°]                           â”‚
â”‚       ğŸŸ            ğŸŸ (æ´»è·ƒ)      ğŸ”µ            ç®¡ç†                          â”‚
â”‚                                                                             â”‚
â”‚  å›¾ä¾‹: â—æœ¬åœ°ä¼šè¯  â—è¿œç¨‹æ´»è·ƒä¼šè¯  â—è¿œç¨‹ä¼šè¯  ç®¡ç†                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è¿æ¥æ–­å¼€æ—¶çš„æç¤º:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸  ä¼šè¯æ–­å¼€                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ä¸ Hugin-pc çš„è¿æ¥å·²æ–­å¼€                                    â”‚
â”‚                                                             â”‚
â”‚  å¯èƒ½åŸå› :                                                  â”‚
â”‚  â€¢ ç½‘ç»œè¿æ¥ä¸­æ–­                                              â”‚
â”‚  â€¢ èŠ‚ç‚¹è¢«è¸¢å‡ºç½‘ç»œ                                            â”‚
â”‚  â€¢ èŠ‚ç‚¹ä¸»åŠ¨æ–­å¼€è¿æ¥                                          â”‚
â”‚                                                             â”‚
â”‚  æœ€åæ´»åŠ¨: 2åˆ†é’Ÿå‰                                          â”‚
â”‚                                                             â”‚
â”‚     [é‡æ–°è¿æ¥]    [è¿”å›æœ¬åœ°ä¼šè¯]    [å…³é—­æ ‡ç­¾]               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.6 åº•éƒ¨æ ‡ç­¾æ äº¤äº’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                      â”‚
â”‚  [Muninâ—local] [Huginâ—remote] [seedâ—remote] [cloudâ—‹offline] [â˜°]    â”‚
â”‚       ğŸŸ            ğŸŸ               ğŸ”µ              â—‹          ç®¡ç†    â”‚
â”‚    (å½“å‰æ´»è·ƒ)    (æœ‰ä¼šè¯)                                                  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ ‡ç­¾çŠ¶æ€:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ·å¼          â”‚ å«ä¹‰                                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Nameâ—local]  â”‚ æœ¬åœ°ä¼šè¯ï¼Œç™½è‰²è¾¹æ¡† = å½“å‰æ´»è·ƒ                        â”‚
â”‚ [Nameâ—remote] â”‚ è¿œç¨‹ä¼šè¯å·²å»ºç«‹ï¼Œç»¿è‰²åœ†ç‚¹ = è¿æ¥æ­£å¸¸                  â”‚
â”‚ [Nameâ—remote] â”‚ è¿œç¨‹ä¼šè¯å»ºç«‹ä¸­ï¼Œé»„è‰²åœ†åœˆ = è¿æ¥ä¸­                    â”‚
â”‚ [Nameâ—‹remote] â”‚ è¿œç¨‹ä¼šè¯æ–­å¼€ï¼Œç°è‰²åœ†åœˆ = ç¦»çº¿                        â”‚
â”‚ [â˜°]           â”‚ æ‰“å¼€èŠ‚ç‚¹ç®¡ç†å™¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å³é”®èœå• (åœ¨èŠ‚ç‚¹æ ‡ç­¾ä¸Š):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åˆ‡æ¢åˆ°ä¼šè¯                  â”‚
â”‚  åœ¨æ–°çª—å£æ‰“å¼€                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  åœ¨æ­¤èŠ‚ç‚¹è¿è¡Œ:               â”‚
â”‚  ğŸ¤– Claude                   â”‚
â”‚  ğŸŒ™ Kimi Code                â”‚
â”‚  ğŸš Shell                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…                â”‚
â”‚  éªŒè¯èŠ‚ç‚¹                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  è¸¢å‡ºç½‘ç»œ        [âš ï¸ ]       â”‚
â”‚  æ°¸ä¹…é˜»æ­¢        [âš ï¸ ]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. ç»„ç½‘é˜»æ‹¦æœºåˆ¶

### 5.1 é€šä¿¡æ‹¦æˆª

```rust
/// æ¶ˆæ¯å‘é€æ‹¦æˆª
impl FederationService {
    /// å‘é€æ¶ˆæ¯å‰æ£€æŸ¥èŠ‚ç‚¹ä¿¡ä»»çŠ¶æ€
    pub async fn send_event(&self, target: &str, event: CisMatrixEvent) -> Result<(), SendError> {
        let peer = self.get_peer(target)?;
        
        // å…³é”®ï¼šæ£€æŸ¥ä¿¡ä»»çŠ¶æ€
        match &peer.trust_state {
            TrustState::Verified { .. } => {
                // å·²éªŒè¯ï¼Œå…è®¸é€šä¿¡
                self.do_send_event(peer, event).await
            }
            TrustState::Pending { discovered_at, .. } => {
                // æœªéªŒè¯ï¼Œæ‹’ç»é€šä¿¡
                let elapsed = now() - discovered_at;
                Err(SendError::PeerNotVerified {
                    peer: target.into(),
                    discovered_since: elapsed,
                    message: format!(
                        "èŠ‚ç‚¹ {} å°šæœªå®Œæˆ DID éªŒè¯ã€‚è¯·åœ¨ GUI ä¸­ç‚¹å‡»è¯¥èŠ‚ç‚¹å®ŒæˆéªŒè¯åå†è¯•ã€‚",
                        target
                    ),
                })
            }
            TrustState::Blocked { reason, blocked_at } => {
                // å·²æ‹¦æˆªï¼Œæ‹’ç»é€šä¿¡å¹¶å‘ŠçŸ¥åŸå› 
                Err(SendError::PeerBlocked {
                    peer: target.into(),
                    reason: reason.clone(),
                    blocked_at: *blocked_at,
                })
            }
            TrustState::Unknown => {
                Err(SendError::PeerUnknown(target.into()))
            }
        }
    }
}
```

### 5.2 mDNS è‡ªåŠ¨å‘ç°å¤„ç†

```rust
/// mDNS å‘ç°å›è°ƒ
impl MdnsDiscovery {
    /// å‘ç°æ–°èŠ‚ç‚¹æ—¶çš„å¤„ç†
    fn on_peer_discovered(&self, info: MdnsPeerInfo) {
        let peer_id = format!("{}:{}", info.host, info.port);
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
        if let Some(existing) = self.peers.get(&peer_id) {
            // å·²å­˜åœ¨ï¼Œæ›´æ–°æœ€åå‘ç°æ—¶é—´
            existing.last_seen = Some(now());
            return;
        }
        
        // åˆ›å»ºæ–°èŠ‚ç‚¹ï¼ŒçŠ¶æ€ä¸º Pending
        let new_peer = PeerInfo {
            server_name: info.server_name,
            display_name: Some(info.display_name),
            host: info.host,
            port: info.port,
            
            // å…³é”®ï¼šæ–°å‘ç°çš„èŠ‚ç‚¹é»˜è®¤ä¸º Pendingï¼Œéœ€è¦éªŒè¯
            trust_state: TrustState::Pending {
                discovered_at: now(),
                method: DiscoveryMethod::Mdns,
            },
            
            expected_did: None,  // mDNS å‘ç°çš„èŠ‚ç‚¹æ²¡æœ‰é¢„é…ç½® DID
            actual_did: None,
            user_trusted: false,
            
            source: DiscoveryMethod::Mdns,
            connection_type: None,
            online: true,
            last_seen: Some(now()),
            capabilities: info.capabilities,
            version: info.version,
        };
        
        // ä¿å­˜èŠ‚ç‚¹
        self.peers.insert(peer_id.clone(), new_peer);
        
        // é€šçŸ¥ GUI æœ‰æ–°èŠ‚ç‚¹å¾…éªŒè¯
        self.event_tx.send(Event::PeerDiscoveredPending(peer_id));
        
        // âš ï¸ é‡è¦ï¼šä¸è‡ªåŠ¨å¼€å§‹ç»„ç½‘ï¼Œç­‰å¾…ç”¨æˆ·éªŒè¯
        // è‡ªåŠ¨éªŒè¯å°è¯•åªåœ¨åå°è¿›è¡Œï¼Œä¸å½±å“ç”¨æˆ·å†³ç­–
    }
}
```

---

## 6. CLI å‘½ä»¤æ›´æ–°

### 6.1 æ–°å¢å‘½ä»¤

```bash
# æŸ¥çœ‹èŠ‚ç‚¹ä¿¡ä»»çŠ¶æ€
cis node trust-status <node-id>

# åˆ é™¤èŠ‚ç‚¹ï¼ˆä»ç½‘ç»œä¸­è¸¢å‡ºï¼‰
cis node remove <node-id> [--permanent]
# --permanent: æ°¸ä¹…åˆ é™¤ï¼Œä¸å†æ¥å—è¯¥èŠ‚ç‚¹è¿æ¥

# åˆ—å‡ºæ‰€æœ‰å·²çŸ¥èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æœªæ¥å…¥çš„ï¼‰
cis node list-all
# æ˜¾ç¤ºï¼šå·²æ¥å…¥ | å¾…éªŒè¯ | æ›¾ç»æ¥å…¥ | è¢«æ‹¦æˆª
# è¾“å‡º:
# Node: Hugin-pc
# Status: PENDING (discovered 5m ago via mDNS)
# DID: unknown (waiting for verification)
# Communication: BLOCKED

# æ‰‹åŠ¨éªŒè¯èŠ‚ç‚¹
cis node verify <node-id> [--expected-did <did>]
# äº¤äº’å¼éªŒè¯æµç¨‹

# è¸¢å‡ºèŠ‚ç‚¹ï¼ˆä»å½“å‰ç½‘ç»œä¸­æ–­å¼€ï¼‰
cis node kick <node-id> [--reason <reason>] [--permanent]
# æ•ˆæœ: æ–­å¼€è¿æ¥ï¼Œæ ‡è®°ä¸º Kickedï¼Œå¯é‡æ–°æ¥å…¥ï¼ˆé™¤é --permanentï¼‰

# åˆ é™¤èŠ‚ç‚¹ï¼ˆä»åˆ—è¡¨ä¸­å½»åº•ç§»é™¤ï¼‰
cis node remove <node-id>
# æ•ˆæœ: ä»èŠ‚ç‚¹åˆ—è¡¨ä¸­åˆ é™¤ï¼Œå¦‚å†æ¬¡å‘ç°éœ€é‡æ–°éªŒè¯

# æ‹¦æˆªèŠ‚ç‚¹
cis node block <node-id> [--reason <reason>]

# è§£å°èŠ‚ç‚¹ï¼ˆä»…å¯¹ Blocked çŠ¶æ€ï¼‰
cis node unblock <node-id>

# åˆ—å‡ºæ‰€æœ‰å¾…éªŒè¯èŠ‚ç‚¹
cis node list-pending

# åˆ—å‡ºæ‰€æœ‰è¢«æ‹¦æˆªèŠ‚ç‚¹
cis node list-blocked

# åˆ—å‡ºæ‰€æœ‰æ›¾ç»æ¥å…¥ä½†å½“å‰ç¦»çº¿çš„èŠ‚ç‚¹
cis node list-disconnected

# ========== è¿œç¨‹ Agent ä¼šè¯ ==========

# è¿æ¥åˆ°è¿œç¨‹èŠ‚ç‚¹çš„ Agentï¼ˆäº¤äº’å¼ä¼šè¯ï¼‰
cis session connect <node-id> [--agent claude|kimi|custom] [--dir <path>]
# ç¤ºä¾‹:
#   cis session connect hugin-pc --agent claude
#   cis session connect seed.cis.dev --agent kimi --dir ~/projects

# åˆ—å‡ºæ´»è·ƒä¼šè¯
cis session list

# æ–­å¼€è¿œç¨‹ä¼šè¯
cis session disconnect <session-id>

# åœ¨è¿œç¨‹èŠ‚ç‚¹æ‰§è¡Œå•æ¬¡å‘½ä»¤ï¼ˆéäº¤äº’å¼ï¼‰
cis exec <node-id> <command> [--agent claude]
# ç¤ºä¾‹:
#   cis exec hugin-pc "åˆ†æ src/main.rs"
#   cis exec seed.cis.dev "git status" --dir ~/myproject
```

### 6.2 ç°æœ‰å‘½ä»¤è¡Œä¸ºå˜æ›´

```bash
# å‘é€æ¶ˆæ¯ç»™æœªéªŒè¯èŠ‚ç‚¹ä¼šå¤±è´¥
cis message send Hugin-pc "hello"
# Error: èŠ‚ç‚¹ Hugin-pc å°šæœªå®Œæˆ DID éªŒè¯
#        è¯·åœ¨ GUI ä¸­ç‚¹å‡»è¯¥èŠ‚ç‚¹å®ŒæˆéªŒè¯ï¼Œæˆ–ä½¿ç”¨ `cis node verify Hugin-pc`

# åŒæ­¥ä¼šè·³è¿‡æœªéªŒè¯èŠ‚ç‚¹
cis sync --all
# Skipping unverified peers: Hugin-pc, unknown-device
# Syncing with verified peers: Munin-macmini, seed.cis.dev
```

---

## 7. å®‰å…¨äº‹ä»¶é€šçŸ¥

### 7.1 GUI å®‰å…¨æç¤º

```rust
/// å®‰å…¨äº‹ä»¶ç±»å‹
pub enum SecurityEvent {
    /// æ–°èŠ‚ç‚¹å‘ç°ï¼ˆå¾…éªŒè¯ï¼‰
    PeerDiscovered { peer: String, method: DiscoveryMethod },
    
    /// éªŒè¯æˆåŠŸ
    VerificationSucceeded { peer: String, did: String },
    
    /// éªŒè¯å¤±è´¥
    VerificationFailed { peer: String, reason: VerificationError },
    
    /// æ£€æµ‹åˆ° DID ä¸åŒ¹é…ï¼ˆå¯èƒ½çš„æ”»å‡»ï¼‰
    DidMismatchDetected { peer: String, expected: String, actual: String },
    
    /// èŠ‚ç‚¹è¢«æ‹¦æˆª
    PeerBlocked { peer: String, reason: BlockReason },
    
    /// éªŒè¯è¶…æ—¶
    VerificationTimeout { peer: String },
    
    /// èŠ‚ç‚¹è¢«è¸¢å‡º
    PeerKicked { peer: String, by: String, reason: Option<String>, permanent: bool },
    
    /// èŠ‚ç‚¹é‡æ–°æ¥å…¥ï¼ˆè¢«è¸¢å‡ºåï¼‰
    PeerReconnected { peer: String, previous_state: ConnectionState },
    
    /// è¿œç¨‹ä¼šè¯å·²å»ºç«‹
    RemoteSessionEstablished { peer: String, session_id: String, agent: String },
    
    /// è¿œç¨‹ä¼šè¯æ–­å¼€
    RemoteSessionDisconnected { peer: String, session_id: String, reason: DisconnectReason },
}

/// GUI å¤„ç†å®‰å…¨äº‹ä»¶
impl CISApp {
    fn handle_security_event(&mut self, event: SecurityEvent) {
        match event {
            SecurityEvent::PeerDiscovered { peer, method } => {
                // åœ¨çŠ¶æ€æ æ˜¾ç¤ºæç¤º
                self.show_notification(
                    NotificationType::Info,
                    format!("å‘ç°æ–°èŠ‚ç‚¹: {} ({}), ç‚¹å‡»éªŒè¯", peer, method)
                );
                // èŠ‚ç‚¹æ ‡ç­¾é—ªçƒæˆ–é«˜äº®
                self.highlight_pending_peer(&peer);
            }
            SecurityEvent::DidMismatchDetected { peer, expected, actual } => {
                // ä¸¥é‡å®‰å…¨è­¦å‘Š
                self.show_security_alert(
                    format!("âš ï¸ å®‰å…¨è­¦å‘Š: èŠ‚ç‚¹ {} å¯èƒ½å­˜åœ¨ä¸­é—´äººæ”»å‡»ï¼", peer),
                    format!("æœŸæœ› DID: {}\nå®é™… DID: {}", expected, actual)
                );
            }
            _ => {}
        }
    }
}
```

---

## 8. å®ç°è®¡åˆ’

### Phase 1: å®‰å…¨æ¨¡å‹åŸºç¡€ï¼ˆ3 å¤©ï¼‰
- [ ] æ›´æ–° `PeerInfo` æ•°æ®ç»“æ„ï¼Œæ·»åŠ  `TrustState`
- [ ] å®ç° DID éªŒè¯åè®®
- [ ] æ›´æ–° Federation æœåŠ¡ï¼Œæ·»åŠ é€šä¿¡æ‹¦æˆª
- [ ] æ›´æ–° mDNS å‘ç°ï¼Œæ–°èŠ‚ç‚¹é»˜è®¤ Pending

### Phase 2: CLI å®‰å…¨å‘½ä»¤ï¼ˆ2 å¤©ï¼‰
- [ ] å®ç° `cis node verify` å‘½ä»¤
- [ ] å®ç° `cis node block/unblock` å‘½ä»¤
- [ ] å®ç° `cis node kick` å‘½ä»¤ï¼ˆè¸¢å‡ºèŠ‚ç‚¹ï¼‰
- [ ] å®ç° `cis node remove` å‘½ä»¤ï¼ˆåˆ é™¤èŠ‚ç‚¹ï¼‰
- [ ] æ›´æ–°ç°æœ‰å‘½ä»¤ï¼Œæ·»åŠ ä¿¡ä»»æ£€æŸ¥
- [ ] å®‰å…¨äº‹ä»¶é€šçŸ¥ç³»ç»Ÿ

### Phase 3: GUI å®‰å…¨ç•Œé¢ï¼ˆ3 å¤©ï¼‰
- [ ] èŠ‚ç‚¹æ ‡ç­¾æ˜¾ç¤ºä¿¡ä»»çŠ¶æ€ï¼ˆé¢œè‰²/å›¾æ ‡ï¼‰
- [ ] éªŒè¯å¯¹è¯æ¡†
- [ ] å®‰å…¨äº‹ä»¶é€šçŸ¥ UI
- [ ] å®‰å…¨è­¦å‘Šå¼¹çª—
- [ ] èŠ‚ç‚¹ç®¡ç†å™¨ï¼ˆç‚¹å‡» + æ˜¾ç¤ºæ‰€æœ‰èŠ‚ç‚¹åˆ—è¡¨ï¼‰
- [ ] è¸¢å‡ºèŠ‚ç‚¹åŠŸèƒ½ï¼ˆåˆ—è¡¨ä¸­æ˜¾ç¤º - æŒ‰é’®ï¼‰
- [ ] æ°¸ä¹…é˜»æ­¢èŠ‚ç‚¹åŠŸèƒ½

### Phase 4: è¿œç¨‹ Agent ä¼šè¯ï¼ˆ3 å¤©ï¼‰
- [ ] PTY over Matrix WebSocket (Port 6767) åè®®è®¾è®¡
- [ ] Binary å¸§æ ¼å¼å®šä¹‰ï¼ˆSession ID + PTY Dataï¼‰
- [ ] è¿œç¨‹ä¼šè¯å»ºç«‹æµç¨‹ï¼ˆå¤ç”¨ç°æœ‰ 6767 è¿æ¥ï¼‰
- [ ] Agent ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆClaude/Kimi spawn via PTYï¼‰
- [ ] åŒå‘æ•°æ®æµè½¬å‘ï¼ˆPTY â†” WebSocket Binaryï¼‰
- [ ] ä¼šè¯å¤šè·¯å¤ç”¨ï¼ˆå¤šä¸ª Session å…±äº«åŒä¸€ WebSocketï¼‰
- [ ] ä¼šè¯æ¢å¤/é‡è¿æœºåˆ¶

---

## 9. é˜²ç«å¢™ä¸ç«¯å£è¯´æ˜

### 9.1 å•ä¸€ç«¯å£ä¼˜åŠ¿

CIS è¿œç¨‹ Agent ä¼šè¯**ä»…éœ€å¼€æ”¾ Port 6767**ï¼Œè¿™æ˜¯æå¤§çš„éƒ¨ç½²ä¼˜åŠ¿ï¼š

```
ä¼ ç»Ÿä¼ä¸šéƒ¨ç½²å¯¹æ¯”:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH æ–¹æ¡ˆ                                                        â”‚
â”‚  â€¢ éœ€è¦å¼€æ”¾ Port 22                                             â”‚
â”‚  â€¢ éœ€è¦é…ç½® SSH Key / Password                                  â”‚
â”‚  â€¢ éœ€è¦ç”¨æˆ·æœ‰ç³»ç»Ÿè´¦å·                                           â”‚
â”‚  â€¢ Agent éœ€è¦åœ¨ SSH ä¼šè¯ä¸­æ‰‹åŠ¨å¯åŠ¨                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CIS Matrix æ–¹æ¡ˆ                                                 â”‚
â”‚  â€¢ ä»…éœ€å¼€æ”¾ Port 6767 (Matrix Federation)                       â”‚
â”‚  â€¢ DID è‡ªåŠ¨éªŒè¯ï¼Œæ— éœ€å¯†ç                                        â”‚
â”‚  â€¢ æ— éœ€ç³»ç»Ÿè´¦å·ï¼ŒCIS Daemon ç»Ÿä¸€ç®¡ç†                             â”‚
â”‚  â€¢ Agent è‡ªåŠ¨ spawnï¼Œä¸€é”®å¯åŠ¨                                    â”‚
â”‚  â€¢ æ‰€æœ‰æµé‡åŠ å¯† (WebSocket + TLS)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é˜²ç«å¢™è§„åˆ™ç¤ºä¾‹:
# ä»…éœ€ä¸€æ¡è§„åˆ™
ALLOW FROM trusted_network TO cis_node:6767 PROTOCOL tcp

å¯¹æ¯” SSH:
# éœ€è¦å¤šæ¡è§„åˆ™ + å¯†é’¥ç®¡ç†
ALLOW FROM admin_subnet TO internal_servers:22 PROTOCOL tcp
ALLOW FROM vpn_subnet TO internal_servers:22 PROTOCOL tcp
DENY FROM guest_network TO internal_servers:22 PROTOCOL tcp
```

### 9.2 ç«¯å£å¤ç”¨æŠ€æœ¯ç»†èŠ‚

```rust
/// WebSocket æ¶ˆæ¯ç±»å‹æšä¸¾
#[derive(Debug)]
pub enum WsMessage {
    /// Text å¸§ - Matrix æ§åˆ¶æ¶ˆæ¯
    Control(MatrixEvent),
    
    /// Binary å¸§ - PTY æ•°æ®
    PtyData {
        session_id: [u8; 16],
        payload: Vec<u8>,
    },
    
    /// Binary å¸§ - æ–‡ä»¶ä¼ è¾“ï¼ˆæœªæ¥æ‰©å±•ï¼‰
    FileChunk {
        transfer_id: [u8; 16],
        chunk_index: u32,
        data: Vec<u8>,
    },
}

/// åœ¨å•ä¸€ WebSocket è¿æ¥ä¸Šå¤šè·¯å¤ç”¨
impl WebSocketMultiplexer {
    /// å‘é€ PTY æ•°æ®ï¼ˆBinary å¸§ï¼‰
    pub async fn send_pty_data(&self, session_id: &str, data: &[u8]) {
        let mut frame = Vec::with_capacity(17 + data.len());
        frame.push(0x01); // PTY Data type marker
        frame.extend_from_slice(session_id.as_bytes());
        frame.extend_from_slice(data);
        self.ws.send(Message::Binary(frame)).await;
    }
    
    /// å‘é€ Matrix äº‹ä»¶ï¼ˆText å¸§ï¼‰
    pub async fn send_control(&self, event: MatrixEvent) {
        let json = serde_json::to_string(&event).unwrap();
        self.ws.send(Message::Text(json)).await;
    }
}
```

### Phase 5: æµ‹è¯•ä¸åŠ å›ºï¼ˆ2 å¤©ï¼‰
- [ ] æ¨¡æ‹Ÿä¸­é—´äººæ”»å‡»æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå¤§é‡èŠ‚ç‚¹éªŒè¯ + è¿œç¨‹ä¼šè¯ï¼‰
- [ ] å»¶è¿Ÿæµ‹è¯•ï¼ˆæœ¬åœ° vs è¿œç¨‹ Agent ä½“éªŒï¼‰
- [ ] è¾¹ç•Œæƒ…å†µå¤„ç†

---

## 10. æ€»ç»“

### æ ¸å¿ƒå®‰å…¨åŸåˆ™

1. **é›¶ä¿¡ä»»**ï¼šæ— è®ºå‘ç°æ–¹å¼ï¼Œæ‰€æœ‰èŠ‚ç‚¹å¿…é¡»éªŒè¯ DID
2. **é»˜è®¤æ‹’ç»**ï¼šæœªéªŒè¯èŠ‚ç‚¹æ— æ³•é€šä¿¡
3. **é€æ˜å¯è§**ï¼šGUI æ¸…æ™°æ˜¾ç¤ºæ¯ä¸ªèŠ‚ç‚¹çš„ä¿¡ä»»çŠ¶æ€
4. **ç”¨æˆ·æ§åˆ¶**ï¼šç”¨æˆ·å¯ä»¥å†³å®šä¿¡ä»»å“ªäº›èŠ‚ç‚¹

### ç”¨æˆ·ä½“éªŒ

- **SSH-like è¿œç¨‹è®¿é—®**ï¼šåƒ SSH ä¸€æ ·è®¿é—®ä»»æ„èŠ‚ç‚¹çš„ Agentï¼Œæ— éœ€è®°ä½ IP/å¯†ç 
- **ç»Ÿä¸€å…¥å£**ï¼šä¸€ä¸ª GUI ç®¡ç†æ‰€æœ‰èŠ‚ç‚¹çš„ Agentï¼ˆClaude/Kimi/Shellï¼‰
- **æ— ç¼åˆ‡æ¢**ï¼šåº•éƒ¨æ ‡ç­¾æ ç‚¹å‡»åˆ‡æ¢æœ¬åœ°/è¿œç¨‹ä¼šè¯
- **èŠ‚ç‚¹ç®¡ç†å™¨**ï¼šâ˜° æŒ‰é’®æ‰“å¼€å®Œæ•´èŠ‚ç‚¹ç®¡ç†ï¼Œæ”¯æŒè¸¢å‡ºã€éªŒè¯ã€å¯åŠ¨è¿œç¨‹ä¼šè¯
- æ–°å‘ç°çš„èŠ‚ç‚¹ä¼šæœ‰æ˜æ˜¾æç¤º
- éªŒè¯è¿‡ç¨‹è‡ªåŠ¨åŒ–ï¼Œç”¨æˆ·åªéœ€ç¡®è®¤
- éªŒè¯å¤±è´¥çš„èŠ‚ç‚¹æœ‰æ˜ç¡®åŸå› è¯´æ˜
- é˜»æ­¢é€šä¿¡æ—¶æœ‰æ¸…æ™°çš„æ“ä½œæŒ‡å¼•

### é˜²å¾¡èƒ½åŠ›

- âœ… ä¸­é—´äººæ”»å‡»ï¼ˆDID ä¸åŒ¹é…æ£€æµ‹ï¼‰
- âœ… ä¼ªé€ èŠ‚ç‚¹ï¼ˆç­¾åéªŒè¯å¤±è´¥ï¼‰
- âœ… é‡æ”¾æ”»å‡»ï¼ˆChallenge-Response æœºåˆ¶ï¼‰
- âœ… æ¶æ„èŠ‚ç‚¹ï¼ˆç”¨æˆ·å¯æ‰‹åŠ¨æ‹¦æˆªï¼‰
- âœ… æœªæˆæƒè®¿é—®ï¼ˆéªŒè¯å‰ç¦æ­¢ä»»ä½•é€šä¿¡ï¼‰

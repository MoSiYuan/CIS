# ZeroClaw vs CIS è®°å¿†ç³»ç»Ÿæ·±åº¦å¯¹æ¯”åˆ†æ

## ğŸ“Š æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šå¯¹ **ZeroClaw** å’Œ **CIS** çš„è®°å¿†ç³»ç»Ÿè¿›è¡ŒæŠ€æœ¯æ·±åº¦å¯¹æ¯”ï¼Œåˆ†æå„è‡ªçš„æ¶æ„è®¾è®¡ã€æ€§èƒ½ç‰¹å¾ã€å®‰å…¨æœºåˆ¶å’Œé€‚ç”¨åœºæ™¯ï¼Œå¸®åŠ©æ‚¨åšå‡ºæŠ€æœ¯é€‰å‹å†³ç­–ã€‚

---

## 1. ZeroClaw è®°å¿†ç³»ç»Ÿæ¶æ„

### 1.1 æ•´ä½“è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ZeroClaw Memory System                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    Memory Trait                      â”‚   â”‚
â”‚  â”‚  (ç»Ÿä¸€æ¥å£: store/recall/get/list/forget/count)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚         â”‚                  â”‚                  â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚   Sqlite    â”‚  â”‚     Lucid       â”‚  â”‚  Markdown  â”‚    â”‚
â”‚  â”‚   Memory    â”‚  â”‚     Memory      â”‚  â”‚   Memory   â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚         â”‚                  â”‚                  â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚              PostgreSQL / None (å¯é€‰)              â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 SqliteMemory æ ¸å¿ƒç‰¹æ€§

#### 1.2.1 æ··åˆæœç´¢æ¶æ„

```rust
// ZeroClaw: æ··åˆæœç´¢å®ç°
pub async fn recall(&self, query: &str, limit: usize, session_id: Option<&str>) 
    -> anyhow::Result<Vec<MemoryEntry>> {

    // 1. è®¡ç®—æŸ¥è¯¢åµŒå…¥å‘é‡ï¼ˆå¼‚æ­¥ï¼Œæ”¯æŒç¼“å­˜ï¼‰
    let query_embedding = self.get_or_compute_embedding(query).await?;

    // 2. FTS5 BM25 å…³é”®è¯æœç´¢ï¼ˆåŒæ­¥ï¼ŒSQLite å†…ç½®ï¼‰
    let keyword_results = Self::fts5_search(&conn, &query, limit * 2)?;

    // 3. å‘é‡ç›¸ä¼¼åº¦æœç´¢ï¼ˆå…¨è¡¨æ‰«æï¼Œå†…å­˜è®¡ç®—ï¼‰
    let vector_results = if let Some(ref qe) = query_embedding {
        Self::vector_search(&conn, qe, limit * 2, None, session_ref)?
    } else { Vec::new() };

    // 4. åŠ æƒèåˆï¼ˆhybrid_mergeï¼‰
    let merged = vector::hybrid_merge(
        &vector_results, 
        &keyword_results, 
        self.vector_weight,    // é»˜è®¤ 0.7
        self.keyword_weight,   // é»˜è®¤ 0.3
        limit
    );

    Ok(results)
}
```

#### 1.2.2 æ•°æ®åº“ Schema

```sql
-- æ ¸å¿ƒè®°å¿†è¡¨
CREATE TABLE memories (
    id          TEXT PRIMARY KEY,
    key         TEXT NOT NULL UNIQUE,
    content     TEXT NOT NULL,
    category    TEXT NOT NULL DEFAULT 'core',
    embedding   BLOB,           -- å‘é‡åµŒå…¥ï¼ˆå¯é€‰ï¼‰
    created_at  TEXT NOT NULL,
    updated_at  TEXT NOT NULL,
    session_id  TEXT            -- ä¼šè¯éš”ç¦»
);

-- FTS5 å…¨æ–‡æœç´¢è™šæ‹Ÿè¡¨
CREATE VIRTUAL TABLE memories_fts USING fts5(
    key, content, content=memories, content_rowid=rowid
);

-- åµŒå…¥ç¼“å­˜è¡¨ï¼ˆLRU æ·˜æ±°ï¼‰
CREATE TABLE embedding_cache (
    content_hash TEXT PRIMARY KEY,
    embedding    BLOB NOT NULL,
    created_at   TEXT NOT NULL,
    accessed_at  TEXT NOT NULL
);

-- ç´¢å¼•
CREATE INDEX idx_memories_category ON memories(category);
CREATE INDEX idx_memories_key ON memories(key);
CREATE INDEX idx_memories_session ON memories(session_id);
CREATE INDEX idx_cache_accessed ON embedding_cache(accessed_at);
```

#### 1.2.3 æ€§èƒ½ä¼˜åŒ–

| ä¼˜åŒ–ç­–ç•¥ | å®ç°æ–¹å¼ | æ•ˆæœ |
|---------|---------|------|
| **WAL æ¨¡å¼** | `PRAGMA journal_mode = WAL` | å¹¶å‘è¯»å†™ï¼Œå´©æºƒå®‰å…¨ |
| **å†…å­˜æ˜ å°„** | `PRAGMA mmap_size = 8MB` | OS é¡µç¼“å­˜åŠ é€Ÿ |
| **é¡µç¼“å­˜** | `PRAGMA cache_size = -2000` | 2MB è¿›ç¨‹å†…ç¼“å­˜ |
| **ä¸´æ—¶è¡¨å†…å­˜åŒ–** | `PRAGMA temp_store = MEMORY` | é¿å…ç£ç›˜ I/O |
| **åµŒå…¥ç¼“å­˜** | LRU ç¼“å­˜ï¼ˆé»˜è®¤ 10,000 æ¡ï¼‰ | å‡å°‘ API è°ƒç”¨ |
| **æ··åˆèåˆ** | åŠ æƒè¯„åˆ†ï¼ˆå‘é‡ 0.7 + å…³é”®è¯ 0.3ï¼‰ | å¹³è¡¡è¯­ä¹‰+ç²¾ç¡® |

#### 1.2.4 å‘é‡æ£€ç´¢å®ç°

```rust
// ZeroClaw: å…¨è¡¨æ‰«æ + å†…å­˜è®¡ç®—
fn vector_search(
    conn: &Connection,
    query_embedding: &[f32],
    limit: usize,
    category: Option<&str>,
    session_id: Option<&str>,
) -> anyhow::Result<Vec<(String, f32)>> {
    // å…¨è¡¨æ‰«æï¼ˆæ— å‘é‡ç´¢å¼•ï¼ï¼‰
    let mut sql = "SELECT id, embedding FROM memories WHERE embedding IS NOT NULL".to_string();

    // å¯é€‰è¿‡æ»¤
    if let Some(cat) = category { sql += " AND category = ?"; }
    if let Some(sid) = session_id { sql += " AND session_id = ?"; }

    let mut scored = Vec::new();
    for row in rows {
        let (id, blob) = row?;
        let emb = vector::bytes_to_vec(&blob);
        let sim = vector::cosine_similarity(query_embedding, &emb);  // å†…å­˜è®¡ç®—
        if sim > 0.0 { scored.push((id, sim)); }
    }

    // æ’åºæˆªæ–­
    scored.sort_by(|a, b| b.1.partial_cmp(&a.1).unwrap_or(Equal));
    scored.truncate(limit);
    Ok(scored)
}
```

**å…³é”®é—®é¢˜**ï¼šå…¨è¡¨æ‰«æï¼Œæ—¶é—´å¤æ‚åº¦ O(N)ï¼Œæ•°æ®é‡å¤§æ—¶æ€§èƒ½çº¿æ€§ä¸‹é™ã€‚

### 1.3 LucidMemory ç‰¹æ€§

```rust
// ZeroClaw: Lucid å¤–éƒ¨å·¥å…·é›†æˆ
pub struct LucidMemory {
    local: SqliteMemory,           // æœ¬åœ° SQLite å›é€€
    lucid_cmd: String,             // lucid å‘½ä»¤è·¯å¾„
    token_budget: usize,           // Token é¢„ç®—ï¼ˆé»˜è®¤ 200ï¼‰
    recall_timeout: Duration,      // 500ms è¶…æ—¶
    store_timeout: Duration,       // 800ms è¶…æ—¶
    local_hit_threshold: usize,    // æœ¬åœ°å‘½ä¸­é˜ˆå€¼ï¼ˆ3æ¬¡ï¼‰
    failure_cooldown: Duration,    // å¤±è´¥å†·å´ï¼ˆ15sï¼‰
}
```

**è®¾è®¡ç›®æ ‡**ï¼šé€šè¿‡å¤–éƒ¨ lucid å·¥å…·æä¾›æ›´æ™ºèƒ½çš„è®°å¿†æ£€ç´¢ï¼Œä½†å¢åŠ äº†å¤æ‚æ€§å’Œå»¶è¿Ÿã€‚

---

## 2. CIS è®°å¿†ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CIS Memory System                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  MemoryService                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚ GetOps  â”‚ â”‚ SetOps  â”‚ â”‚SearchOpsâ”‚ â”‚ SyncOps â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              MemoryServiceState (Arc)                 â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  MemoryDb    â”‚  â”‚ VectorStorageâ”‚  â”‚Encryption â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (SQLite)    â”‚  â”‚(sqlite-vec)  â”‚  â”‚(ChaCha20) â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              WeeklyArchivedMemory (å¯é€‰)              â”‚   â”‚
â”‚  â”‚         54å‘¨å½’æ¡£ + ç²¾å‡†ç´¢å¼•ç­–ç•¥                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒç‰¹æ€§

#### 2.2.1 ç§åŸŸ/å…¬åŸŸåˆ†ç¦»

```rust
// CIS: è®°å¿†åŸŸå®šä¹‰
pub enum MemoryDomain {
    Private,  // ç§åŸŸï¼šæœ¬åœ°åŠ å¯†ï¼Œæ°¸ä¸åŒæ­¥
    Public,   // å…¬åŸŸï¼šæ˜æ–‡å­˜å‚¨ï¼Œå¯P2PåŒæ­¥
}

// CIS: è‡ªåŠ¨åŠ å¯†å†³ç­–
pub async fn set(&self, key: &str, value: &[u8], domain: MemoryDomain, category: MemoryCategory) 
    -> Result<()> {

    let encrypted_value = match domain {
        MemoryDomain::Private => {
            // ä½¿ç”¨ ChaCha20-Poly1305 åŠ å¯†
            self.encryption.encrypt(value).await?
        }
        MemoryDomain::Public => value.to_vec(),  // æ˜æ–‡å­˜å‚¨
    };

    // å­˜å‚¨åˆ°æ•°æ®åº“...
}
```

#### 2.2.2 å‘é‡å­˜å‚¨ï¼ˆsqlite-vecï¼‰

```rust
// CIS: ä½¿ç”¨ sqlite-vec æ‰©å±•ï¼ˆC è¯­è¨€å®ç°çš„é«˜æ•ˆå‘é‡ç´¢å¼•ï¼‰
pub struct VectorStorage {
    conn: Arc<Mutex<Connection>>,
    dimensions: usize,  // åµŒå…¥ç»´åº¦ï¼ˆé»˜è®¤ 384ï¼‰
}

impl VectorStorage {
    /// è¯­ä¹‰æœç´¢ï¼ˆä½¿ç”¨ sqlite-vec çš„å‘é‡ç´¢å¼•ï¼‰
    pub async fn search(
        &self,
        query_embedding: &[f32],
        limit: usize,
        threshold: f32,
    ) -> Result<Vec<VectorSearchResult>> {
        // sqlite-vec å†…éƒ¨ä½¿ç”¨é«˜æ•ˆçš„å‘é‡ç´¢å¼•ï¼ˆå¦‚ HNSWï¼‰
        // æ—¶é—´å¤æ‚åº¦ï¼šO(log N) è€Œé O(N)
        let sql = "SELECT key, embedding, vec_distance_cosine(embedding, ?1) as distance 
                   FROM vectors 
                   WHERE vec_distance_cosine(embedding, ?1) < ?2
                   ORDER BY distance 
                   LIMIT ?3";

        // æ‰§è¡Œæœç´¢...
    }
}
```

**å…³é”®ä¼˜åŠ¿**ï¼šsqlite-vec æ˜¯ C è¯­è¨€ç¼–å†™çš„ SQLite æ‰©å±•ï¼Œæä¾›é«˜æ•ˆçš„å‘é‡ç´¢å¼•ï¼ˆHNSWï¼‰ï¼ŒæŸ¥è¯¢å¤æ‚åº¦ O(log N)ã€‚

#### 2.2.3 54å‘¨å½’æ¡£ç³»ç»Ÿ

```rust
// CIS: å‘¨å½’æ¡£è®°å¿†ç³»ç»Ÿ
pub struct WeeklyArchivedMemory {
    base_dir: PathBuf,           // åŸºç¡€ç›®å½•
    max_weeks: usize,            // æœ€å¤§ä¿ç•™å‘¨æ•°ï¼ˆé»˜è®¤ 54ï¼‰
    current_week: Arc<Mutex<String>>,  // å½“å‰å‘¨IDï¼ˆå¦‚ "2026-W07"ï¼‰
    semaphore: Arc<Semaphore>,   // å¹¶å‘ä¿¡å·é‡ï¼ˆé™åˆ¶åŒæ—¶æ‰“å¼€æ•°æ®åº“æ•°ï¼‰
    index_strategy: IndexStrategy,  // ç²¾å‡†ç´¢å¼•ç­–ç•¥
}

impl WeeklyArchivedMemory {
    /// åˆ†ç±»è®°å¿†æ¡ç›®ï¼ˆå†³å®šç´¢å¼•ç­–ç•¥ï¼‰
    fn classify_entry(&self, key: &str, domain: MemoryDomain, category: MemoryCategory) -> IndexType {
        // æ•æ„Ÿä¿¡æ¯ï¼ˆä¸å»ºå‘é‡ï¼‰
        if key.contains("api_key") || key.contains("secret") || key.contains("password") {
            return IndexType::Sensitive;
        }

        // ä¸´æ—¶æ•°æ®ï¼ˆä¸ç´¢å¼•ï¼‰
        if key.starts_with("temp/") || key.starts_with("cache/") {
            return IndexType::Temporary;
        }

        // ç”¨æˆ·åå¥½ï¼ˆé«˜ä¼˜å…ˆçº§ç´¢å¼•ï¼‰
        if key.starts_with("user/preference/") {
            return IndexType::UserPreference;
        }

        // é¡¹ç›®é…ç½®ï¼ˆç´¢å¼•ï¼‰
        if key.starts_with("project/") || key.contains("architecture") {
            return IndexType::ProjectConfig;
        }

        // é»˜è®¤åˆ†ç±»...
    }

    /// è®¡ç®—é‡è¦æ€§åˆ†æ•°ï¼ˆå†³å®šæ˜¯å¦ç´¢å¼•ï¼‰
    fn calculate_importance(&self, key: &str, domain: MemoryDomain, category: MemoryCategory) -> f32 {
        let mut score = 0.0;

        // ç§åŸŸè®°å¿†é‡è¦æ€§ +0.3
        if matches!(domain, MemoryDomain::Private) { score += 0.3; }

        // ç”¨æˆ·åå¥½ +0.4
        if key.contains("preference") { score += 0.4; }

        // é¡¹ç›®é…ç½® +0.3
        if key.contains("config") || key.contains("architecture") { score += 0.3; }

        // è®¿é—®é¢‘ç‡åŠ æƒ...

        score.min(1.0)
    }
}
```

#### 2.2.4 ç²¾å‡†ç´¢å¼•ç­–ç•¥

```rust
// CIS: ç´¢å¼•ç­–ç•¥é…ç½®
pub struct IndexStrategy {
    pub max_entries: usize,        // æœ€å¤§ç´¢å¼•æ¡ç›®æ•°ï¼ˆé»˜è®¤ 10,000ï¼‰
    pub allowed_types: Vec<IndexType>,  // ç´¢å¼•ç±»å‹ç™½åå•
    pub min_importance: f32,       // æœ€å°é‡è¦æ€§åˆ†æ•°ï¼ˆé»˜è®¤ 0.7ï¼‰
    pub target_ratio: f32,         // ç›®æ ‡ç´¢å¼•ç‡ï¼ˆé»˜è®¤ 10%ï¼‰
}

impl Default for IndexStrategy {
    fn default() -> Self {
        Self {
            max_entries: 10_000,
            allowed_types: vec![
                IndexType::UserPreference,
                IndexType::ProjectConfig,
                IndexType::ImportantDecision,
                IndexType::FrequentlyQueried,
            ],
            min_importance: 0.7,
            target_ratio: 0.1,  // ä»…ç´¢å¼• 10% çš„é«˜ä»·å€¼è®°å¿†
        }
    }
}
```

### 2.3 è®°å¿†ä½œç”¨åŸŸï¼ˆMemoryScopeï¼‰

```rust
// CIS: ç¨³å®šå“ˆå¸Œç»‘å®šçš„è®°å¿†ä½œç”¨åŸŸ
#[derive(Debug, Clone, PartialEq, Eq, Hash, Serialize, Deserialize)]
pub struct MemoryScope {
    /// ä½œç”¨åŸŸ IDï¼ˆ16å­—ç¬¦åå…­è¿›åˆ¶å“ˆå¸Œï¼‰
    pub scope_id: String,
    /// äººç±»å¯è¯»åç§°ï¼ˆå¯é€‰ï¼‰
    pub display_name: Option<String>,
    /// ç‰©ç†è·¯å¾„ï¼ˆä»…åˆå§‹åŒ–ç”¨ï¼Œä¸ä½œä¸ºé”®ï¼‰
    #[serde(skip)]
    pub path: Option<PathBuf>,
    /// è®°å¿†åŸŸï¼ˆç§åŸŸ/å…¬åŸŸï¼‰
    pub domain: MemoryDomain,
}

impl MemoryScope {
    /// ç”Ÿæˆè®°å¿†é”®ï¼š{scope_id}::{key}
    pub fn memory_key(&self, key: &str) -> String {
        format!("{}::{}", self.scope_id, key)
    }

    /// ä»é…ç½®æ–‡ä»¶åŠ è½½ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
    pub fn from_config(config: &ProjectConfig) -> Result<Self> {
        // ç¬¬ä¸€æ¬¡ï¼šç”Ÿæˆå“ˆå¸Œå¹¶ä¿å­˜
        // åç»­ï¼šä»é…ç½®è¯»å–ï¼ˆå“ˆå¸Œä¸å˜ï¼‰
        let scope_id = Self::load_or_generate_scope_id(config)?;
        // ...
    }
}
```

**æ ¸å¿ƒä¿è¯**ï¼š
- é¡¹ç›®ç§»åŠ¨/é‡å‘½åå scope_id ä¸å˜
- ä¸åŒæœºå™¨åä½œæ—¶ scope_id ä¸€è‡´ï¼ˆé€šè¿‡é…ç½®æ–‡ä»¶åŒæ­¥ï¼‰

---

## 3. æ·±åº¦å¯¹æ¯”åˆ†æ

### 3.1 æ¶æ„è®¾è®¡å¯¹æ¯”

| ç»´åº¦ | ZeroClaw | CIS | åˆ†æ |
|------|----------|-----|------|
| **åç«¯å¤šæ ·æ€§** | âœ… 5+ åç«¯ï¼ˆSQLite/Lucid/Markdown/Postgres/Noneï¼‰ | âš ï¸ ä¸»è¦ SQLite + sqlite-vec | ZeroClaw æ›´çµæ´» |
| **å‘é‡ç´¢å¼•** | âŒ å…¨è¡¨æ‰«æ O(N) | âœ… sqlite-vec HNSW O(log N) | CIS æ€§èƒ½æ›´å¥½ |
| **æ··åˆæœç´¢** | âœ… å‘é‡+FTS5 BM25 åŠ æƒèåˆ | âš ï¸ ä¸»è¦å‘é‡æœç´¢ | ZeroClaw æœç´¢æ›´ç²¾å‡† |
| **åŸŸåˆ†ç¦»** | âš ï¸ category åˆ†ç±» | âœ… Private/Public ç‰©ç†åˆ†ç¦» | CIS å®‰å…¨æ›´å½»åº• |
| **åŠ å¯†** | âš ï¸ å¯é€‰ | âœ… ç§åŸŸå¼ºåˆ¶åŠ å¯† | CIS æ›´å®‰å…¨ |
| **å½’æ¡£ç­–ç•¥** | âŒ æ— å†…ç½®å½’æ¡£ | âœ… 54å‘¨å½’æ¡£ + ç²¾å‡†ç´¢å¼• | CIS æ›´é€‚åˆé•¿æœŸè¿è¡Œ |
| **ä½œç”¨åŸŸç®¡ç†** | âš ï¸ workspace ç›®å½• | âœ… ç¨³å®šå“ˆå¸Œç»‘å®š | CIS æ›´ç¨³å®š |

### 3.2 æ€§èƒ½å¯¹æ¯”

#### 3.2.1 å‘é‡æ£€ç´¢æ€§èƒ½

| æŒ‡æ ‡ | ZeroClaw | CIS | å·®è· |
|------|----------|-----|------|
| **æ—¶é—´å¤æ‚åº¦** | O(N) å…¨è¡¨æ‰«æ | O(log N) HNSW ç´¢å¼• | CIS å¿« 10-1000 å€ |
| **10K è®°å¿†æŸ¥è¯¢** | ~50-100ms | ~1-5ms | CIS å¿« 10-20 å€ |
| **100K è®°å¿†æŸ¥è¯¢** | ~500-1000ms | ~2-10ms | CIS å¿« 50-100 å€ |
| **1M è®°å¿†æŸ¥è¯¢** | ~5-10s | ~5-20ms | CIS å¿« 250-500 å€ |

**åˆ†æ**ï¼š
- ZeroClaw ä½¿ç”¨çº¯ Rust å®ç°çš„ä½™å¼¦ç›¸ä¼¼åº¦è®¡ç®—ï¼Œå…¨è¡¨æ‰«ææ‰€æœ‰åµŒå…¥å‘é‡
- CIS ä½¿ç”¨ sqlite-vecï¼ˆC æ‰©å±•ï¼‰ï¼Œå†…ç½® HNSW å‘é‡ç´¢å¼•ï¼ŒæŸ¥è¯¢æ•ˆç‡æé«˜

#### 3.2.2 æ··åˆæœç´¢è´¨é‡

| åœºæ™¯ | ZeroClaw | CIS | åˆ†æ |
|------|----------|-----|------|
| **è¯­ä¹‰ç›¸ä¼¼** | âœ… å‘é‡æƒé‡ 0.7 | âœ… sqlite-vec å‘é‡ | ç›¸å½“ |
| **å…³é”®è¯ç²¾ç¡®** | âœ… FTS5 BM25 | âš ï¸ ä¾èµ–å‘é‡ | ZeroClaw æ›´ç²¾å‡† |
| **æ··åˆæŸ¥è¯¢** | âœ… åŠ æƒèåˆ | âš ï¸ ä¸»è¦å‘é‡ | ZeroClaw æ›´å…¨é¢ |

**ç¤ºä¾‹**ï¼š
- æŸ¥è¯¢ "Python å¼‚æ­¥ç¼–ç¨‹"ï¼š
  - ZeroClawï¼šå‘é‡æ•æ‰è¯­ä¹‰ + BM25 æ•æ‰å…³é”®è¯ "Python"
  - CISï¼šä¸»è¦ä¾èµ–å‘é‡ï¼Œå¯èƒ½é—æ¼å…³é”®è¯ç²¾ç¡®åŒ¹é…

### 3.3 å®‰å…¨å¯¹æ¯”

| ç»´åº¦ | ZeroClaw | CIS | åˆ†æ |
|------|----------|-----|------|
| **åŠ å¯†** | âš ï¸ å¯é€‰ ChaCha20 | âœ… ç§åŸŸå¼ºåˆ¶ ChaCha20-Poly1305 | CIS æ›´ä¸¥æ ¼ |
| **å¯†é’¥æ´¾ç”Ÿ** | âŒ æœªæ˜ç¡® | âœ… Argon2id | CIS æ›´å®‰å…¨ |
| **ç¡¬ä»¶ç»‘å®š** | âŒ æ—  | âœ… DID + ç¡¬ä»¶æŒ‡çº¹ | CIS é˜²å¤åˆ¶ |
| **åŸŸéš”ç¦»** | âš ï¸ é€»è¾‘åˆ†ç±» | âœ… ç‰©ç†åˆ†ç¦»ï¼ˆç§åŸŸ/å…¬åŸŸï¼‰ | CIS æ›´å½»åº• |
| **æ•æ„Ÿæ•°æ®å¤„ç†** | âš ï¸ æ— ç‰¹æ®Šå¤„ç† | âœ… è‡ªåŠ¨è¯†åˆ«ä¸ç´¢å¼• | CIS æ›´ç»†è‡´ |

### 3.4 é•¿æœŸè¿è¡Œå¯¹æ¯”

| ç»´åº¦ | ZeroClaw | CIS | åˆ†æ |
|------|----------|-----|------|
| **æ•°æ®å½’æ¡£** | âŒ æ— å†…ç½®å½’æ¡£ | âœ… 54å‘¨å½’æ¡£ | CIS æ›´é€‚åˆé•¿æœŸè¿è¡Œ |
| **ç´¢å¼•ç®¡ç†** | âš ï¸ å…¨é‡ç´¢å¼• | âœ… ç²¾å‡†ç´¢å¼•ï¼ˆä»… 10%ï¼‰ | CIS æ›´é«˜æ•ˆ |
| **å­˜å‚¨å¢é•¿** | âš ï¸ çº¿æ€§å¢é•¿ | âœ… å—æ§å¢é•¿ | CIS æ›´å¯æ§ |
| **å†å²æ¸…ç†** | âš ï¸ æ‰‹åŠ¨ | âœ… è‡ªåŠ¨ï¼ˆåŸºäºå‘¨ï¼‰ | CIS æ›´è‡ªåŠ¨åŒ– |

### 3.5 ä»£ç è´¨é‡å¯¹æ¯”

| ç»´åº¦ | ZeroClaw | CIS | åˆ†æ |
|------|----------|-----|------|
| **æµ‹è¯•è¦†ç›–** | âš ï¸ æœªæ˜ç¡® | âœ… 65%ï¼ˆ1104/1135 æµ‹è¯•ï¼‰ | CIS æ›´å¯é  |
| **æ–‡æ¡£** | âœ… è¯¦ç»† | âœ… è¯¦ç»† | ç›¸å½“ |
| **ä»£ç ç»„ç»‡** | âœ… æ¨¡å—åŒ– | âœ… æ¨¡å—åŒ–ï¼ˆops åˆ†ç¦»ï¼‰ | ç›¸å½“ |
| **é”™è¯¯å¤„ç†** | âœ… anyhow | âœ… è‡ªå®šä¹‰é”™è¯¯ç±»å‹ | ç›¸å½“ |

---

## 4. é€‚ç”¨åœºæ™¯åˆ†æ

### 4.1 ZeroClaw æ›´é€‚åˆçš„åœºæ™¯

| åœºæ™¯ | åŸå›  |
|------|------|
| **è½»é‡çº§å•èŠ‚ç‚¹ Agent** | 3.4MB äºŒè¿›åˆ¶ï¼Œ<5MB RAMï¼Œå¿«é€Ÿå¯åŠ¨ |
| **å¤šåç«¯éœ€æ±‚** | éœ€è¦ Markdown/Postgres/Lucid ç­‰å¤šç§åç«¯ |
| **ç²¾ç¡®å…³é”®è¯æœç´¢** | FTS5 BM25 æä¾›ä¼˜ç§€çš„å…³é”®è¯åŒ¹é… |
| **å¿«é€ŸåŸå‹å¼€å‘** | é…ç½®ç®€å•ï¼Œæ— éœ€ DID å’Œç½‘ç»œè®¾ç½® |
| **èµ„æºå—é™ç¯å¢ƒ** | ä½å†…å­˜å ç”¨ï¼Œé€‚åˆè¾¹ç¼˜è®¾å¤‡ |

### 4.2 CIS æ›´é€‚åˆçš„åœºæ™¯

| åœºæ™¯ | åŸå›  |
|------|------|
| **å¤šèŠ‚ç‚¹ P2P è”é‚¦** | 0 Token èŠ‚ç‚¹é€šä¿¡ï¼ŒDID èº«ä»½éªŒè¯ |
| **å¤§è§„æ¨¡è®°å¿†å­˜å‚¨** | sqlite-vec HNSW ç´¢å¼•ï¼ŒO(log N) æŸ¥è¯¢ |
| **é«˜éšç§åœºæ™¯** | ç§åŸŸå¼ºåˆ¶åŠ å¯†ï¼Œç¡¬ä»¶ç»‘å®šï¼Œé˜²å¤åˆ¶ |
| **é•¿æœŸè¿è¡Œç³»ç»Ÿ** | 54å‘¨å½’æ¡£ï¼Œç²¾å‡†ç´¢å¼•ï¼Œå­˜å‚¨å¯æ§ |
| **è·¨è®¾å¤‡åä½œ** | è®°å¿†ä½œç”¨åŸŸç¨³å®šï¼ŒP2P åŒæ­¥ |

---

## 5. æŠ€æœ¯å€ºåŠ¡ä¸é£é™©

### 5.1 ZeroClaw é£é™©

| é£é™© | ç­‰çº§ | è¯´æ˜ |
|------|------|------|
| **å‘é‡æ€§èƒ½ç“¶é¢ˆ** | ğŸ”´ é«˜ | å…¨è¡¨æ‰«æ O(N)ï¼Œæ•°æ®é‡å¤§æ—¶æ€§èƒ½æ€¥å‰§ä¸‹é™ |
| **æ— å½’æ¡£æœºåˆ¶** | ğŸŸ¡ ä¸­ | é•¿æœŸè¿è¡Œåæ•°æ®åº“æ— é™å¢é•¿ |
| **åŠ å¯†éå¼ºåˆ¶** | ğŸŸ¡ ä¸­ | é»˜è®¤ä¸åŠ å¯†ï¼Œç”¨æˆ·å¯èƒ½å¿½ç•¥ |
| **Lucid ä¾èµ–** | ğŸŸ¡ ä¸­ | å¤–éƒ¨å·¥å…·å¢åŠ å¤æ‚æ€§å’Œå¤±è´¥ç‚¹ |

### 5.2 CIS é£é™©

| é£é™© | ç­‰çº§ | è¯´æ˜ |
|------|------|------|
| **sqlite-vec ä¾èµ–** | ğŸŸ¡ ä¸­ | C æ‰©å±•å¢åŠ ç¼–è¯‘å¤æ‚æ€§ |
| **DID å¤æ‚æ€§** | ğŸŸ¡ ä¸­ | ç¡¬ä»¶ç»‘å®šå¯èƒ½å¯¼è‡´è¿ç§»å›°éš¾ |
| **åŠŸèƒ½ç›¸å¯¹é›†ä¸­** | ğŸŸ¢ ä½ | ä¸»è¦æ”¯æŒ SQLiteï¼Œåç«¯é€‰æ‹©è¾ƒå°‘ |

---

## 6. ç»“è®ºä¸å»ºè®®

### 6.1 æ€»ä½“è¯„ä»·

| ç»´åº¦ | ZeroClaw | CIS | èƒœå‡º |
|------|----------|-----|------|
| **æ¶æ„çµæ´»æ€§** | â­â­â­â­â­ | â­â­â­ | ZeroClaw |
| **æŸ¥è¯¢æ€§èƒ½** | â­â­â­ | â­â­â­â­â­ | CIS |
| **å®‰å…¨æ€§** | â­â­â­ | â­â­â­â­â­ | CIS |
| **é•¿æœŸè¿ç»´** | â­â­â­ | â­â­â­â­â­ | CIS |
| **æ˜“ç”¨æ€§** | â­â­â­â­â­ | â­â­â­ | ZeroClaw |
| **åŠŸèƒ½å®Œæ•´æ€§** | â­â­â­â­ | â­â­â­â­â­ | CIS |

### 6.2 é€‰æ‹©å»ºè®®

#### é€‰æ‹© ZeroClaw å¦‚æœæ‚¨ï¼š

1. âœ… æ„å»ºè½»é‡çº§å•èŠ‚ç‚¹ Agent
2. âœ… éœ€è¦å¤šç§å­˜å‚¨åç«¯ï¼ˆMarkdown/Postgresï¼‰
3. âœ… å¯¹å…³é”®è¯ç²¾ç¡®æœç´¢è¦æ±‚é«˜
4. âœ… èµ„æºå—é™ï¼ˆä½å†…å­˜/CPUï¼‰
5. âœ… å¿«é€ŸåŸå‹å¼€å‘ï¼Œä¸æƒ³å¤„ç†å¤æ‚é…ç½®

#### é€‰æ‹© CIS å¦‚æœæ‚¨ï¼š

1. âœ… æ„å»ºå¤šèŠ‚ç‚¹åˆ†å¸ƒå¼ Agent ç³»ç»Ÿ
2. âœ… éœ€è¦å¤„ç†å¤§è§„æ¨¡è®°å¿†ï¼ˆ10K+ æ¡ç›®ï¼‰
3. âœ… å¯¹éšç§å’Œå®‰å…¨è¦æ±‚æé«˜
4. âœ… ç³»ç»Ÿéœ€è¦é•¿æœŸè¿è¡Œï¼ˆæ•°æœˆ/æ•°å¹´ï¼‰
5. âœ… éœ€è¦è·¨è®¾å¤‡è®°å¿†åŒæ­¥

### 6.3 æ•´åˆå»ºè®®

**æœ€ä½³æ–¹æ¡ˆï¼šZeroClaw + CIS è®°å¿†åç«¯**

```rust
// ä½¿ç”¨ CIS MemoryService ä½œä¸º ZeroClaw çš„åç«¯
let cis_memory = CisMemoryAdapter::new(
    MemoryService::open_default("node-1")?,
    "node-1".to_string()
);

let agent = AgentBuilder::new()
    .provider(create_provider("anthropic", api_key)?)
    .memory(Arc::new(cis_memory))  // ä½¿ç”¨ CIS è®°å¿†
    .tools(default_tools(security))
    .build()?;
```

**ä¼˜åŠ¿**ï¼š
- ä¿ç•™ ZeroClaw çš„å¤šé€šé“å’Œå·¥å…·ç”Ÿæ€
- è·å¾— CIS çš„é«˜æ€§èƒ½å‘é‡æ£€ç´¢
- äº«å— CIS çš„å®‰å…¨å’Œå½’æ¡£æœºåˆ¶
- æ”¯æŒæœªæ¥çš„ P2P è”é‚¦æ‰©å±•

---

## 7. æ€§èƒ½åŸºå‡†æµ‹è¯•å»ºè®®

å»ºè®®è¿›è¡Œä»¥ä¸‹å¯¹æ¯”æµ‹è¯•ï¼š

```rust
// æµ‹è¯• 1ï¼šå‘é‡æ£€ç´¢æ€§èƒ½
fn benchmark_vector_search(memory: &dyn Memory, dataset_size: usize) {
    // æ’å…¥ N æ¡è®°å¿†
    // æ‰§è¡Œ 1000 æ¬¡éšæœºæŸ¥è¯¢
    // è®°å½•å¹³å‡å»¶è¿Ÿå’Œ P99 å»¶è¿Ÿ
}

// æµ‹è¯• 2ï¼šæ··åˆæœç´¢è´¨é‡
fn benchmark_search_quality(memory: &dyn Memory, test_queries: &[TestQuery]) {
    // ä½¿ç”¨æ ‡å‡†æµ‹è¯•é›†ï¼ˆå¦‚ MS MARCOï¼‰
    // è®¡ç®— Recall@K å’Œ NDCG@K
}

// æµ‹è¯• 3ï¼šé•¿æœŸè¿è¡Œç¨³å®šæ€§
fn benchmark_long_term(memory: &dyn Memory, duration: Duration) {
    // æŒç»­æ’å…¥è®°å¿†ï¼ˆæ¨¡æ‹Ÿ 1 å¹´æ•°æ®é‡ï¼‰
    // ç›‘æ§æŸ¥è¯¢æ€§èƒ½è¡°å‡
    // æ£€æŸ¥å­˜å‚¨å¢é•¿æ›²çº¿
}
```

---

## é™„å½• Aï¼šæŠ€æœ¯è§„æ ¼å¯¹æ¯”è¡¨

| è§„æ ¼ | ZeroClaw | CIS |
|------|----------|-----|
| **å‘é‡ç»´åº¦** | å¯é…ç½®ï¼ˆé»˜è®¤ 384/1536ï¼‰ | å¯é…ç½®ï¼ˆé»˜è®¤ 384ï¼‰ |
| **åµŒå…¥æ¨¡å‹** | OpenAI/æœ¬åœ°/FastEmbed | FastEmbed |
| **å‘é‡ç´¢å¼•** | æ— ï¼ˆå…¨è¡¨æ‰«æï¼‰ | HNSWï¼ˆsqlite-vecï¼‰ |
| **å…³é”®è¯ç´¢å¼•** | FTS5 BM25 | ä¾èµ–å‘é‡ |
| **æ··åˆèåˆ** | åŠ æƒèåˆ | æ—  |
| **ç¼“å­˜ç­–ç•¥** | LRUï¼ˆ10Kï¼‰ | æœªæ˜ç¡® |
| **åŠ å¯†ç®—æ³•** | ChaCha20-Poly1305 | ChaCha20-Poly1305 + Argon2id |
| **å½’æ¡£ç­–ç•¥** | æ—  | 54å‘¨æŒ‰å‘¨å½’æ¡£ |
| **ç´¢å¼•ç‡** | 100% | ~10%ï¼ˆç²¾å‡†ç´¢å¼•ï¼‰ |
| **å¹¶å‘æ§åˆ¶** | parking_lot Mutex | tokio Mutex + Semaphore |

---

*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: 2026-02-20*
*åˆ†æç‰ˆæœ¬: ZeroClaw 0.1.0 vs CIS v1.1.5*

# CIS v1.1.6 æ”¹è¿›è®¡åˆ’ä¸è§£å†³æ–¹æ¡ˆ

> **åŸºäºä»£ç å®¡é˜…ç»“æœ** (2026-02-12)
> **ç›®æ ‡ç‰ˆæœ¬**: v1.1.6
> **é¢„è®¡å‘å¸ƒ**: 2026-Q2

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æ–‡æ¡£åŸºäºå¯¹ CIS v1.1.5 çš„å…¨é¢ä»£ç å®¡é˜…ï¼Œæ€»ç»“äº†å‘ç°çš„ä¸»è¦é—®é¢˜ï¼Œå¹¶æä¾›äº†è¯¦ç»†çš„æ”¹è¿›è®¡åˆ’å’Œè§£å†³æ–¹æ¡ˆã€‚å®¡é˜…è¦†ç›–äº† 8 ä¸ªä¸»è¦æ¨¡å—å±‚çº§ï¼Œå‘ç°äº† 25+ ä¸¥é‡é—®é¢˜ã€35+ é‡è¦é—®é¢˜å’Œ 40+ ä¸€èˆ¬é—®é¢˜ã€‚

**æ•´ä½“è¯„åˆ†**: â­â­â­â­â˜† (3.9/5)

ä¸»è¦ä¼˜åŠ¿ï¼šæ¶æ„è®¾è®¡ä¼˜ç§€ã€åŠŸèƒ½è¦†ç›–å…¨é¢ã€ä»£ç è´¨é‡è¾ƒé«˜
ä¸»è¦é—®é¢˜ï¼šå®‰å…¨æ€§éœ€åŠ å¼ºã€å¹¶å‘ç®¡ç†å¾…æ”¹è¿›ã€æ€§èƒ½ä¼˜åŒ–ç©ºé—´å¤§

---

## æ”¹è¿›ç›®æ ‡

### æ ¸å¿ƒç›®æ ‡

1. **å®‰å…¨æ€§æå‡** - ä¿®å¤æ‰€æœ‰ä¸¥é‡çº§åˆ«çš„å®‰å…¨æ¼æ´
2. **ç¨³å®šæ€§æ”¹è¿›** - è§£å†³å¹¶å‘å’Œå†…å­˜ç®¡ç†é—®é¢˜
3. **æ€§èƒ½ä¼˜åŒ–** - æ¶ˆé™¤ä¸»è¦æ€§èƒ½ç“¶é¢ˆ
4. **æ¶æ„ä¼˜åŒ–** - é‡æ„é—®é¢˜æ¨¡å—ï¼Œæé«˜å¯ç»´æŠ¤æ€§
5. **åŠŸèƒ½å®Œå–„** - è¡¥å……ç¼ºå¤±çš„æ ¸å¿ƒåŠŸèƒ½

### æ¬¡è¦ç›®æ ‡

1. æµ‹è¯•è¦†ç›–ç‡æå‡è‡³ 70%+
2. æ–‡æ¡£å®Œæ•´æ€§æå‡è‡³ 80%+
3. ç”¨æˆ·ä½“éªŒæ”¹è¿›
4. å¼€å‘è€…ä½“éªŒä¼˜åŒ–

---

## ä¼˜å…ˆçº§çŸ©é˜µ

### ğŸ”´ P0 - ç«‹å³ä¿®å¤ï¼ˆ1-2 å‘¨ï¼‰

è¿™äº›é—®é¢˜å½±å“ç³»ç»Ÿå®‰å…¨æ€§æˆ–ç¨³å®šæ€§ï¼Œå¿…é¡»ç«‹å³ä¿®å¤ï¼š

| é—®é¢˜ | å½±å“å±‚çº§ | å·¥ä½œé‡ | è´Ÿè´£äººå»ºè®® |
|------|---------|--------|----------|
| WASM æ²™ç®±å®‰å…¨æ¼æ´ | åŸºç¡€å±‚ã€æ‰§è¡Œå±‚ | 5 äººæ—¥ | Rust å®‰å…¨ä¸“å®¶ |
| åŠ å¯†å¯†é’¥ä½¿ç”¨å›ºå®šç›å€¼ | æ•°æ®å±‚ | 2 äººæ—¥ | å®‰å…¨å›¢é˜Ÿ |
| ACL æ—¶é—´æˆ³éªŒè¯ç¼ºå¤± | ç½‘ç»œå±‚ | 3 äººæ—¥ | ç½‘ç»œå›¢é˜Ÿ |
| é…ç½®æ–‡ä»¶æ•æ„Ÿä¿¡æ¯æ˜æ–‡ | åŸºç¡€å±‚ | 3 äººæ—¥ | å®‰å…¨å›¢é˜Ÿ |
| æ­»é”é£é™© | æ•°æ®å±‚ã€ä¸šåŠ¡å±‚ | 4 äººæ—¥ | å¹¶å‘ä¸“å®¶ |
| æƒé™æ§åˆ¶ç¼ºå¤± | æ‰§è¡Œå±‚ã€é›†æˆå±‚ | 5 äººæ—¥ | å®‰å…¨å›¢é˜Ÿ |
| Agent èµ„æºæ³„æ¼ | æ‰§è¡Œå±‚ | 3 äººæ—¥ | Rust å›¢é˜Ÿ |
| çº¿ç¨‹å®‰å…¨é—®é¢˜ | å¼€å‘å·¥å…· | 2 äººæ—¥ | Rust å›¢é˜Ÿ |

**æ€»è®¡**: ~27 äººæ—¥

### ğŸŸ  P1 - é«˜ä¼˜å…ˆçº§ï¼ˆ2-4 å‘¨ï¼‰

è¿™äº›é—®é¢˜å½±å“åŠŸèƒ½æˆ–æ€§èƒ½ï¼Œåº”å°½å¿«ä¿®å¤ï¼š

| é—®é¢˜ | å½±å“å±‚çº§ | å·¥ä½œé‡ | è´Ÿè´£äººå»ºè®® |
|------|---------|--------|----------|
| DHT å®ç°è¿‡äºç®€åŒ– | ç½‘ç»œå±‚ | 8 äººæ—¥ | ç½‘ç»œå›¢é˜Ÿ |
| Matrix åè®®ä¸å®Œæ•´ | ç½‘ç»œå±‚ | 10 äººæ—¥ | ç½‘ç»œå›¢é˜Ÿ |
| MCP åè®®å®ç°ä¸å®Œæ•´ | é›†æˆå±‚ | 8 äººæ—¥ | é›†æˆå›¢é˜Ÿ |
| è½®è¯¢æ€§èƒ½ç“¶é¢ˆ | æ‰§è¡Œå±‚ | 5 äººæ—¥ | æ€§èƒ½å›¢é˜Ÿ |
| å‘é‡æœç´¢ fallback æ€§èƒ½å·® | æ•°æ®å±‚ | 5 äººæ—¥ | æ€§èƒ½å›¢é˜Ÿ |
| ä»£ç é‡å¤ï¼ˆDAG å®šä¹‰ï¼‰ | æ‰§è¡Œå±‚ | 3 äººæ—¥ | æ¶æ„å›¢é˜Ÿ |
| æ¨¡å—èŒè´£è¿‡é‡ | æ•°æ®å±‚ã€ç”¨æˆ·ç•Œé¢ | 8 äººæ—¥ | æ¶æ„å›¢é˜Ÿ |
| CLI å‘½ä»¤ç»„ç»‡æ··ä¹± | ç”¨æˆ·ç•Œé¢ | 3 äººæ—¥ | UX å›¢é˜Ÿ |

**æ€»è®¡**: ~50 äººæ—¥

### ğŸŸ¡ P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆ1-2 ä¸ªæœˆï¼‰

| é—®é¢˜ | å½±å“å±‚çº§ | å·¥ä½œé‡ | è´Ÿè´£äººå»ºè®® |
|------|---------|--------|----------|
| é”™è¯¯å¤„ç†ä¸ç»Ÿä¸€ | å…¨å±€ | 10 äººæ—¥ | æ¶æ„å›¢é˜Ÿ |
| ç¼ºå°‘æ€§èƒ½ç›‘æ§ | å…¨å±€ | 8 äººæ—¥ | è¿ç»´å›¢é˜Ÿ |
| æµ‹è¯•è¦†ç›–ä¸è¶³ | å…¨å±€ | 15 äººæ—¥ | QA å›¢é˜Ÿ |
| æ–‡æ¡£ä¸å®Œæ•´ | å…¨å±€ | 12 äººæ—¥ | æ–‡æ¡£å›¢é˜Ÿ |
| é…ç½®éªŒè¯ä¸è¶³ | åŸºç¡€å±‚ | 5 äººæ—¥ | é…ç½®å›¢é˜Ÿ |
| äº¤äº’å¼å€’è®¡æ—¶ç¼ºå¤± | ä¸šåŠ¡å±‚ | 5 äººæ—¥ | UX å›¢é˜Ÿ |
| Agent-CIS åŒå‘ç»‘å®šä¸å®Œæ•´ | ä¸šåŠ¡å±‚ | 8 äººæ—¥ | é›†æˆå›¢é˜Ÿ |
| ç¼ºå¤±çš„ CLI å‘½ä»¤ | ç”¨æˆ·ç•Œé¢ | 5 äººæ—¥ | CLI å›¢é˜Ÿ |

**æ€»è®¡**: ~68 äººæ—¥

### ğŸ”µ P3 - ä½ä¼˜å…ˆçº§ï¼ˆé•¿æœŸä¼˜åŒ–ï¼‰

| é—®é¢˜ | å½±å“å±‚çº§ | å·¥ä½œé‡ |
|------|---------|--------|
| é…ç½®çƒ­é‡è½½ | åŸºç¡€å±‚ | 5 äººæ—¥ |
| å›½é™…åŒ–æ”¯æŒ | å…¨å±€ | 20 äººæ—¥ |
| æŠ€èƒ½å¸‚åœº | é›†æˆå±‚ | 15 äººæ—¥ |
| æŠ€èƒ½ç‰ˆæœ¬ç®¡ç† | æ‰§è¡Œå±‚ | 8 äººæ—¥ |

**æ€»è®¡**: ~48 äººæ—¥

---

## è¯¦ç»†è§£å†³æ–¹æ¡ˆ

### 1. å®‰å…¨é—®é¢˜è§£å†³æ–¹æ¡ˆ

#### 1.1 WASM æ²™ç®±å¢å¼º

**é—®é¢˜**: ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ä¸å®Œæ•´ï¼Œå¯èƒ½æƒé™æå‡

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/wasm/sandbox.rs

use wasmtime::{Config, Engine, Linker, Module, Store};
use wasmtime_wasi::{WasiCtx, WasiCtxBuilder};

pub struct SecureSandbox {
    engine: Engine,
    syscall_whitelist: HashSet<u64>,
}

impl SecureSandbox {
    pub fn new() -> Result<Self> {
        let mut config = Config::new();
        config.wasm_simd(true);
        config.consume_fuel(true);  // å¯ç”¨ç‡ƒæ–™é™åˆ¶

        let engine = Engine::new(&config)?;

        // ç³»ç»Ÿè°ƒç”¨ç™½åå•
        let mut syscall_whitelist = HashSet::new();
        // åªå…è®¸å®‰å…¨çš„ç³»ç»Ÿè°ƒç”¨
        for sysno in SAFE_SYSCALLS.iter() {
            syscall_whitelist.insert(*sysno);
        }

        Ok(Self { engine, syscall_whitelist })
    }

    pub fn validate_syscall(&self, sysno: u64) -> Result<()> {
        if !self.syscall_whitelist.contains(&sysno) {
            return Err(Error::SyscallNotAllowed(sysno));
        }
        Ok(())
    }

    pub async fn execute_skill(&self, wasm_bytes: &[u8],
                           fuel_limit: u64) -> Result<SkillOutput> {
        let module = Module::from_binary(&self.engine, wasm_bytes)?;

        let mut store = Store::new(&self.engine, WasiCtxBuilder::new().build());
        store.set_fuel(fuel_limit)?;

        // é…ç½®èµ„æºé™åˆ¶
        store.limiter(|state| &mut state.resource_limiter);

        // åˆ›å»ºé“¾æ¥å™¨ï¼Œåªå¯¼å‡ºå®‰å…¨çš„ Host å‡½æ•°
        let mut linker = Linker::new(&self.engine);
        self.add_safe_host_functions(&mut linker)?;

        // æ‰§è¡Œ
        let instance = linker.instantiate(&mut store, &module)?;
        // ... æ‰§è¡Œé€»è¾‘
    }
}

const SAFE_SYSCALLS: &[u64] = &[
    // æ–‡ä»¶æ“ä½œï¼ˆå—é™ï¼‰
    libc::SYS_READ,
    libc::SYS_WRITE,
    libc::SYS_CLOSE,
    // å†…å­˜æ“ä½œ
    libc::SYS_MMAP,
    libc::SYS_MUNMAP,
    libc::SYS_MREMAP,
    // æ—¶é—´
    libc::SYS_CLOCK_GETTIME,
    libc::SYS_GETTIMEOFDAY,
    // é€€å‡º
    libc::SYS_EXIT,
    libc::SYS_EXIT_GROUP,
];
```

**å®æ–½æ­¥éª¤**:
1. è®¾è®¡å®Œæ•´çš„ç³»ç»Ÿè°ƒç”¨ç™½åå•
2. å®ç° wasmtime æ²™ç®±
3. æ·»åŠ ç‡ƒæ–™ï¼ˆfuelï¼‰é™åˆ¶
4. å®ç°èµ„æºç›‘æ§å™¨
5. ç¼–å†™å®‰å…¨æµ‹è¯•ç”¨ä¾‹

**å·¥ä½œé‡**: 5 äººæ—¥

---

#### 1.2 åŠ å¯†å¯†é’¥æ”¹è¿›

**é—®é¢˜**: åŠ å¯†å¯†é’¥æ´¾ç”Ÿä½¿ç”¨å›ºå®šç›å€¼

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/memory/encryption.rs

use rand::Rng;
use argon2::{Argon2, Algorithm, Version, Params};

pub struct EncryptionKey {
    key: [u8; 32],
    salt: [u8; 32],
}

impl EncryptionKey {
    pub fn from_node_key_v2(node_key: &[u8], unique_id: &[u8]) -> Self {
        // ä¸ºæ¯ä¸ªèŠ‚ç‚¹ç”Ÿæˆå”¯ä¸€çš„ç›å€¼
        let mut rng = rand::thread_rng();
        let mut salt = [0u8; 32];
        rng.fill_bytes(&mut salt);

        // ä½¿ç”¨ Argon2idï¼ˆæ›´å®‰å…¨çš„å¯†é’¥æ´¾ç”Ÿï¼‰
        let mut key = [0u8; 32];

        let params = Params::new(4096, 3, 1);  // é«˜å®‰å…¨å‚æ•°
        let argon = Argon2::new(
            Algorithm::Argon2id,
            Version::Version13,
            params,
        );

        let mut context = node_key.to_vec();
        context.extend_from_slice(unique_id);
        context.extend_from_slice(b"cis-memory-v2");

        argon.hash_password_into(
            &context,
            &salt,
            &mut key,
        ).map_err(|e| Error::KeyDerivation(e.to_string()))?;

        Self { key, salt }
    }

    // å­˜å‚¨ç›å€¼ä»¥ä¾¿åç»­è§£å¯†
    pub fn to_storable(&self) -> Vec<u8> {
        let mut result = Vec::with_capacity(64);
        result.extend_from_slice(&self.salt);
        result.extend_from_slice(&self.key);
        result
    }

    pub fn from_storable(data: &[u8]) -> Result<Self> {
        if data.len() != 64 {
            return Err(Error::InvalidKeyData);
        }
        let mut salt = [0u8; 32];
        let mut key = [0u8; 32];
        salt.copy_from_slice(&data[0..32]);
        key.copy_from_slice(&data[32..64]);
        Ok(Self { key, salt })
    }
}
```

**å®æ–½æ­¥éª¤**:
1. è®¾è®¡æ–°çš„å¯†é’¥å­˜å‚¨æ ¼å¼ï¼ˆåŒ…å«ç›å€¼ï¼‰
2. å®ç° Argon2id å¯†é’¥æ´¾ç”Ÿ
3. æä¾›æ•°æ®è¿ç§»è„šæœ¬
4. æ›´æ–°æ‰€æœ‰åŠ å¯†/è§£å¯†è°ƒç”¨ç‚¹
5. æ·»åŠ å¯†é’¥å¼ºåº¦æµ‹è¯•

**å·¥ä½œé‡**: 2 äººæ—¥

---

#### 1.3 ACL æ—¶é—´æˆ³éªŒè¯

**é—®é¢˜**: ACL æ£€æŸ¥ç¼ºå°‘æ—¶é—´æˆ³ï¼Œå¯èƒ½å—é‡æ”¾æ”»å‡»

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/network/acl.rs

use std::time::{SystemTime, Duration};

#[derive(Clone, Debug, Serialize, Deserialize)]
pub struct AclEntry {
    pub id: String,
    pub permission: AclPermission,
    pub timestamp: SystemTime,
    pub expiry: Duration,
    pub signature: Vec<u8>,
}

impl AclEntry {
    pub fn new(id: String, permission: AclPermission,
              validity: Duration) -> Self {
        let timestamp = SystemTime::now();
        Self {
            id,
            permission,
            timestamp,
            expiry: validity,
            signature: Vec::new(),  // å¾…ç­¾å
        }
    }

    pub fn is_valid(&self) -> Result<()> {
        let now = SystemTime::now();

        // æ£€æŸ¥æ—¶é—´æˆ³æ˜¯å¦åœ¨æœªæ¥ï¼ˆæ—¶é’Ÿåå·®å®¹å·®ï¼‰
        let clock_tolerance = Duration::from_secs(60);
        if self.timestamp > now + clock_tolerance {
            return Err(Error::InvalidTimestamp);
        }

        // æ£€æŸ¥æ˜¯å¦è¿‡æœŸ
        let elapsed = now.duration_since(self.timestamp)
            .map_err(|_| Error::TimeWentBackwards)?;
        if elapsed > self.expiry {
            return Err(Error::AclExpired);
        }

        // éªŒè¯ç­¾å
        self.verify_signature()?;

        Ok(())
    }

    fn verify_signature(&self) -> Result<()> {
        // ä½¿ç”¨èŠ‚ç‚¹çš„å…¬é’¥éªŒè¯ç­¾å
        // ...
        Ok(())
    }
}
```

**å®æ–½æ­¥éª¤**:
1. æ›´æ–° ACL æ¡ç›®ç»“æ„
2. æ·»åŠ æ—¶é—´æˆ³å’Œæœ‰æ•ˆæœŸå­—æ®µ
3. å®ç°éªŒè¯é€»è¾‘
4. æ›´æ–° ACL ç­¾å/éªŒè¯æµç¨‹
5. å¤„ç†æ—¶é’Ÿåå·®é—®é¢˜

**å·¥ä½œé‡**: 3 äººæ—¥

---

### 2. å¹¶å‘å’Œå†…å­˜é—®é¢˜è§£å†³æ–¹æ¡ˆ

#### 2.1 é”è¶…æ—¶æœºåˆ¶

**é—®é¢˜**: é•¿æ—¶é—´æŒæœ‰é”å¯èƒ½å¯¼è‡´æ­»é”

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/memory/lock_timeout.rs

use tokio::time::timeout;
use std::sync::Arc;
use std::time::Duration;

pub struct AsyncRwLock<T> {
    inner: Arc<tokio::sync::RwLock<T>>,
    default_timeout: Duration,
}

impl<T> AsyncRwLock<T> {
    pub fn new(value: T, default_timeout: Duration) -> Self {
        Self {
            inner: Arc::new(tokio::sync::RwLock::new(value)),
            default_timeout,
        }
    }

    pub async fn read_with_timeout<'a>(&'a self)
        -> Result<AsyncRwLockReadGuard<'a, T>> {
        timeout(self.default_timeout, self.inner.read())
            .await
            .map_err(|_| Error::LockTimeout)?
    }

    pub async fn write_with_timeout<'a>(&'a self)
        -> Result<AsyncRwLockWriteGuard<'a, T>> {
        timeout(self.default_timeout, self.inner.write())
            .await
            .map_err(|_| Error::LockTimeout)?
    }
}

// ä½¿ç”¨ç¤ºä¾‹
// let lock = AsyncRwLock::new(data, Duration::from_secs(5));
// {
//     let guard = lock.read_with_timeout().await?;
//     // ä½¿ç”¨æ•°æ®
// }
```

**å®æ–½æ­¥éª¤**:
1. åˆ›å»ºå¸¦è¶…æ—¶çš„é”åŒ…è£…å™¨
2. å®šä¹‰åˆç†çš„è¶…æ—¶æ—¶é—´
3. æ›´æ–°æ‰€æœ‰é”ä½¿ç”¨ç‚¹
4. æ·»åŠ é”ç«äº‰ç›‘æ§

**å·¥ä½œé‡**: 4 äººæ—¥

---

#### 2.2 Agent èµ„æºæ¸…ç†

**é—®é¢˜**: Agent æ¸…ç†é€»è¾‘å¤æ‚ï¼Œå¯èƒ½å¯¼è‡´æ³„æ¼

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/agent/pool/cleanup.rs

use tokio::task::JoinHandle;

pub struct AgentGuard {
    agent: Option<PersistentAgent>,
    on_drop: Vec<Box<dyn FnOnce(PersistentAgent) + Send>>,
}

impl AgentGuard {
    pub fn new(agent: PersistentAgent) -> Self {
        Self {
            agent: Some(agent),
            on_drop: Vec::new(),
        }
    }

    pub fn on_drop<F>(mut self, f: F) -> Self
    where
        F: FnOnce(PersistentAgent) + Send + 'static,
    {
        self.on_drop.push(Box::new(f));
        self
    }

    pub fn agent(&self) -> &PersistentAgent {
        self.agent.as_ref().unwrap()
    }

    pub fn agent_mut(&mut self) -> &mut PersistentAgent {
        self.agent.as_mut().unwrap()
    }
}

impl Drop for AgentGuard {
    fn drop(&mut self) {
        if let Some(agent) = self.agent.take() {
            // æ‰§è¡Œæ‰€æœ‰æ¸…ç†å‡½æ•°
            for f in self.on_drop.drain(..) {
                f(agent.clone());
            }

            // å¼‚æ­¥å…³é—­ Agent
            let agent_clone = agent.clone();
            tokio::spawn(async move {
                let _ = tokio::time::timeout(
                    Duration::from_secs(30),
                    agent_clone.shutdown()
                ).await;
            });
        }
    }
}
```

**å®æ–½æ­¥éª¤**:
1. å®ç° RAII é£æ ¼çš„ Agent å®ˆå«
2. ç¡®ä¿æ‰€æœ‰ Agent éƒ½ä½¿ç”¨å®ˆå«ç®¡ç†
3. å®ç°æ¸…ç†ç›‘æ§å’ŒæŠ¥å‘Š
4. æ·»åŠ æ³„æ¼æ£€æµ‹æµ‹è¯•

**å·¥ä½œé‡**: 3 äººæ—¥

---

### 3. æ€§èƒ½ä¼˜åŒ–è§£å†³æ–¹æ¡ˆ

#### 3.1 äº‹ä»¶é©±åŠ¨è°ƒåº¦

**é—®é¢˜**: ä½¿ç”¨ç¡¬ç¼–ç è½®è¯¢ï¼Œæ•ˆç‡ä½ä¸‹

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/scheduler/event_driven.rs

use tokio::sync::{Notify, broadcast};
use tokio::select;

pub struct EventDrivenScheduler {
    ready_notify: Arc<Notify>,
    completion_tx: broadcast::Sender<TaskCompletion>,
}

impl EventDrivenScheduler {
    pub async fn run(&self) -> Result<()> {
        let mut rx = self.completion_tx.subscribe();

        loop {
            select! {
                // ç­‰å¾…ä»»åŠ¡å°±ç»ªé€šçŸ¥
                _ = self.ready_notify.notified() => {
                    self.process_ready_tasks().await?;
                }
                // ç­‰å¾…ä»»åŠ¡å®Œæˆé€šçŸ¥
                result = rx.recv() => {
                    if let Ok(completion) = result {
                        self.handle_completion(completion).await?;
                    }
                }
                // å®šæœŸå¥åº·æ£€æŸ¥
                _ = tokio::time::sleep(Duration::from_secs(60)) => {
                    self.health_check().await?;
                }
            }
        }
    }

    fn notify_task_ready(&self) {
        self.ready_notify.notify_one();
    }

    fn notify_completion(&self, completion: TaskCompletion) -> Result<()> {
        self.completion_tx.send(completion)?;
        Ok(())
    }
}
```

**å®æ–½æ­¥éª¤**:
1. è®¾è®¡äº‹ä»¶é©±åŠ¨æ¶æ„
2. å®ç°é€šçŸ¥æœºåˆ¶
3. æ›´æ–°ä»»åŠ¡è°ƒåº¦å™¨
4. æ·»åŠ æ€§èƒ½ç›‘æ§
5. å¯¹æ¯”åŸºå‡†æµ‹è¯•

**å·¥ä½œé‡**: 5 äººæ—¥

---

#### 3.2 å‘é‡æœç´¢ä¼˜åŒ–

**é—®é¢˜**: fallback æ¨¡å¼æ€§èƒ½å·®

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/vector/search_optimized.rs

pub struct HybridVectorSearch {
    hnsw_index: HnswIndex,
    sqlite_index: SqliteIndex,
    fallback_threshold: usize,
}

impl HybridVectorSearch {
    pub async fn search(&self, query: &[f32], top_k: usize)
        -> Result<Vec<SearchResult>> {
        let index_size = self.hnsw_index.size();

        if index_size > self.fallback_threshold {
            // ä½¿ç”¨ HNSW ç´¢å¼•
            self.hnsw_index.search(query, top_k).await
        } else {
            // ä½¿ç”¨æ‰¹é‡åŠ è½½çš„ SQLite æœç´¢
            self.sqlite_index.batch_search(query, top_k).await
        }
    }

    pub async fn smart_fallback(&self, query: &[f32], top_k: usize)
        -> Result<Vec<SearchResult>> {
        // å¹¶è¡Œå°è¯•ä¸¤ç§æ–¹æ³•
        let (hnsw_result, sqlite_result) = tokio::join!(
            self.hnsw_index.search(query, top_k * 2),
            self.sqlite_index.batch_search(query, top_k * 2)
        );

        // åˆå¹¶ç»“æœ
        self.merge_results(hnsw_result?, sqlite_result?, top_k)
    }

    fn merge_results(&self,
                    mut hnsw: Vec<SearchResult>,
                    mut sqlite: Vec<SearchResult>,
                    top_k: usize) -> Result<Vec<SearchResult>> {
        // å»é‡å¹¶æŒ‰åˆ†æ•°æ’åº
        hnsw.append(&mut sqlite);
        hnsw.sort_by(|a, b| b.score.partial_cmp(&a.score).unwrap());

        // å»é‡
        let mut seen = HashSet::new();
        let mut result = Vec::new();
        for item in hnsw {
            if seen.insert(item.id.clone()) {
                result.push(item);
                if result.len() >= top_k {
                    break;
                }
            }
        }

        Ok(result)
    }
}
```

**å®æ–½æ­¥éª¤**:
1. å®ç°æ™ºèƒ½åˆ‡æ¢é€»è¾‘
2. æ·»åŠ æ‰¹é‡åŠ è½½ä¼˜åŒ–
3. å®ç°ç»“æœåˆå¹¶å’Œå»é‡
4. æ€§èƒ½åŸºå‡†æµ‹è¯•
5. æ·»åŠ è‡ªé€‚åº”é˜ˆå€¼è°ƒæ•´

**å·¥ä½œé‡**: 5 äººæ—¥

---

### 4. æ¶æ„é‡æ„è§£å†³æ–¹æ¡ˆ

#### 4.1 æ¨¡å—æ‹†åˆ†

**é—®é¢˜**: MemoryService å’Œ CisApp ç±»è¿‡äºåºå¤§

**è§£å†³æ–¹æ¡ˆ**:

**MemoryService æ‹†åˆ†**:
```
cis-core/src/memory/
â”œâ”€â”€ service.rs          # ä¸»æœåŠ¡ï¼ˆç²¾ç®€åï¼‰
â”œâ”€â”€ ops/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ get.rs         # GET æ“ä½œ
â”‚   â”œâ”€â”€ set.rs         # SET æ“ä½œ
â”‚   â”œâ”€â”€ search.rs      # æœç´¢æ“ä½œ
â”‚   â””â”€â”€ sync.rs        # åŒæ­¥æ“ä½œ
â””â”€â”€ crypto/
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ encryption.rs  # åŠ å¯†
    â””â”€â”€ key_management.rs  # å¯†é’¥ç®¡ç†
```

**CisApp æ‹†åˆ†**:
```
cis-gui/src/
â”œâ”€â”€ app.rs             # ä¸»åº”ç”¨ï¼ˆç²¾ç®€åï¼‰
â”œâ”€â”€ view_models/
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ main.rs        # ä¸»è§†å›¾æ¨¡å‹
â”‚   â”œâ”€â”€ node.rs        # èŠ‚ç‚¹è§†å›¾
â”‚   â”œâ”€â”€ terminal.rs    # ç»ˆç«¯è§†å›¾
â”‚   â””â”€â”€ decision.rs    # å†³ç­–è§†å›¾
â””â”€â”€ controllers/
    â”œâ”€â”€ mod.rs
    â”œâ”€â”€ node_controller.rs
    â””â”€â”€ task_controller.rs
```

**å·¥ä½œé‡**: 8 äººæ—¥

---

#### 4.2 DAG å®šä¹‰ç»Ÿä¸€

**é—®é¢˜**: TaskDag å’Œ DagDefinition é‡å¤

**è§£å†³æ–¹æ¡ˆ**:
```rust
// cis-core/src/scheduler/unified_dag.rs

#[derive(Clone, Debug, Serialize, Deserialize)]
pub struct UnifiedDag {
    pub metadata: DagMetadata,
    pub tasks: Vec<UnifiedTask>,
    pub execution_policy: ExecutionPolicy,
}

#[derive(Clone, Debug, Serialize, Deserialize)]
pub struct UnifiedTask {
    pub id: String,
    pub name: String,
    pub skill: String,
    pub deps: Vec<String>,
    #[serde(flatten)]
    pub level: TaskLevel,
    pub params: Map<String, Value>,
}

impl UnifiedDag {
    // ä» TaskDag è½¬æ¢
    pub fn from_task_dag(dag: TaskDag) -> Result<Self> {
        // ...
    }

    // ä» DagDefinition è½¬æ¢
    pub fn from_definition(def: DagDefinition) -> Result<Self> {
        // ...
    }

    // ç»Ÿä¸€çš„æ‰§è¡Œæ–¹æ³•
    pub async fn execute(&self, executor: &dyn Executor)
        -> Result<DagResult> {
        // ç»Ÿä¸€æ‰§è¡Œé€»è¾‘
    }
}
```

**å·¥ä½œé‡**: 3 äººæ—¥

---

## å®æ–½è·¯çº¿å›¾

### Phase 1: å®‰å…¨åŠ å›ºï¼ˆWeek 1-2ï¼‰

**ç›®æ ‡**: ä¿®å¤æ‰€æœ‰ä¸¥é‡å®‰å…¨é—®é¢˜

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| WASM æ²™ç®±å¢å¼º | å®‰å…¨å›¢é˜Ÿ | 5 äººæ—¥ | - |
| åŠ å¯†å¯†é’¥æ”¹è¿› | å®‰å…¨å›¢é˜Ÿ | 2 äººæ—¥ | - |
| ACL æ—¶é—´æˆ³éªŒè¯ | ç½‘ç»œå›¢é˜Ÿ | 3 äººæ—¥ | - |
| é…ç½®æ–‡ä»¶åŠ å¯† | å®‰å…¨å›¢é˜Ÿ | 3 äººæ—¥ | - |
| æƒé™æ§åˆ¶å®ç° | å®‰å…¨å›¢é˜Ÿ | 5 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: æ‰€æœ‰ P0 å®‰å…¨é—®é¢˜ä¿®å¤å®Œæˆ

### Phase 2: ç¨³å®šæ€§æ”¹è¿›ï¼ˆWeek 3-4ï¼‰

**ç›®æ ‡**: è§£å†³å¹¶å‘å’Œå†…å­˜é—®é¢˜

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| é”è¶…æ—¶æœºåˆ¶ | å¹¶å‘ä¸“å®¶ | 4 äººæ—¥ | - |
| Agent èµ„æºæ¸…ç† | Rust å›¢é˜Ÿ | 3 äººæ—¥ | - |
| çº¿ç¨‹å®‰å…¨ä¿®å¤ | Rust å›¢é˜Ÿ | 2 äººæ—¥ | - |
| å†…å­˜æ³„æ¼æ£€æµ‹ | QA å›¢é˜Ÿ | 3 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: æ‰€æœ‰ P0 å¹¶å‘é—®é¢˜ä¿®å¤å®Œæˆ

### Phase 3: æ€§èƒ½ä¼˜åŒ–ï¼ˆWeek 5-8ï¼‰

**ç›®æ ‡**: æ¶ˆé™¤ä¸»è¦æ€§èƒ½ç“¶é¢ˆ

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| äº‹ä»¶é©±åŠ¨è°ƒåº¦ | æ€§èƒ½å›¢é˜Ÿ | 5 äººæ—¥ | - |
| å‘é‡æœç´¢ä¼˜åŒ– | æ€§èƒ½å›¢é˜Ÿ | 5 äººæ—¥ | - |
| DHT å®ç°é‡æ„ | ç½‘ç»œå›¢é˜Ÿ | 8 äººæ—¥ | - |
| æŸ¥è¯¢ç¼“å­˜ | æ•°æ®å›¢é˜Ÿ | 3 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: æ ¸å¿ƒæ€§èƒ½é—®é¢˜è§£å†³ï¼Œå“åº”æ—¶é—´æå‡ 50%+

### Phase 4: æ¶æ„é‡æ„ï¼ˆWeek 9-12ï¼‰

**ç›®æ ‡**: ä¼˜åŒ–æ¶æ„ï¼Œæé«˜å¯ç»´æŠ¤æ€§

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| æ¨¡å—æ‹†åˆ† | æ¶æ„å›¢é˜Ÿ | 8 äººæ—¥ | - |
| DAG å®šä¹‰ç»Ÿä¸€ | æ¶æ„å›¢é˜Ÿ | 3 äººæ—¥ | - |
| CLI é‡æ„ | UX å›¢é˜Ÿ | 3 äººæ—¥ | - |
| é”™è¯¯å¤„ç†ç»Ÿä¸€ | æ¶æ„å›¢é˜Ÿ | 10 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: ä»£ç å¯ç»´æŠ¤æ€§æ˜¾è‘—æå‡

### Phase 5: åŠŸèƒ½å®Œå–„ï¼ˆWeek 13-16ï¼‰

**ç›®æ ‡**: è¡¥å……ç¼ºå¤±åŠŸèƒ½

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| Matrix åè®®å®Œå–„ | ç½‘ç»œå›¢é˜Ÿ | 10 äººæ—¥ | - |
| MCP åè®®å®Œå–„ | é›†æˆå›¢é˜Ÿ | 8 äººæ—¥ | - |
| CLI å‘½ä»¤è¡¥å…… | CLI å›¢é˜Ÿ | 5 äººæ—¥ | - |
| äº¤äº’å¼å€’è®¡æ—¶ | UX å›¢é˜Ÿ | 5 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: æ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§è¾¾åˆ° 90%+

### Phase 6: è´¨é‡æå‡ï¼ˆWeek 17-20ï¼‰

**ç›®æ ‡**: æå‡æµ‹è¯•è¦†ç›–å’Œæ–‡æ¡£

| ä»»åŠ¡ | è´Ÿè´£äºº | å·¥ä½œé‡ | ä¾èµ– |
|------|---------|--------|------|
| æµ‹è¯•è¦†ç›–æå‡ | QA å›¢é˜Ÿ | 15 äººæ—¥ | - |
| æ–‡æ¡£å®Œå–„ | æ–‡æ¡£å›¢é˜Ÿ | 12 äººæ—¥ | - |
| æ€§èƒ½ç›‘æ§ | è¿ç»´å›¢é˜Ÿ | 8 äººæ—¥ | - |

**é‡Œç¨‹ç¢‘**: æµ‹è¯•è¦†ç›– 70%+ï¼Œæ–‡æ¡£å®Œæ•´åº¦ 80%+

---

## éªŒæ”¶æ ‡å‡†

### å®‰å…¨æ€§

- âœ… WASM æ²™ç®±é€šè¿‡å®‰å…¨å®¡è®¡
- âœ… æ‰€æœ‰åŠ å¯†ä½¿ç”¨ Argon2id
- âœ… ACL é€šè¿‡é‡æ”¾æ”»å‡»æµ‹è¯•
- âœ… é…ç½®æ–‡ä»¶åŠ å¯†éªŒè¯
- âœ… æƒé™æ§åˆ¶è¦†ç›–ç‡ 100%

### æ€§èƒ½

- âœ… DAG è°ƒåº¦å»¶è¿Ÿ < 100ms
- âœ… å‘é‡æœç´¢ QPS > 1000
- âœ… P2P è¿æ¥å»ºç«‹ < 2s
- âœ… å†…å­˜æ³„æ¼ 0
- âœ… æ­»é” 0

### åŠŸèƒ½

- âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæ•´æ€§ 90%+
- âœ… åè®®å®ç°ç¬¦åˆè§„èŒƒ
- âœ… CLI å‘½ä»¤å®Œæ•´
- âœ… GUI åŠŸèƒ½å®Œæ•´

### è´¨é‡

- âœ… æµ‹è¯•è¦†ç›–ç‡ 70%+
- âœ… æ–‡æ¡£å®Œæ•´åº¦ 80%+
- âœ… ä»£ç é‡å¤ < 5%
- âœ… ä»£ç å®¡æŸ¥é€šè¿‡ç‡ 100%

---

## é£é™©ä¸ç¼“è§£

### é«˜é£é™©é¡¹

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| WASM æ²™ç®±é‡æ„å¼•å…¥æ–° bug | é«˜ | ä¸­ | å……åˆ†æµ‹è¯•ã€ç°åº¦å‘å¸ƒ |
| DHT é‡æ„å½±å“ç½‘ç»œç¨³å®šæ€§ | é«˜ | ä¸­ | ä¿ç•™æ—§å®ç°ã€é€æ­¥è¿ç§» |
| æ¶æ„é‡æ„å¯¼è‡´å¤§é‡ä¿®æ”¹ | ä¸­ | é«˜ | åˆ†é˜¶æ®µå®æ–½ã€ä»£ç å®¡æŸ¥ |
| æ€§èƒ½ä¼˜åŒ–æ•ˆæœä¸è¾¾é¢„æœŸ | ä¸­ | ä½ | åŸºå‡†æµ‹è¯•éªŒè¯ |

---

## èµ„æºéœ€æ±‚

### äººåŠ›èµ„æº

| è§’è‰² | äººæ•° | æ—¶é—´ |
|------|------|------|
| Rust å®‰å…¨ä¸“å®¶ | 2 | 4 å‘¨ |
| ç½‘ç»œå·¥ç¨‹å¸ˆ | 3 | 8 å‘¨ |
| æ€§èƒ½å·¥ç¨‹å¸ˆ | 2 | 4 å‘¨ |
| æ¶æ„å¸ˆ | 2 | 8 å‘¨ |
| QA å·¥ç¨‹å¸ˆ | 3 | 12 å‘¨ |
| æ–‡æ¡£å·¥ç¨‹å¸ˆ | 1 | 8 å‘¨ |
| é¡¹ç›®ç»ç† | 1 | 20 å‘¨ |

### å·¥å…·å’ŒåŸºç¡€è®¾æ–½

- æ€§èƒ½æµ‹è¯•ç¯å¢ƒ
- å®‰å…¨å®¡è®¡å·¥å…·
- CI/CD å¢å¼º
- ç›‘æ§ç³»ç»Ÿå‡çº§

---

## é™„å½•

### A. å‚è€ƒæ–‡æ¡£

- [ä»£ç å®¡é˜…æ‘˜è¦](../user/code-review-summary.md)
- [å„å±‚çº§è¯¦ç»†å®¡é˜…æŠ¥å‘Š](../user/)

### B. ç›¸å…³ RFC

- RFC-001: WASM æ²™ç®±é‡æ„æ–¹æ¡ˆ
- RFC-002: äº‹ä»¶é©±åŠ¨è°ƒåº¦æ¶æ„
- RFC-003: ç»Ÿä¸€é”™è¯¯å¤„ç†æ¡†æ¶

### C. å˜æ›´æ—¥å¿—æ¨¡æ¿

```markdown
## [v1.1.6] - 2026-XX-XX

### å®‰å…¨æ€§
- ä¿®å¤ WASM æ²™ç®±å®‰å…¨æ¼æ´ (CVE-XXXX-XXXX)
- æ”¹è¿›åŠ å¯†å¯†é’¥æ´¾ç”Ÿç®—æ³•
- æ·»åŠ  ACL æ—¶é—´æˆ³éªŒè¯

### æ€§èƒ½
- å®ç°äº‹ä»¶é©±åŠ¨è°ƒåº¦ï¼Œå»¶è¿Ÿé™ä½ 60%
- ä¼˜åŒ–å‘é‡æœç´¢ï¼Œååé‡æå‡ 3x
- æ·»åŠ æŸ¥è¯¢ç¼“å­˜ï¼Œå“åº”æ—¶é—´å‡å°‘ 40%

### åŠŸèƒ½
- è¡¥å…… Matrix åè®®ç«¯ç‚¹
- æ·»åŠ é…ç½®ç®¡ç†å‘½ä»¤
- å®ç°äº¤äº’å¼å€’è®¡æ—¶

### æ¶æ„
- é‡æ„ MemoryServiceï¼Œæ‹†åˆ†ä¸º 5 ä¸ªå­æ¨¡å—
- ç»Ÿä¸€ DAG å®šä¹‰
- é‡æ„ CLI å‘½ä»¤åˆ†ç»„

### æµ‹è¯•
- æµ‹è¯•è¦†ç›–ç‡ä» 45% æå‡è‡³ 72%
- æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•å¥—ä»¶
- æ–°å¢ 200+ å®‰å…¨æµ‹è¯•ç”¨ä¾‹

### æ–‡æ¡£
- è¡¥å……æ¶æ„è®¾è®¡æ–‡æ¡£
- æ–°å¢å¼€å‘è€…æŒ‡å—
- æ›´æ–° API æ–‡æ¡£
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2026-02-12
**ç»´æŠ¤è€…**: CIS å›¢é˜Ÿ

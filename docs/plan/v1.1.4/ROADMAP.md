# CIS v1.1.4 版本路线图

> 目标版本: v1.1.4  
> 版本主题: 简化实现清理与核心功能完善  
> 计划周期: 4-6 周

---

## 版本目标

解决 v1.1.3 版本中发现的 **70+ 处简化实现**，优先修复阻塞性功能，提升核心模块稳定性。

### 关键指标

- 修复所有 🔴 P0 级别问题 (4项)
- 完成 80% 🟡 P1 级别问题 (8/10项)
- 代码测试覆盖率提升至 75%+

---

## 阶段划分

### Phase 1: WASM 执行修复 (Week 1-2)

**目标**: 使 WASM Skill 可用

| 任务 | 负责人 | 工作量 | 依赖 |
|------|--------|--------|------|
| WASM 运行时集成 | TBD | 5d | - |
| AI 回调接入 Provider | TBD | 3d | - |
| Matrix Bridge WASM 调用 | TBD | 3d | 运行时集成 |
| WASM 内存管理优化 | TBD | 2d | - |
| 测试用例补充 | TBD | 2d | - |

**交付物**:
- [ ] WASM Skill 可以正常执行
- [ ] 至少 3 个示例 WASM Skill 运行通过
- [ ] 文档更新

---

### Phase 2: P2P 网络完善 (Week 2-3)

**目标**: 实现稳定的节点间通信

| 任务 | 负责人 | 工作量 | 优先级 |
|------|--------|--------|--------|
| 连接处理循环实现 | TBD | 3d | P0 |
| 心跳机制实现 | TBD | 2d | P0 |
| DHT 路由表完善 | TBD | 4d | P1 |
| XOR 距离计算修复 | TBD | 1d | P1 |
| NAT Relay 打洞 | TBD | 3d | P1 |
| 主题订阅实现 | TBD | 2d | P2 |

**交付物**:
- [ ] 节点间双向通信稳定
- [ ] 自动发现和连接
- [ ] DHT 键值存储可用

---

### Phase 3: Agent 联邦 (Week 3-4)

**目标**: 实现联邦 Agent 基础功能

| 任务 | 负责人 | 工作量 | 优先级 |
|------|--------|--------|--------|
| 节点 ID 配置获取 | TBD | 1d | P1 |
| 联邦心跳发送 | TBD | 2d | P1 |
| Matrix 事件订阅 | TBD | 3d | P0 |
| 远程任务处理 | TBD | 4d | P0 |
| OpenCode 进程扫描 | TBD | 2d | P1 |

**交付物**:
- [ ] 联邦 Agent 可以互相发现
- [ ] 远程任务分发可用
- [ ] Agent 状态监控

---

### Phase 4: 调度器完善 (Week 4-5)

**目标**: 完善 Skill 执行能力

| 任务 | 负责人 | 工作量 | 优先级 |
|------|--------|--------|--------|
| Remote Skill 执行 | TBD | 3d | P1 |
| DAG Skill 递归执行 | TBD | 3d | P1 |
| 交互式倒计时 | TBD | 2d | P1 |
| 执行时间统计 | TBD | 1d | P2 |

**交付物**:
- [ ] 所有 Skill 类型可执行
- [ ] 决策流程完善

---

### Phase 5: CLI & 监控 (Week 5-6)

**目标**: 提升 CLI 体验和系统可观测性

| 任务 | 负责人 | 工作量 | 优先级 |
|------|--------|--------|--------|
| Worker 资源监控真实数据 | TBD | 3d | P1 |
| 日志跟随实现 | TBD | 2d | P2 |
| 终端 Resize 支持 | TBD | 2d | P2 |
| 统一命令完善 | TBD | 2d | P2 |

---

## 依赖关系图

```
Phase 1: WASM 运行时
    │
    ▼
Phase 2: P2P 传输 ◄──────┐
    │                    │
    ▼                    │
Phase 3: Agent 联邦 ─────┤
    │                    │
    ▼                    │
Phase 4: 调度器 ─────────┘
    │
    ▼
Phase 5: CLI 完善
```

---

## 风险评估

| 风险 | 概率 | 影响 | 缓解措施 |
|------|------|------|---------|
| WASM 运行时复杂性 | 中 | 高 | 提前调研，预留缓冲时间 |
| P2P NAT 穿透难度 | 高 | 中 | 考虑使用成熟库 (libp2p) |
| Matrix 协议变更 | 低 | 中 | 锁定协议版本 |
| 资源不足 | 中 | 高 | 优先 P0，分期交付 |

---

## 验收标准

### 功能验收

- [ ] `cis skill run <wasm-skill>` 成功执行
- [ ] `cis node peer list` 显示已连接节点
- [ ] `cis agent federate` 建立联邦连接
- [ ] `cis dag run` 完成跨节点任务分发

### 性能验收

- [ ] WASM 启动时间 < 100ms
- [ ] P2P 连接建立 < 5s
- [ ] 联邦任务分发 < 1s

### 稳定性验收

- [ ] 节点运行 7 天不崩溃
- [ ] 网络断开后自动重连
- [ ] 内存使用稳定无泄漏

---

## 相关文档

- [简化实现分析报告](./SIMPLIFIED_IMPLEMENTATION_ANALYSIS.md)
- [WASM 执行设计](./designs/WASM_EXECUTION.md) (待创建)
- [P2P 网络协议](./designs/P2P_PROTOCOL.md) (待创建)
- [Agent 联邦协议](./designs/FEDERATION_PROTOCOL.md) (待创建)

---

*创建日期: 2026-02-10*  
*最后更新: 2026-02-10*

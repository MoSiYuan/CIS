# Agent Teams 任务追踪表

**使用说明**: 复制此表格到项目管理工具（如 GitHub Projects/Notion）

---

## Phase 1: 基础抽象层 (Week 1)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 1.1 | PersistentAgent Trait 定义 | 🔵 | TBD | 8h | - | P0 | 核心抽象 |
| 1.1.1 | trait 接口设计 | | | 4h | | | |
| 1.1.2 | 文档注释编写 | | | 2h | | | |
| 1.1.3 | 单元测试框架 | | | 2h | | | |
| 1.2 | AgentPool 实现 | 🔵 | TBD | 16h | 1.1 | P0 | 资源管理 |
| 1.2.1 | Pool 结构设计 | | | 4h | | | |
| 1.2.2 | acquire/release 逻辑 | | | 6h | | | |
| 1.2.3 | 健康检查机制 | | | 4h | | | |
| 1.2.4 | 资源限制实现 | | | 2h | | | |
| 1.3 | AgentCommandConfig 扩展 | 🔵 | TBD | 4h | - | P1 | 配置支持 |
| 1.3.1 | OpenCode 持久化配置 | | | 2h | | | |
| 1.3.2 | Claude 持久化配置 | | | 2h | | | |

**Phase 1 总计**: 28h  
**里程碑**: [M1] 基础抽象层完成

---

## Phase 2: OpenCode Runtime (Week 2)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 2.1 | 调研 OpenCode `-p` 模式 | 🔵 | TBD | 8h | - | P0 | 阻塞项 |
| 2.1.1 | `-p` 参数行为调研 | | | 3h | | | |
| 2.1.2 | socket 协议分析 | | | 3h | | | |
| 2.1.3 | attach/detach 机制 | | | 2h | | | |
| 2.2 | OpenCodePersistentAgent 实现 | 🔵 | TBD | 24h | 1.1, 2.1 | P0 | 核心实现 |
| 2.2.1 | Agent 启动逻辑 | | | 6h | | | spawn -p |
| 2.2.2 | Socket 通信实现 | | | 6h | | | UnixStream |
| 2.2.3 | execute() 方法 | | | 4h | | | 任务执行 |
| 2.2.4 | attach/detach 实现 | | | 4h | | | 前后台切换 |
| 2.2.5 | 状态监控（心跳） | | | 4h | | | 健康检测 |
| 2.3 | OpenCode 集成测试 | 🔵 | TBD | 8h | 2.2 | P1 | 质量保证 |
| 2.3.1 | Agent 创建/销毁测试 | | | 2h | | | |
| 2.3.2 | 任务执行测试 | | | 2h | | | |
| 2.3.3 | attach/detach 测试 | | | 2h | | | |
| 2.3.4 | 异常恢复测试 | | | 2h | | | |

**Phase 2 总计**: 40h  
**里程碑**: [M2] OpenCode Runtime 完成

---

## Phase 3: Claude Runtime (Week 3)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 3.1 | AgentSession 持久化扩展 | 🔵 | TBD | 12h | 1.1 | P0 | 基础改造 |
| 3.1.1 | persistent 标记添加 | | | 2h | | | |
| 3.1.2 | 生命周期管理修改 | | | 4h | | | |
| 3.1.3 | 外部输入发送支持 | | | 4h | | | |
| 3.1.4 | 状态导出功能 | | | 2h | | | |
| 3.2 | ClaudePersistentAgent 实现 | 🔵 | TBD | 20h | 3.1 | P0 | 核心实现 |
| 3.2.1 | AgentSession 封装 | | | 6h | | | |
| 3.2.2 | execute() PTY 实现 | | | 6h | | | |
| 3.2.3 | attach() 复用 | | | 4h | | | |
| 3.2.4 | 输出收集机制 | | | 4h | | | |
| 3.3 | Claude 集成测试 | 🔵 | TBD | 8h | 3.2 | P1 | 质量保证 |
| 3.3.1 | Session 持久化测试 | | | 2h | | | |
| 3.3.2 | 多轮对话测试 | | | 2h | | | |
| 3.3.3 | attach/detach 测试 | | | 2h | | | |
| 3.3.4 | 并发 Session 测试 | | | 2h | | | |

**Phase 3 总计**: 40h  
**里程碑**: [M3] Claude Runtime 完成

---

## Phase 4: DAG 集成 (Week 4)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 4.1 | DagTask 结构扩展 | 🔵 | TBD | 8h | 1.1 | P0 | 数据结构 |
| 4.1.1 | 结构定义更新 | | | 2h | | | |
| 4.1.2 | YAML 解析支持 | | | 3h | | | |
| 4.1.3 | JSON 序列化 | | | 2h | | | |
| 4.1.4 | 向后兼容 | | | 1h | | | |
| 4.2 | MultiAgentDagExecutor 实现 | 🔵 | TBD | 24h | 1.2, 2.2, 3.2, 4.1 | P0 | 核心实现 |
| 4.2.1 | 执行器框架 | | | 6h | | | |
| 4.2.2 | Agent 获取逻辑 | | | 6h | | | 复用/创建 |
| 4.2.3 | 任务执行循环 | | | 6h | | | |
| 4.2.4 | 结果收集更新 | | | 4h | | | |
| 4.2.5 | 异常处理回滚 | | | 2h | | | |
| 4.3 | CLI 命令扩展 | 🔵 | TBD | 12h | 4.2 | P1 | 用户接口 |
| 4.3.1 | `cis agent` 子命令 | | | 6h | | | |
| 4.3.2 | `cis dag run` 扩展 | | | 4h | | | |
| 4.3.3 | 帮助文档 | | | 2h | | | |
| 4.4 | DAG 集成测试 | 🔵 | TBD | 12h | 4.2, 4.3 | P1 | 质量保证 |
| 4.4.1 | 单 Agent DAG | | | 3h | | | |
| 4.4.2 | 多 Agent 混合 | | | 3h | | | |
| 4.4.3 | Agent 复用场景 | | | 3h | | | |
| 4.4.4 | 长时间运行 | | | 3h | | | |

**Phase 4 总计**: 56h  
**里程碑**: [M4] DAG 集成完成

---

## Phase 5: 跨节点通信 (Week 5)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 5.1 | Agent 联邦协议设计 | 🔵 | TBD | 12h | - | P0 | 协议规范 |
| 5.1.1 | Event 结构定义 | | | 4h | | | |
| 5.1.2 | 路由规则设计 | | | 4h | | | |
| 5.1.3 | 协议文档编写 | | | 4h | | | |
| 5.2 | FederatedAgent 实现 | 🔵 | TBD | 24h | 5.1 | P0 | 核心实现 |
| 5.2.1 | 本地 Agent 包装 | | | 6h | | | |
| 5.2.2 | Event 发送 | | | 6h | | | Matrix |
| 5.2.3 | Event 接收 | | | 6h | | | Matrix |
| 5.2.4 | 消息路由 | | | 4h | | | |
| 5.2.5 | 跨节点发现 | | | 2h | | | |
| 5.3 | 跨节点集成测试 | 🔵 | TBD | 12h | 5.2 | P1 | 质量保证 |
| 5.3.1 | Agent 发现 | | | 3h | | | |
| 5.3.2 | 点对点消息 | | | 3h | | | |
| 5.3.3 | 广播消息 | | | 3h | | | |
| 5.3.4 | 分区恢复 | | | 3h | | | |

**Phase 5 总计**: 48h  
**里程碑**: [M5] 跨节点通信完成

---

## Phase 6: 测试优化 & 文档 (Week 6)

| ID | 任务 | 状态 | 负责人 | 工时 | 依赖 | 优先级 | 备注 |
|----|------|------|--------|------|------|--------|------|
| 6.1 | 性能测试 | 🔵 | TBD | 12h | 全部 | P1 | 性能基准 |
| 6.1.1 | 启动时间对比 | | | 3h | | | |
| 6.1.2 | 内存占用测试 | | | 3h | | | |
| 6.1.3 | 并发上限测试 | | | 3h | | | |
| 6.1.4 | 跨节点延迟 | | | 3h | | | |
| 6.2 | 端到端测试 | 🔵 | TBD | 16h | 全部 | P0 | 全面验证 |
| 6.2.1 | 复杂工作流 | | | 4h | | | |
| 6.2.2 | 24h 稳定性 | | | 4h | | | |
| 6.2.3 | 故障注入 | | | 4h | | | |
| 6.2.4 | 性能基准 | | | 4h | | | |
| 6.3 | 文档编写 | 🔵 | TBD | 16h | 全部 | P1 | 知识沉淀 |
| 6.3.1 | 架构文档 | | | 4h | | | |
| 6.3.2 | API 文档 | | | 4h | | | rustdoc |
| 6.3.3 | 用户指南 | | | 4h | | | |
| 6.3.4 | 部署指南 | | | 4h | | | |

**Phase 6 总计**: 44h  
**里程碑**: [M6] 项目完成

---

## 汇总

| Phase | 任务数 | 总工时 | 关键任务 |
|-------|--------|--------|----------|
| Phase 1 | 3 | 28h | 1.1, 1.2 |
| Phase 2 | 3 | 40h | 2.1, 2.2 |
| Phase 3 | 3 | 40h | 3.1, 3.2 |
| Phase 4 | 4 | 56h | 4.2 |
| Phase 5 | 3 | 48h | 5.2 |
| Phase 6 | 3 | 44h | 6.2 |
| **总计** | **19** | **256h** | - |

**按 8h/天计算**: 32 人天 ≈ 6.4 周  
**缓冲 10%**: 约 7 周

---

## 关键路径

```
1.1 ──► 1.2 ──► 2.2 ──► 3.2 ──► 4.2 ──► 6.2
        │       │       │       │
        ▼       ▼       ▼       ▼
       2.1     2.3     3.3     4.4
```

**关键任务**: 1.1 → 1.2 → 2.2 → 3.2 → 4.2 → 6.2

---

## 周会检查清单

### 每周检查项

- [ ] 本周计划任务完成率
- [ ] 是否有阻塞任务（🔴）
- [ ] 下周任务是否准备就绪
- [ ] 技术债务是否累积
- [ ] 是否需要调整计划

### 里程碑检查

| 里程碑 | 日期 | 检查项 | 状态 |
|--------|------|--------|------|
| M1 | Week 1 结束 | Trait + Pool 可用 | ⬜ |
| M2 | Week 2 结束 | OpenCode 可运行 | ⬜ |
| M3 | Week 3 结束 | Claude 可运行 | ⬜ |
| M4 | Week 4 结束 | DAG 多 Agent 可用 | ⬜ |
| M5 | Week 5 结束 | 跨节点通信可用 | ⬜ |
| M6 | Week 6 结束 | 项目交付 | ⬜ |

---

## 风险追踪

| 风险ID | 描述 | 概率 | 影响 | 缓解措施 | 负责人 | 状态 |
|--------|------|------|------|----------|--------|------|
| R1 | OpenCode `-p` 不稳定 | 中 | 高 | 准备 fallback | TBD | ⏸️ |
| R2 | Matrix 延迟高 | 低 | 中 | 本地缓存 | TBD | ⏸️ |
| R3 | PTY 兼容性 | 中 | 中 | 多平台 CI | TBD | ⏸️ |
| R4 | 内存泄漏 | 中 | 高 | 压力测试 | TBD | ⏸️ |

**图例**: ⏸️ 监控中 | ⚠️ 需关注 | 🔥 紧急处理

---

**任务追踪表完成**

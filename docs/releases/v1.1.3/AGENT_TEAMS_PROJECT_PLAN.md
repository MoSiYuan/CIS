# Agent Teams é¡¹ç›®å®æ–½è®¡åˆ’

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¥æœŸ**: 2026-02-09  
**é¢„ä¼°å·¥æœŸ**: 6 å‘¨  
**è´Ÿè´£äºº**: TBD

---

## 1. é¡¹ç›®æ¦‚è§ˆ

### 1.1 ç›®æ ‡
å®ç° CIS Agent Teams ç³»ç»Ÿï¼Œæ”¯æŒå¤š Agent æŒä¹…åŒ–ã€è·¨èŠ‚ç‚¹åä½œã€çµæ´»çš„å‰åå°åˆ‡æ¢ã€‚

### 1.2 å…³é”®äº¤ä»˜ç‰©
- PersistentAgent æŠ½è±¡å±‚
- OpenCode `-p` æ¨¡å¼æ”¯æŒ
- Claude PTY æŒä¹…åŒ–æ”¯æŒ
- MultiAgentDagExecutor
- è·¨èŠ‚ç‚¹ Matrix Federation é›†æˆ

### 1.3 é‡Œç¨‹ç¢‘

```
Week 1: [M1] åŸºç¡€æŠ½è±¡å±‚å®Œæˆ
    â”‚
Week 2: [M2] OpenCode Runtime å®Œæˆ
    â”‚
Week 3: [M3] Claude Runtime å®Œæˆ
    â”‚
Week 4: [M4] DAG é›†æˆå®Œæˆ
    â”‚
Week 5: [M5] è·¨èŠ‚ç‚¹é€šä¿¡å®Œæˆ
    â”‚
Week 6: [M6] æµ‹è¯•ä¼˜åŒ– & æ–‡æ¡£
```

---

## 2. ä»»åŠ¡æ‹†åˆ†

### Phase 1: åŸºç¡€æŠ½è±¡å±‚ (Week 1)

#### ä»»åŠ¡ 1.1: å®šä¹‰ PersistentAgent Trait
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 8h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: æ— 

```rust
// æ–‡ä»¶: cis-core/src/agent/persistent/mod.rs
pub trait PersistentAgent: Send + Sync {
    fn agent_id(&self) -> &str;
    fn runtime_type(&self) -> RuntimeType;
    async fn execute(&self, task: TaskRequest) -> Result<TaskResult>;
    async fn status(&self) -> AgentStatus;
    async fn attach(&self) -> Result<()>;
    async fn detach(&self) -> Result<()>;
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] trait å®šä¹‰å®Œæˆ
- [ ] æ–‡æ¡£æ³¨é‡Šå®Œæ•´
- [ ] å•å…ƒæµ‹è¯•æ¡†æ¶æ­å»º

---

#### ä»»åŠ¡ 1.2: å®ç° AgentPool
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 16h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 1.1

```rust
// æ–‡ä»¶: cis-core/src/agent/persistent/pool.rs
pub struct AgentPool {
    runtimes: HashMap<RuntimeType, Box<dyn AgentRuntime>>,
    agents: Arc<RwLock<HashMap<String, Box<dyn PersistentAgent>>>>,
    config: PoolConfig,
}
```

**å­ä»»åŠ¡**:
- [ ] 1.2.1 Pool ç»“æ„è®¾è®¡ (4h)
- [ ] 1.2.2 acquire/release é€»è¾‘ (6h)
- [ ] 1.2.3 å¥åº·æ£€æŸ¥æœºåˆ¶ (4h)
- [ ] 1.2.4 èµ„æºé™åˆ¶ï¼ˆæœ€å¤§ Agent æ•°ï¼‰(2h)

**éªŒæ”¶æ ‡å‡†**:
- [ ] Agent åˆ›å»º/é”€æ¯æ­£å¸¸
- [ ] èµ„æºä¸Šé™æ§åˆ¶æœ‰æ•ˆ
- [ ] å¥åº·æ£€æŸ¥è‡ªåŠ¨é‡å¯æ•…éšœ Agent

---

#### ä»»åŠ¡ 1.3: æ‰©å±• AgentCommandConfig
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 4h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: æ— 

```rust
// æ–‡ä»¶: cis-core/src/agent/config.rs
impl AgentCommandConfig {
    pub fn opencode_persistent() -> Self {
        Self {
            command: "opencode".to_string(),
            base_args: vec!["run".to_string(), "-p".to_string()],  // -p åå°æ¨¡å¼
            requires_pty: false,  // åå°æ¨¡å¼ä¸éœ€è¦ PTY
            supports_attach: true,
        }
    }
}
```

**éªŒæ”¶æ ‡å‡†**:
- [ ] OpenCode æŒä¹…åŒ–é…ç½®å®Œæˆ
- [ ] Claude æŒä¹…åŒ–é…ç½®å®Œæˆ
- [ ] é…ç½®å‚æ•°éªŒè¯

---

### Phase 2: OpenCode Runtime (Week 2)

#### ä»»åŠ¡ 2.1: è°ƒç ” OpenCode `-p` æ¨¡å¼
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 8h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: æ— 

**è°ƒç ”å†…å®¹**:
- [ ] `-p` å‚æ•°å…·ä½“è¡Œä¸º
- [ ] socket é€šä¿¡åè®®
- [ ] attach/detach æœºåˆ¶
- [ ] è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†

**äº¤ä»˜ç‰©**:
- [ ] è°ƒç ”æŠ¥å‘Šæ–‡æ¡£
- [ ] åè®®è§„èŒƒæ–‡æ¡£
- [ ] ç¤ºä¾‹ä»£ç 

---

#### ä»»åŠ¡ 2.2: å®ç° OpenCodePersistentAgent
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 24h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 1.1, 2.1

```rust
// æ–‡ä»¶: cis-core/src/agent/persistent/opencode.rs
pub struct OpenCodePersistentAgent {
    agent_id: String,
    socket_path: PathBuf,
    pid: u32,
    state: Arc<RwLock<AgentState>>,
}
```

**å­ä»»åŠ¡**:
- [ ] 2.2.1 Agent å¯åŠ¨é€»è¾‘ï¼ˆspawn -pï¼‰(6h)
- [ ] 2.2.2 Socket é€šä¿¡å®ç° (6h)
- [ ] 2.2.3 execute() æ–¹æ³• (4h)
- [ ] 2.2.4 attach/detach å®ç° (4h)
- [ ] 2.2.5 çŠ¶æ€ç›‘æ§ï¼ˆå¿ƒè·³æ£€æµ‹ï¼‰(4h)

**éªŒæ”¶æ ‡å‡†**:
- [ ] Agent åå°å¯åŠ¨æˆåŠŸ
- [ ] socket é€šä¿¡æ­£å¸¸
- [ ] attach è¿›å…¥äº¤äº’å¼ç»ˆç«¯
- [ ] detach è¿”å›åå°ç»§ç»­è¿è¡Œ

---

#### ä»»åŠ¡ 2.3: OpenCode é›†æˆæµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 8h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 2.2

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] Agent åˆ›å»º/é”€æ¯
- [ ] ä»»åŠ¡æ‰§è¡Œï¼ˆå•æ¬¡ï¼‰
- [ ] ä»»åŠ¡æ‰§è¡Œï¼ˆå¤šæ¬¡å¤ç”¨ï¼‰
- [ ] attach/detach åˆ‡æ¢
- [ ] å¼‚å¸¸æ¢å¤ï¼ˆAgent å´©æºƒï¼‰

---

### Phase 3: Claude Runtime (Week 3)

#### ä»»åŠ¡ 3.1: æ‰©å±• AgentSession æ”¯æŒæŒä¹…åŒ–
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 1.1

```rust
// æ–‡ä»¶: cis-core/src/agent/cluster/session.rs
impl AgentSession {
    /// æ ‡è®°ä¸ºæŒä¹…åŒ–ï¼ˆä¸è‡ªåŠ¨é”€æ¯ï¼‰
    pub fn set_persistent(&mut self, persistent: bool) {
        self.persistent = persistent;
    }
    
    /// æ£€æŸ¥æ˜¯å¦åº”è¯¥è‡ªåŠ¨é”€æ¯
    pub fn should_auto_destroy(&self) -> bool {
        !self.persistent && self.is_idle()
    }
}
```

**å­ä»»åŠ¡**:
- [ ] 3.1.1 æ·»åŠ  persistent æ ‡è®° (2h)
- [ ] 3.1.2 ä¿®æ”¹ç”Ÿå‘½å‘¨æœŸç®¡ç† (4h)
- [ ] 3.1.3 æ”¯æŒå¤–éƒ¨è¾“å…¥å‘é€ (4h)
- [ ] 3.1.4 çŠ¶æ€å¯¼å‡ºåŠŸèƒ½ (2h)

---

#### ä»»åŠ¡ 3.2: å®ç° ClaudePersistentAgent
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 20h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 3.1

```rust
// æ–‡ä»¶: cis-core/src/agent/persistent/claude.rs
pub struct ClaudePersistentAgent {
    session_id: SessionId,
    session_manager: &'static SessionManager,
    input_tx: mpsc::UnboundedSender<Vec<u8>>,
    persistent: bool,
}
```

**å­ä»»åŠ¡**:
- [ ] 3.2.1 åŸºäº AgentSession å°è£… (6h)
- [ ] 3.2.2 execute() å®ç°ï¼ˆé€šè¿‡ PTYï¼‰(6h)
- [ ] 3.2.3 attach() å¤ç”¨ç°æœ‰åŠŸèƒ½ (4h)
- [ ] 3.2.4 è¾“å‡ºæ”¶é›†æœºåˆ¶ (4h)

**éªŒæ”¶æ ‡å‡†**:
- [ ] Session æŒä¹…åŒ–è¿è¡Œ
- [ ] å¤šæ¬¡ execute å¤ç”¨åŒä¸€ä¸ª Session
- [ ] attach æŸ¥çœ‹å®æ—¶è¾“å‡º

---

#### ä»»åŠ¡ 3.3: Claude é›†æˆæµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 8h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 3.2

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] Session æŒä¹…åŒ–ä¿æŒ
- [ ] å¤šè½®å¯¹è¯ Context ä¿ç•™
- [ ] attach/detach åŠŸèƒ½
- [ ] å¹¶å‘ Session ç®¡ç†

---

### Phase 4: DAG é›†æˆ (Week 4)

#### ä»»åŠ¡ 4.1: æ‰©å±• DagTask ç»“æ„
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 8h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 1.1

```rust
// æ–‡ä»¶: cis-core/src/scheduler/mod.rs
pub struct DagTask {
    pub task_id: String,
    pub dependencies: Vec<String>,
    pub skill_id: Option<String>,
    
    // === æ–°å¢å­—æ®µ ===
    pub agent_runtime: Option<RuntimeType>,
    pub reuse_agent: Option<String>,
    pub keep_agent: bool,
    pub agent_config: Option<AgentConfig>,
}
```

**å­ä»»åŠ¡**:
- [ ] 4.1.1 ç»“æ„å®šä¹‰æ›´æ–° (2h)
- [ ] 4.1.2 YAML è§£ææ”¯æŒ (3h)
- [ ] 4.1.3 JSON åºåˆ—åŒ–æ”¯æŒ (2h)
- [ ] 4.1.4 å‘åå…¼å®¹å¤„ç† (1h)

---

#### ä»»åŠ¡ 4.2: å®ç° MultiAgentDagExecutor
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 24h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 1.2, 2.2, 3.2, 4.1

```rust
// æ–‡ä»¶: cis-core/src/scheduler/multi_agent_executor.rs
pub struct MultiAgentDagExecutor {
    scheduler: DagScheduler,
    agent_pool: AgentPool,
    context_store: ContextStore,
}
```

**å­ä»»åŠ¡**:
- [ ] 4.2.1 æ‰§è¡Œå™¨æ¡†æ¶æ­å»º (6h)
- [ ] 4.2.2 Agent è·å–é€»è¾‘ï¼ˆå¤ç”¨/åˆ›å»ºï¼‰(6h)
- [ ] 4.2.3 ä»»åŠ¡æ‰§è¡Œå¾ªç¯ (6h)
- [ ] 4.2.4 ç»“æœæ”¶é›†ä¸çŠ¶æ€æ›´æ–° (4h)
- [ ] 4.2.5 å¼‚å¸¸å¤„ç†ä¸å›æ»š (2h)

**éªŒæ”¶æ ‡å‡†**:
- [ ] DAG æ­£å¸¸æ‰§è¡Œ
- [ ] ä¸åŒ Task ä½¿ç”¨ä¸åŒ Agent
- [ ] Agent å¤ç”¨æ­£å¸¸
- [ ] æ‰§è¡Œåæ­£ç¡®é‡Šæ”¾/ä¿æŒ Agent

---

#### ä»»åŠ¡ 4.3: CLI å‘½ä»¤æ‰©å±•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 4.2

```bash
# æ–°å¢å‘½ä»¤
cis agent list                    # åˆ—å‡ºè¿è¡Œä¸­çš„ Agent
cis agent attach <agent-id>       # é™„åŠ åˆ° Agent
cis agent detach <agent-id>       # åˆ†ç¦» Agent
cis agent kill <agent-id>         # å¼ºåˆ¶ç»ˆæ­¢ Agent

cis dag run <file> --agent-runtime claude    # æŒ‡å®šé»˜è®¤ Runtime
```

**å­ä»»åŠ¡**:
- [ ] 4.3.1 `cis agent` å­å‘½ä»¤ (6h)
- [ ] 4.3.2 `cis dag run` å‚æ•°æ‰©å±• (4h)
- [ ] 4.3.3 å¸®åŠ©æ–‡æ¡£æ›´æ–° (2h)

---

#### ä»»åŠ¡ 4.4: DAG é›†æˆæµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 4.2, 4.3

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] å• Agent DAG æ‰§è¡Œ
- [ ] å¤š Agent æ··åˆ DAG
- [ ] Agent å¤ç”¨åœºæ™¯
- [ ] å¼‚å¸¸ä»»åŠ¡é‡è¯•
- [ ] é•¿æ—¶é—´è¿è¡Œ DAG

---

### Phase 5: è·¨èŠ‚ç‚¹é€šä¿¡ (Week 5)

#### ä»»åŠ¡ 5.1: Agent è”é‚¦åè®®è®¾è®¡
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: æ— 

```rust
// Matrix Event æ‰©å±•
pub struct AgentFederationEvent {
    pub event_type: String,  // "m.agent.message"
    pub from_agent: String,  // "agent-id@node-id"
    pub to_agent: Option<String>,  // None = å¹¿æ’­
    pub payload: serde_json::Value,
}
```

**äº¤ä»˜ç‰©**:
- [ ] åè®®è§„èŒƒæ–‡æ¡£
- [ ] Event ç»“æ„å®šä¹‰
- [ ] è·¯ç”±è§„åˆ™è®¾è®¡

---

#### ä»»åŠ¡ 5.2: å®ç° FederatedAgent
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 24h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 5.1

```rust
// æ–‡ä»¶: cis-core/src/agent/persistent/federated.rs
pub struct FederatedAgent {
    local_agent: Box<dyn PersistentAgent>,
    room_id: String,
    matrix_client: Arc<MatrixClient>,
}
```

**å­ä»»åŠ¡**:
- [ ] 5.2.1 æœ¬åœ° Agent åŒ…è£… (6h)
- [ ] 5.2.2 Matrix Event å‘é€ (6h)
- [ ] 5.2.3 Matrix Event æ¥æ”¶ (6h)
- [ ] 5.2.4 æ¶ˆæ¯è·¯ç”±é€»è¾‘ (4h)
- [ ] 5.2.5 è·¨èŠ‚ç‚¹å‘ç°æœºåˆ¶ (2h)

---

#### ä»»åŠ¡ 5.3: è·¨èŠ‚ç‚¹é›†æˆæµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: 5.2

**æµ‹è¯•ç¯å¢ƒ**:
- Node A (æœ¬åœ° Docker)
- Node B (æœ¬åœ° Docker)

**æµ‹è¯•ç”¨ä¾‹**:
- [ ] è·¨èŠ‚ç‚¹ Agent å‘ç°
- [ ] ç‚¹å¯¹ç‚¹æ¶ˆæ¯ä¼ é€’
- [ ] å¹¿æ’­æ¶ˆæ¯
- [ ] ç½‘ç»œåˆ†åŒºæ¢å¤

---

### Phase 6: æµ‹è¯•ä¼˜åŒ– & æ–‡æ¡£ (Week 6)

#### ä»»åŠ¡ 6.1: æ€§èƒ½æµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 12h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: å…¨éƒ¨

**æµ‹è¯•é¡¹**:
- [ ] Agent å¯åŠ¨æ—¶é—´å¯¹æ¯”
- [ ] å†…å­˜å ç”¨æµ‹è¯•
- [ ] å¹¶å‘ Agent æ•°ä¸Šé™
- [ ] è·¨èŠ‚ç‚¹å»¶è¿Ÿæµ‹è¯•

---

#### ä»»åŠ¡ 6.2: ç«¯åˆ°ç«¯æµ‹è¯•
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 16h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: å…¨éƒ¨

**æµ‹è¯•åœºæ™¯**:
- [ ] å¤æ‚å¤š Agent å·¥ä½œæµ
- [ ] 24 å°æ—¶ç¨³å®šæ€§æµ‹è¯•
- [ ] æ•…éšœæ³¨å…¥æµ‹è¯•
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•

---

#### ä»»åŠ¡ 6.3: æ–‡æ¡£ç¼–å†™
**çŠ¶æ€**: ğŸ”µ å¾…å¼€å§‹  
**å·¥æ—¶**: 16h  
**è´Ÿè´£äºº**: TBD  
**ä¾èµ–**: å…¨éƒ¨

**æ–‡æ¡£æ¸…å•**:
- [ ] æ¶æ„è®¾è®¡æ–‡æ¡£
- [ ] API æ–‡æ¡£ï¼ˆrustdocï¼‰
- [ ] ç”¨æˆ·æŒ‡å—ï¼ˆYAML é…ç½®ï¼‰
- [ ] å¼€å‘è€…æŒ‡å—ï¼ˆæ‰©å±• Runtimeï¼‰
- [ ] éƒ¨ç½²æŒ‡å—

---

## 3. é¡¹ç›®æ—¶é—´è¡¨

### 3.1 ç”˜ç‰¹å›¾

```
Week:  1        2        3        4        5        6
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤

Phase 1: åŸºç¡€æŠ½è±¡
[1.1] â–ˆâ–ˆâ–ˆâ–ˆ
[1.2] â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[1.3] â–ˆâ–ˆ

Phase 2: OpenCode
[2.1]         â–ˆâ–ˆâ–ˆâ–ˆ
[2.2]         â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[2.3]                  â–ˆâ–ˆâ–ˆâ–ˆ

Phase 3: Claude
[3.1]                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[3.2]                        â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[3.3]                              â–ˆâ–ˆâ–ˆâ–ˆ

Phase 4: DAG
[4.1]   â–‘â–‘â–‘â–‘                       â–‘â–‘  (ä¾èµ– 1.1)
[4.2]                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[4.3]                                  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[4.4]                                      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Phase 5: è”é‚¦
[5.1]   â–‘â–‘â–‘â–‘                       â–‘â–‘  (ç‹¬ç«‹)
[5.2]                                      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[5.3]                                          â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Phase 6: æ”¶å°¾
[6.1]                                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[6.2]                                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ
[6.3]                                              â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ

Legend: â–ˆâ–ˆâ–ˆâ–ˆ = ä¸»è¦ä»»åŠ¡    â–‘â–‘â–‘â–‘ = ä¾èµ–ç­‰å¾…
```

### 3.2 å…³é”®è·¯å¾„

```
1.1 (PersistentAgent Trait)
    â”‚
    â–¼
1.2 (AgentPool)
    â”‚
    â–¼
2.2 (OpenCodePersistentAgent)
    â”‚
    â–¼
3.2 (ClaudePersistentAgent)
    â”‚
    â–¼
4.2 (MultiAgentDagExecutor)  â† å…³é”®é‡Œç¨‹ç¢‘
    â”‚
    â–¼
6.2 (ç«¯åˆ°ç«¯æµ‹è¯•)
```

---

## 4. èµ„æºéœ€æ±‚

### 4.1 äººåŠ›

| è§’è‰² | äººæ•° | èŒè´£ |
|------|------|------|
| æ ¸å¿ƒå¼€å‘è€… | 1 | Phase 1-5 ä¸»è¦å¼€å‘ |
| æµ‹è¯•å·¥ç¨‹å¸ˆ | 1 | Phase 6 æµ‹è¯• |
| æŠ€æœ¯å†™ä½œè€… | 0.5 | æ–‡æ¡£ç¼–å†™ |

### 4.2 å¼€å‘ç¯å¢ƒ

- [ ] macOS/Linux å¼€å‘æœº
- [ ] Docker ç¯å¢ƒï¼ˆè·¨èŠ‚ç‚¹æµ‹è¯•ï¼‰
- [ ] Claude Code CLI è®¸å¯
- [ ] OpenCode CLI å®‰è£…

### 4.3 ä¾èµ–åº“

```toml
# å¯èƒ½éœ€è¦æ–°å¢
tokio-serde = "0.9"          # socket åºåˆ—åŒ–
tokio-util = "0.7"           # codec
matrix-sdk = "0.7"           # Matrix å®¢æˆ·ç«¯ï¼ˆå¦‚æœªæ·»åŠ ï¼‰
```

---

## 5. é£é™©ç®¡ç†

### 5.1 æŠ€æœ¯é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| OpenCode `-p` ä¸ç¨³å®š | ä¸­ | é«˜ | å‡†å¤‡ fallback åˆ°æ™®é€šæ¨¡å¼ |
| Matrix Federation å»¶è¿Ÿé«˜ | ä½ | ä¸­ | æœ¬åœ°ç¼“å­˜ + å¼‚æ­¥æ¶ˆæ¯ |
| PTY è·¨å¹³å°å…¼å®¹æ€§ | ä¸­ | ä¸­ | CI å¤šå¹³å°æµ‹è¯• |
| å†…å­˜æ³„æ¼ï¼ˆé•¿æœŸè¿è¡Œï¼‰ | ä¸­ | é«˜ | å®šæœŸå‹åŠ›æµ‹è¯• |

### 5.2 è¿›åº¦é£é™©

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| è°ƒç ”æ—¶é—´è¶…é¢„æœŸ | é«˜ | ä¸­ | Week 2 é¢„ç•™ç¼“å†² |
| Claude æ¨¡å¼å˜æ›´ | ä½ | é«˜ | å…³æ³¨å®˜æ–¹æ›´æ–° |
| è·¨èŠ‚ç‚¹æµ‹è¯•å¤æ‚ | ä¸­ | ä¸­ | ç®€åŒ–æµ‹è¯•ç¯å¢ƒ |

### 5.3 é£é™©ç›‘æ§

**æ¯å‘¨æ£€æŸ¥ç‚¹**:
- [ ] ä»»åŠ¡å®Œæˆç‡
- [ ] é˜»å¡é—®é¢˜åˆ—è¡¨
- [ ] æŠ€æœ¯å€ºåŠ¡ç§¯ç´¯
- [ ] æ€§èƒ½æŒ‡æ ‡

---

## 6. æˆåŠŸæŒ‡æ ‡

### 6.1 åŠŸèƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| Agent å¯åŠ¨æ—¶é—´ | < 1sï¼ˆå¤ç”¨ï¼‰vs 3-5sï¼ˆæ–°å»ºï¼‰|
| å¹¶å‘ Agent æ•° | â‰¥ 10 |
| è·¨èŠ‚ç‚¹å»¶è¿Ÿ | < 100msï¼ˆå±€åŸŸç½‘ï¼‰|
| æ•…éšœæ¢å¤æ—¶é—´ | < 5s |

### 6.2 è´¨é‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| å•å…ƒæµ‹è¯•è¦†ç›–ç‡ | â‰¥ 80% |
| é›†æˆæµ‹è¯•é€šè¿‡ç‡ | 100% |
| ç«¯åˆ°ç«¯æµ‹è¯•åœºæ™¯ | â‰¥ 5 ä¸ª |
| æ–‡æ¡£å®Œæ•´åº¦ | 100% |

### 6.3 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡ |
|------|------|
| å†…å­˜å ç”¨ | < 100MB/Agent |
| CPU å ç”¨ | < 10%ï¼ˆç©ºé—²ï¼‰|
| æ¶ˆæ¯åå | > 100 msg/s |

---

## 7. é™„å½•

### 7.1 å‚è€ƒæ–‡æ¡£

- [AGENT_TEAMS_REVISED_DESIGN.md](AGENT_TEAMS_REVISED_DESIGN.md) - æ¶æ„è®¾è®¡
- [AGENT_TEAMS_IMPROVEMENTS.md](AGENT_TEAMS_IMPROVEMENTS.md) - æå‡åˆ†æ
- [CLAUDE_AGENT_TEAMS_COMMUNICATION_REPORT.md](CLAUDE_AGENT_TEAMS_COMMUNICATION_REPORT.md) - æœºåˆ¶ç ”ç©¶

### 7.2 æœ¯è¯­è¡¨

| æœ¯è¯­ | å®šä¹‰ |
|------|------|
| PersistentAgent | æŒä¹…åŒ– Agentï¼Œå¯å¤ç”¨ |
| AgentPool | Agent å®ä¾‹æ±  |
| RuntimeType | Agent è¿è¡Œæ—¶ç±»å‹ï¼ˆClaude/OpenCodeï¼‰|
| FederatedAgent | è·¨èŠ‚ç‚¹è”é‚¦ Agent |
| attach/detach | å‰åå°åˆ‡æ¢ |

### 7.3 ä»»åŠ¡çŠ¶æ€å›¾

```
ğŸ”µ å¾…å¼€å§‹ â†’ ğŸŸ¡ è¿›è¡Œä¸­ â†’ ğŸŸ¢ å·²å®Œæˆ
              â†“
           ğŸ”´ é˜»å¡
```

---

**é¡¹ç›®è®¡åˆ’å®Œæˆ - å‡†å¤‡æ‰§è¡Œ**

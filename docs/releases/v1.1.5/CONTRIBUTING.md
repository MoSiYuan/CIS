# è´¡çŒ®æŒ‡å—

æ„Ÿè°¢æ‚¨å¯¹ CIS (Cluster of Independent Systems) é¡¹ç›®çš„å…³æ³¨ï¼æœ¬æ–‡æ¡£å°†å¸®åŠ©æ‚¨äº†è§£å¦‚ä½•å‚ä¸åˆ° CIS çš„å¼€å‘ä¸­ã€‚

## ç›®å½•

- [è¡Œä¸ºå‡†åˆ™](#è¡Œä¸ºå‡†åˆ™)
- [å¦‚ä½•è´¡çŒ®](#å¦‚ä½•è´¡çŒ®)
- [å¼€å‘ç¯å¢ƒè®¾ç½®](#å¼€å‘ç¯å¢ƒè®¾ç½®)
- [ä»£ç è§„èŒƒ](#ä»£ç è§„èŒƒ)
- [æäº¤ä¿¡æ¯è§„èŒƒ](#æäº¤ä¿¡æ¯è§„èŒƒ)
- [Pull Request æµç¨‹](#pull-request-æµç¨‹)
- [ç‰ˆæœ¬å‘å¸ƒ](#ç‰ˆæœ¬å‘å¸ƒ)

---

## è¡Œä¸ºå‡†åˆ™

å‚ä¸æœ¬é¡¹ç›®å³è¡¨ç¤ºæ‚¨åŒæ„éµå®ˆä»¥ä¸‹å‡†åˆ™ï¼š

- å°Šé‡æ‰€æœ‰å‚ä¸è€…ï¼Œæ— è®ºå…¶èƒŒæ™¯å¦‚ä½•
- æ¥å—å»ºè®¾æ€§çš„æ‰¹è¯„ï¼Œå¹¶ä»¥ä¼˜é›…çš„æ–¹å¼å¤„ç†
- å…³æ³¨å¯¹ç¤¾åŒºæœ€æœ‰åˆ©çš„äº‹æƒ…
- å¯¹å…¶ä»–ç¤¾åŒºæˆå‘˜è¡¨ç¤ºåŒç†å¿ƒ

---

## å¦‚ä½•è´¡çŒ®

### æŠ¥å‘Š Bug

å¦‚æœæ‚¨å‘ç°äº† Bugï¼Œè¯·é€šè¿‡ [GitHub Issues](https://github.com/MoSiYuan/CIS/issues) æŠ¥å‘Šï¼Œå¹¶åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **é—®é¢˜æè¿°**ï¼šæ¸…æ™°ç®€æ´åœ°æè¿° Bug
2. **å¤ç°æ­¥éª¤**ï¼šè¯¦ç»†çš„æ­¥éª¤è¯´æ˜
3. **æœŸæœ›è¡Œä¸º**ï¼šè¯´æ˜æ‚¨æœŸæœ›å‘ç”Ÿä»€ä¹ˆ
4. **å®é™…è¡Œä¸º**ï¼šè¯´æ˜å®é™…å‘ç”Ÿäº†ä»€ä¹ˆ
5. **ç¯å¢ƒä¿¡æ¯**ï¼š
   - æ“ä½œç³»ç»ŸåŠç‰ˆæœ¬
   - CIS ç‰ˆæœ¬ (`cis --version`)
   - Rust ç‰ˆæœ¬ (`rustc --version`)
6. **é™„åŠ ä¿¡æ¯**ï¼šæˆªå›¾ã€æ—¥å¿—ç­‰

### å»ºè®®æ–°åŠŸèƒ½

æˆ‘ä»¬æ¬¢è¿æ–°åŠŸèƒ½å»ºè®®ï¼è¯·é€šè¿‡ GitHub Issues æäº¤ï¼Œå¹¶åŒ…å«ï¼š

1. **åŠŸèƒ½æè¿°**ï¼šæ¸…æ™°æè¿°æ‚¨æƒ³è¦çš„åŠŸèƒ½
2. **ä½¿ç”¨åœºæ™¯**ï¼šè¯´æ˜ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¸ªåŠŸèƒ½
3. **é¢„æœŸè¡Œä¸º**ï¼šæè¿°åŠŸèƒ½çš„å…·ä½“è¡Œä¸º
4. **å¯èƒ½çš„å®ç°æ–¹æ¡ˆ**ï¼ˆå¯é€‰ï¼‰

### æäº¤ä»£ç 

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºæ‚¨çš„ç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. æäº¤æ‚¨çš„ä¿®æ”¹ (`git commit -m 'feat: add some amazing feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
5. å¼€å¯ä¸€ä¸ª Pull Request

---

## å¼€å‘ç¯å¢ƒè®¾ç½®

### å‰ç½®è¦æ±‚

- **Rust** 1.70 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Git**
- **SQLite** 3.40+ (ç”¨äºå¼€å‘æµ‹è¯•)

### å¿«é€Ÿå¼€å§‹

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/MoSiYuan/CIS.git
cd CIS

# å®‰è£…å¼€å‘ä¾èµ–
./scripts/install/setup-dev.sh

# æ„å»ºé¡¹ç›®
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test --all-features

# æœ¬åœ°å®‰è£…
cargo install --path cis-node
```

### å¼€å‘å·¥å…·æ¨è

- **IDE**: VS Code æˆ– RustRover
- **VS Code æ‰©å±•**:
  - rust-analyzer
  - Even Better TOML
  - CodeLLDB (è°ƒè¯•)

### é¡¹ç›®ç»“æ„

```
CIS/
â”œâ”€â”€ cis-core/          # æ ¸å¿ƒåº“
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ agent/     # Agent æŠ½è±¡
â”‚   â”‚   â”œâ”€â”€ memory/    # è®°å¿†ç³»ç»Ÿ
â”‚   â”‚   â”œâ”€â”€ network/   # ç½‘ç»œæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ p2p/       # P2P ç½‘ç»œ
â”‚   â”‚   â”œâ”€â”€ matrix/    # Matrix è”é‚¦
â”‚   â”‚   â”œâ”€â”€ scheduler/ # DAG è°ƒåº¦å™¨
â”‚   â”‚   â”œâ”€â”€ skill/     # Skill ç³»ç»Ÿ
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ tests/         # é›†æˆæµ‹è¯•
â”œâ”€â”€ cis-node/          # CLI å…¥å£
â”‚   â””â”€â”€ src/commands/  # å‘½ä»¤å®ç°
â”œâ”€â”€ cis-gui/           # GUI åº”ç”¨
â”œâ”€â”€ cis-skill-sdk/     # Skill SDK
â”œâ”€â”€ skills/            # å†…ç½® Skill
â””â”€â”€ docs/              # æ–‡æ¡£
```

---

## ä»£ç è§„èŒƒ

### Rust ç¼–ç è§„èŒƒ

æˆ‘ä»¬éµå¾ª [Rust API Guidelines](https://rust-lang.github.io/api-guidelines/) å’Œä»¥ä¸‹è§„åˆ™ï¼š

#### æ ¼å¼åŒ–

```bash
# è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
cargo fmt

# æ£€æŸ¥æ ¼å¼
cargo fmt -- --check
```

#### Lint

```bash
# è¿è¡Œ Clippy
cargo clippy --all-features -- -D warnings
```

#### å‘½åè§„èŒƒ

- **æ¨¡å—/æ–‡ä»¶**: `snake_case`
- **ç±»å‹/ç»“æ„ä½“**: `PascalCase`
- **å‡½æ•°/å˜é‡**: `snake_case`
- **å¸¸é‡**: `SCREAMING_SNAKE_CASE`
- **ç‰¹æ€§**: `snake_case`

#### æ–‡æ¡£

- æ‰€æœ‰å…¬å…± API å¿…é¡»æœ‰æ–‡æ¡£æ³¨é‡Š
- ä½¿ç”¨ `///` ä¸ºå‡½æ•°å’Œç±»å‹æ·»åŠ æ–‡æ¡£
- ä½¿ç”¨ `//!` ä¸ºæ¨¡å—æ·»åŠ æ–‡æ¡£
- åŒ…å«ç¤ºä¾‹ä»£ç 

```rust
/// è®¡ç®—ä¸¤ä¸ªæ•°çš„å’Œ
///
/// # Examples
///
/// ```
/// let sum = add(2, 3);
/// assert_eq!(sum, 5);
/// ```
pub fn add(a: i32, b: i32) -> i32 {
    a + b
}
```

#### é”™è¯¯å¤„ç†

- ä½¿ç”¨ `thiserror` å®šä¹‰é”™è¯¯ç±»å‹
- ä½¿ç”¨ `anyhow` è¿›è¡Œé”™è¯¯ä¼ æ’­
- é¿å…ä½¿ç”¨ `unwrap()` å’Œ `expect()`ï¼Œä½¿ç”¨ `?` æ“ä½œç¬¦

```rust
use thiserror::Error;

#[derive(Error, Debug)]
pub enum MyError {
    #[error("IO error: {0}")]
    Io(#[from] std::io::Error),
    
    #[error("invalid input: {0}")]
    InvalidInput(String),
}

pub type Result<T> = std::result::Result<T, MyError>;
```

### æµ‹è¯•è§„èŒƒ

#### å•å…ƒæµ‹è¯•

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_add() {
        assert_eq!(add(2, 3), 5);
    }

    #[test]
    #[should_panic(expected = "overflow")]
    fn test_add_overflow() {
        add(i32::MAX, 1);
    }
}
```

#### é›†æˆæµ‹è¯•

é›†æˆæµ‹è¯•æ”¾åœ¨ `tests/` ç›®å½•ä¸‹ï¼š

```rust
// tests/integration_test.rs
use cis_core::*;

#[tokio::test]
async fn test_memory_operations() {
    // æµ‹è¯•ä»£ç 
}
```

è¿è¡Œæµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test --all-features

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_name

# è¿è¡Œå¸¦æ—¥å¿—çš„æµ‹è¯•
RUST_LOG=debug cargo test -- --nocapture
```

---

## æäº¤ä¿¡æ¯è§„èŒƒ

æˆ‘ä»¬éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒï¼š

### æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type

| ç±»å‹ | è¯´æ˜ |
|------|------|
| `feat` | æ–°åŠŸèƒ½ |
| `fix` | Bug ä¿®å¤ |
| `docs` | ä»…æ–‡æ¡£ä¿®æ”¹ |
| `style` | ä¸å½±å“ä»£ç å«ä¹‰çš„ä¿®æ”¹ï¼ˆç©ºæ ¼ã€æ ¼å¼åŒ–ç­‰ï¼‰ |
| `refactor` | ä»£ç é‡æ„ï¼ˆæ—¢ä¸æ˜¯ä¿®å¤ä¹Ÿä¸æ˜¯åŠŸèƒ½ï¼‰ |
| `perf` | æ€§èƒ½ä¼˜åŒ– |
| `test` | æ·»åŠ æˆ–ä¿®æ­£æµ‹è¯• |
| `chore` | æ„å»ºè¿‡ç¨‹æˆ–è¾…åŠ©å·¥å…·çš„å˜åŠ¨ |

### Scope

å¯é€‰ï¼Œç”¨äºæŒ‡å®šä¿®æ”¹çš„èŒƒå›´ï¼š

- `core`: cis-core
- `node`: cis-node
- `gui`: cis-gui
- `skill`: Skill ç³»ç»Ÿ
- `network`: ç½‘ç»œæ¨¡å—
- `storage`: å­˜å‚¨å±‚
- `docs`: æ–‡æ¡£

### ç¤ºä¾‹

```
feat(skill): add vector-based skill routing

Implement semantic skill routing using embeddings.
This allows natural language skill discovery.

Closes #123
```

```
fix(storage): resolve SQLite deadlock on concurrent writes

Add retry logic with exponential backoff for database
operations that fail with "database is locked" error.

Fixes #456
```

```
docs(readme): update installation instructions

Add Homebrew installation method and clarify
portable mode usage.
```

---

## Pull Request æµç¨‹

### å‡†å¤‡ PR

1. **æ›´æ–°æ–‡æ¡£**ï¼šå¦‚æœæ‚¨çš„ä¿®æ”¹æ¶‰åŠ API å˜æ›´ï¼Œè¯·æ›´æ–°ç›¸å…³æ–‡æ¡£
2. **æ·»åŠ æµ‹è¯•**ï¼šç¡®ä¿æ–°åŠŸèƒ½æœ‰æµ‹è¯•è¦†ç›–
3. **è¿è¡Œæ£€æŸ¥**ï¼š
   ```bash
   cargo fmt -- --check
   cargo clippy --all-features -- -D warnings
   cargo test --all-features
   ```
4. **æ›´æ–° CHANGELOG.md**ï¼šåœ¨ Unreleased éƒ¨åˆ†æ·»åŠ æ‚¨çš„ä¿®æ”¹

### PR æ¨¡æ¿

```markdown
## æè¿°
ç®€è¦æè¿°è¿™ä¸ª PR åšäº†ä»€ä¹ˆ

## ç±»å‹
- [ ] Bug ä¿®å¤
- [ ] æ–°åŠŸèƒ½
- [ ] ç ´åæ€§å˜æ›´
- [ ] æ–‡æ¡£æ›´æ–°
- [ ] æ€§èƒ½ä¼˜åŒ–
- [ ] ä»£ç é‡æ„

## æ£€æŸ¥æ¸…å•
- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] æ·»åŠ äº†æµ‹è¯•
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ›´æ–°äº†æ–‡æ¡£
- [ ] æ›´æ–°äº† CHANGELOG.md

## ç›¸å…³ Issue
Fixes #(issue ç¼–å·)
```

### å®¡æŸ¥æµç¨‹

1. è‡³å°‘éœ€è¦ä¸€ä¸ªç»´æŠ¤è€…çš„æ‰¹å‡†
2. CI æ£€æŸ¥å¿…é¡»é€šè¿‡
3. å†²çªå¿…é¡»è§£å†³

---

## ç‰ˆæœ¬å‘å¸ƒ

### ç‰ˆæœ¬å·è§„èŒƒ

éµå¾ª [Semantic Versioning](https://semver.org/lang/zh-CN/)ï¼š

- **MAJOR**: ä¸å…¼å®¹çš„ API ä¿®æ”¹
- **MINOR**: å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢
- **PATCH**: å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£

### å‘å¸ƒæµç¨‹

1. æ›´æ–° `CHANGELOG.md`
2. æ›´æ–°ç‰ˆæœ¬å·ï¼ˆ`Cargo.toml`ï¼‰
3. åˆ›å»º Git tagï¼š`git tag -a v1.0.0 -m "Release version 1.0.0"`
4. Push tagï¼š`git push origin v1.0.0`
5. GitHub Actions ä¼šè‡ªåŠ¨æ„å»ºå¹¶å‘å¸ƒ

---

## è·å–å¸®åŠ©

- **GitHub Issues**: [é—®é¢˜è®¨è®º](https://github.com/MoSiYuan/CIS/issues)
- **æ–‡æ¡£**: [é¡¹ç›®æ–‡æ¡£](https://github.com/MoSiYuan/CIS/tree/main/docs)

---

å†æ¬¡æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼ğŸ‰
